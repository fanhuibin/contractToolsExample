# MinerU å¿«é€Ÿæµ‹è¯•æŒ‡å—

## æµ‹è¯•å‰å‡†å¤‡

### 1. ç¡®è®¤ä»£ç å·²æ›´æ–°
```bash
cd contract-tools-core
git status  # æŸ¥çœ‹ä¿®æ”¹
```

### 2. ç¼–è¯‘é¡¹ç›®
```bash
mvn clean compile -DskipTests
```

### 3. å‡†å¤‡æµ‹è¯•æ–‡ä»¶
ä½¿ç”¨ä¸€ä¸ªåŒ…å«ä»¥ä¸‹å†…å®¹çš„ PDF æ–‡ä»¶ï¼š
- âœ… è‡³å°‘ä¸€ä¸ªè¡¨æ ¼
- âœ… å¤šé¡µæ–‡æ¡£ï¼ˆè‡³å°‘2é¡µï¼‰
- âœ… æœ€å¥½åŒ…å«å›¾ç‰‡ã€åˆ—è¡¨ç­‰

---

## å¿«é€Ÿæµ‹è¯•æ­¥éª¤

### æ­¥éª¤ 1ï¼šè¿è¡Œæ¯”å¯¹
1. å¯åŠ¨åç«¯æœåŠ¡
2. ä¸Šä¼ æµ‹è¯• PDF æ–‡ä»¶
3. é€‰æ‹© MinerU ä½œä¸º OCR å¼•æ“
4. å¼€å¯"å¿½ç•¥é¡µçœ‰é¡µè„š"é€‰é¡¹
5. æ‰§è¡Œæ¯”å¯¹

### æ­¥éª¤ 2ï¼šæŸ¥çœ‹æ—¥å¿—ï¼ˆå®æ—¶ç›‘æ§ï¼‰

æ‰“å¼€æ—¥å¿—æ–‡ä»¶æˆ–æ§åˆ¶å°ï¼ŒæŸ¥æ‰¾ä»¥ä¸‹å…³é”®ä¿¡æ¯ï¼š

#### âœ… è¡¨æ ¼æ£€æµ‹
```
ğŸ” æ£€æµ‹åˆ°è¡¨æ ¼ç±»å‹
```
**é¢„æœŸ**ï¼šæ¯ä¸ªè¡¨æ ¼éƒ½åº”è¯¥è¢«æ£€æµ‹åˆ°

#### âœ… è¡¨æ ¼å¤„ç†
```
ğŸ“Š å¤„ç†è¡¨æ ¼é¡¹ï¼Œbbox: [100.0, 200.0, 500.0, 400.0]
```
**é¢„æœŸ**ï¼šæ˜¾ç¤ºè¡¨æ ¼çš„åæ ‡èŒƒå›´

#### âœ… HTML å»é™¤
```
ğŸ“ è¡¨æ ¼å»é™¤HTMLåæ–‡æœ¬é•¿åº¦: 245, é¢„è§ˆ: äº§å“\té”€é‡\tä»·æ ¼\nA\t100\t25.5\n...
```
**é¢„æœŸ**ï¼š
- é•¿åº¦ > 0
- é¢„è§ˆä¸­ä¸åº”æœ‰ HTML æ ‡ç­¾ï¼ˆå¦‚ `<table>`, `<tr>`, `<td>`ï¼‰
- åº”è¯¥æœ‰åˆ¶è¡¨ç¬¦ `\t` å’Œæ¢è¡Œç¬¦ `\n`

#### âœ… é¡µç æ˜¾ç¤º
```
ğŸš« è¿‡æ»¤ MinerU è¯†åˆ«çš„é¡µçœ‰é¡µè„š - ç¬¬1é¡µ, ç±»å‹:header
```
**é¢„æœŸ**ï¼šæ˜¾ç¤º"ç¬¬1é¡µ"è€Œä¸æ˜¯"ç¬¬0é¡µ"

### æ­¥éª¤ 3ï¼šæ£€æŸ¥è¾“å‡ºæ–‡ä»¶

#### æ–‡ä»¶ä½ç½®
```
uploads/compare-pro/tasks/{taskId}/
â”œâ”€â”€ old.pdf
â”œâ”€â”€ old.pdf.extracted.txt          â† æ£€æŸ¥è¿™ä¸ª
â”œâ”€â”€ old.pdf.extracted.compare.txt
â”œâ”€â”€ images/
â”‚   â””â”€â”€ old/
â”‚       â”œâ”€â”€ page-1.png              â† é¡µç ä»1å¼€å§‹
â”‚       â””â”€â”€ page-2.png
â””â”€â”€ ocr/
    â”œâ”€â”€ mineru_raw_old.json        â† åŸå§‹æ•°æ®
    â””â”€â”€ mineru_processed_old_filtered.json  â† æ£€æŸ¥è¿™ä¸ª
```

#### A. æ£€æŸ¥ extracted.txt
```bash
cat uploads/compare-pro/tasks/{taskId}/old.pdf.extracted.txt
```

**æŸ¥æ‰¾è¡¨æ ¼å†…å®¹**ï¼š
```
=== PAGE 1 ===
è¡¨1ï¼šé”€å”®æ•°æ®          â† caption
äº§å“	é”€é‡	ä»·æ ¼      â† è¡¨å¤´ï¼ˆç”¨åˆ¶è¡¨ç¬¦åˆ†éš”ï¼‰
A	100	25.5        â† æ•°æ®è¡Œ
B	200	30.0
* æ•°æ®å¤‡æ³¨            â† footnote
```

**æ£€æŸ¥è¦ç‚¹**ï¼š
- âœ… æœ‰ "=== PAGE 1 ===" è€Œä¸æ˜¯ "PAGE 0"
- âœ… åŒ…å«è¡¨æ ¼å†…å®¹
- âœ… æ²¡æœ‰ HTML æ ‡ç­¾
- âœ… ä½¿ç”¨åˆ¶è¡¨ç¬¦å’Œæ¢è¡Œç¬¦ä¿æŒç»“æ„

#### B. æ£€æŸ¥åˆ†é¡µ JSON
```bash
cat uploads/compare-pro/tasks/{taskId}/ocr/mineru_processed_old_filtered.json | jq
```

**æŸ¥æ‰¾è¡¨æ ¼æ•°æ®**ï¼š
```json
{
  "fileName": "old.pdf",
  "totalPages": 2,
  "pageData": {
    "0": [  // â† æ³¨æ„ï¼šè¿™é‡Œä»æ˜¯0-basedï¼ˆå†…éƒ¨æ•°æ®ç»“æ„ï¼‰
      {
        "bbox": [100, 200, 500, 400],
        "type": "Table",  // â† æ£€æŸ¥ï¼šå¿…é¡»æ˜¯å¤§å†™ "Table"
        "text": "äº§å“\té”€é‡\tä»·æ ¼\nA\t100\t25.5\n..."  // â† æ£€æŸ¥ï¼šæ— HTML
      }
    ]
  }
}
```

**æ£€æŸ¥è¦ç‚¹**ï¼š
- âœ… type ä¸º "Table"ï¼ˆé¦–å­—æ¯å¤§å†™ï¼‰
- âœ… text ä¸­æ²¡æœ‰ HTML æ ‡ç­¾
- âœ… ä½¿ç”¨ `\t` å’Œ `\n` åˆ†éš”

#### C. æ£€æŸ¥åŸå§‹æ•°æ®ï¼ˆå¯é€‰ï¼‰
```bash
cat uploads/compare-pro/tasks/{taskId}/ocr/mineru_raw_old.json | jq
```

**æŸ¥æ‰¾è¡¨æ ¼**ï¼š
```json
{
  "results": {
    "old.pdf": {
      "content_list": [
        {
          "type": "table",  // â† MinerU åŸå§‹ï¼šå°å†™
          "page_idx": 0,    // â† MinerU åŸå§‹ï¼š0-based
          "table_body": "<table><tr>...</tr></table>",  // â† HTMLæ ¼å¼
          "bbox": [100, 200, 500, 400]
        }
      ]
    }
  }
}
```

### æ­¥éª¤ 4ï¼šéªŒè¯æ¯”å¯¹ç»“æœ

æŸ¥çœ‹æ¯”å¯¹æŠ¥å‘Šï¼š

#### âœ… é¡µç æ­£ç¡®
```
å·®å¼‚å‡ºç°åœ¨ç¬¬1é¡µç¬¬2è¡Œ    â† åº”è¯¥æ˜¯"ç¬¬1é¡µ"
å·®å¼‚å‡ºç°åœ¨ç¬¬2é¡µç¬¬5è¡Œ    â† åº”è¯¥æ˜¯"ç¬¬2é¡µ"
```

#### âœ… è¡¨æ ¼å‚ä¸æ¯”å¯¹
- å¦‚æœæ–°æ—§æ–‡æ¡£çš„è¡¨æ ¼ä¸åŒï¼Œåº”è¯¥èƒ½æ£€æµ‹åˆ°å·®å¼‚
- å·®å¼‚ä½ç½®åº”è¯¥å‡†ç¡®

---

## é—®é¢˜è¯Šæ–­

### é—®é¢˜ 1ï¼šæ—¥å¿—ä¸­æ²¡æœ‰"æ£€æµ‹åˆ°è¡¨æ ¼"

**å¯èƒ½åŸå› **ï¼š
1. PDF ä¸­ç¡®å®æ²¡æœ‰è¡¨æ ¼
2. MinerU æœªè¯†åˆ«å‡ºè¡¨æ ¼

**è¯Šæ–­æ­¥éª¤**ï¼š
```bash
# æŸ¥çœ‹ MinerU åŸå§‹è¿”å›
cat ocr/mineru_raw_old.json | jq '.results[].content_list[] | select(.type == "table")'
```

**ç»“æœåˆ†æ**ï¼š
- å¦‚æœæœ‰ç»“æœ â†’ ä»£ç é—®é¢˜ï¼Œæ£€æŸ¥ç±»å‹åŒ¹é…
- å¦‚æœæ— ç»“æœ â†’ MinerU è¯†åˆ«é—®é¢˜ï¼Œå°è¯•å…¶ä»– PDF

### é—®é¢˜ 2ï¼šextracted.txt ä¸­æœ‰ HTML æ ‡ç­¾

**å¯èƒ½åŸå› **ï¼š
- Category ä¸æ˜¯ "Table"ï¼ˆå¤§å†™ï¼‰
- removeHtmlTags æœªæ‰§è¡Œ

**è¯Šæ–­æ­¥éª¤**ï¼š
```bash
# æŸ¥çœ‹æ—¥å¿—ä¸­çš„ Category
grep "å¤„ç† MinerU å†…å®¹é¡¹" logs/*.log
```

**é¢„æœŸè¾“å‡º**ï¼š
```
å¤„ç† MinerU å†…å®¹é¡¹ï¼Œç±»å‹: table
```

**æ£€æŸ¥ä»£ç **ï¼š
ç¡®è®¤ line 490:
```java
items.add(new TextExtractionUtil.LayoutItem(imageBbox, "Table", cleanText));
//                                                      â†‘ å¿…é¡»æ˜¯ "Table"
```

### é—®é¢˜ 3ï¼šé¡µç ä»ä»0å¼€å§‹

**å¯èƒ½åŸå› **ï¼š
- ä»£ç æœªæ›´æ–°
- æœªé‡æ–°ç¼–è¯‘

**è¯Šæ–­æ­¥éª¤**ï¼š
```bash
# æ£€æŸ¥ä»£ç 
grep "i + 1.*new.*PageLayout" src/.../MinerUOCRService.java
```

**é¢„æœŸè¾“å‡º**ï¼š
```java
layouts[i] = new TextExtractionUtil.PageLayout(i + 1, items, imgW, imgH);
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# é‡æ–°ç¼–è¯‘
mvn clean compile -DskipTests
# é‡å¯æœåŠ¡
```

### é—®é¢˜ 4ï¼šè¡¨æ ¼å†…å®¹ä¹±ç æˆ–æ ¼å¼ä¸¢å¤±

**å¯èƒ½åŸå› **ï¼š
- HTML å®ä½“æœªå®Œå…¨è§£ç 
- ç‰¹æ®Šå­—ç¬¦å¤„ç†é—®é¢˜

**è¯Šæ–­æ­¥éª¤**ï¼š
æŸ¥çœ‹æ—¥å¿—ä¸­çš„é¢„è§ˆï¼š
```
ğŸ“ è¡¨æ ¼å»é™¤HTMLåæ–‡æœ¬é•¿åº¦: 245, é¢„è§ˆ: ...
```

**æ£€æŸ¥è¦ç‚¹**ï¼š
- æ˜¯å¦æœ‰ `&nbsp;` ç­‰æœªè§£ç çš„å®ä½“
- æ˜¯å¦æœ‰å¤šä½™çš„ç©ºç™½

---

## æ€§èƒ½æµ‹è¯•

### æµ‹è¯•ä¸åŒè§„æ¨¡çš„æ–‡æ¡£

| æ–‡æ¡£ç±»å‹ | é¡µæ•° | è¡¨æ ¼æ•° | é¢„æœŸè€—æ—¶ |
|---------|------|--------|---------|
| ç®€å• | 1-2 | 1-2 | < 10s |
| ä¸­ç­‰ | 5-10 | 3-5 | < 30s |
| å¤æ‚ | 20+ | 10+ | < 2min |

**ç›‘æ§æŒ‡æ ‡**ï¼š
- MinerU API è°ƒç”¨è€—æ—¶
- HTML å»é™¤è€—æ—¶
- æ€»ä½“ OCR è€—æ—¶

---

## å›å½’æµ‹è¯•

ç¡®ä¿ä¸å½±å“ç°æœ‰åŠŸèƒ½ï¼š

### âœ… dots.ocr æ¨¡å¼
- [ ] ä»èƒ½æ­£å¸¸ä½¿ç”¨ dots.ocr
- [ ] è¾“å‡ºæ ¼å¼ä¸€è‡´

### âœ… æ–‡æœ¬è¯†åˆ«
- [ ] çº¯æ–‡æœ¬ PDF è¯†åˆ«æ­£å¸¸
- [ ] åˆ—è¡¨è¯†åˆ«æ­£å¸¸

### âœ… æ¯”å¯¹åŠŸèƒ½
- [ ] æ¯”å¯¹ç»“æœå‡†ç¡®
- [ ] å·®å¼‚æ ‡è®°æ­£ç¡®

---

## æˆåŠŸæ ‡å‡†

æ‰€æœ‰ä»¥ä¸‹æ¡ä»¶éƒ½æ»¡è¶³ï¼š

- âœ… æ—¥å¿—ä¸­æœ‰ "ğŸ” æ£€æµ‹åˆ°è¡¨æ ¼ç±»å‹"
- âœ… æ—¥å¿—ä¸­æœ‰ "ğŸ“ è¡¨æ ¼å»é™¤HTMLåæ–‡æœ¬é•¿åº¦"
- âœ… æ—¥å¿—ä¸­æ˜¾ç¤º "ç¬¬1é¡µ" è€Œä¸æ˜¯ "ç¬¬0é¡µ"
- âœ… extracted.txt åŒ…å«è¡¨æ ¼å†…å®¹ä¸”æ—  HTML æ ‡ç­¾
- âœ… åˆ†é¡µ JSON ä¸­ type ä¸º "Table"ï¼ˆå¤§å†™ï¼‰
- âœ… æ¯”å¯¹ç»“æœé¡µç ä»ç¬¬1é¡µå¼€å§‹
- âœ… è¡¨æ ¼å†…å®¹å‚ä¸æ¯”å¯¹

---

## æŠ¥å‘Šé—®é¢˜

å¦‚æœæµ‹è¯•å¤±è´¥ï¼Œè¯·æä¾›ï¼š

1. **æ—¥å¿—æ–‡ä»¶**
   - å®Œæ•´çš„æ§åˆ¶å°è¾“å‡ºæˆ–æ—¥å¿—æ–‡ä»¶

2. **è¾“å‡ºæ–‡ä»¶**
   - mineru_raw_*.json
   - mineru_processed_*.json
   - extracted.txt

3. **æµ‹è¯• PDF**
   - å¦‚æœå¯èƒ½ï¼Œæä¾›æµ‹è¯•ç”¨çš„ PDF æ–‡ä»¶

4. **é¢„æœŸ vs å®é™…**
   - é¢„æœŸçœ‹åˆ°ä»€ä¹ˆ
   - å®é™…çœ‹åˆ°ä»€ä¹ˆ
   - å…·ä½“å“ªä¸€æ­¥å‡ºé”™

---

## å¿«é€Ÿå‘½ä»¤

```bash
# æŸ¥çœ‹æœ€æ–°æ—¥å¿—
tail -f logs/application.log | grep -E "ğŸ”|ğŸ“Š|ğŸ“|âš ï¸|ğŸš«"

# æŸ¥æ‰¾è¡¨æ ¼æ•°æ®
find uploads/compare-pro/tasks -name "mineru_raw*.json" -exec jq '.results[].content_list[] | select(.type == "table")' {} \;

# æŸ¥çœ‹é¡µç 
grep "=== PAGE" uploads/compare-pro/tasks/*/old.pdf.extracted.txt

# æ£€æŸ¥ Category
grep -r "\"Table\"" uploads/compare-pro/tasks/*/ocr/
```

---

## è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬ï¼ˆå¯é€‰ï¼‰

```bash
#!/bin/bash
# test_mineru.sh

TASK_DIR="uploads/compare-pro/tasks/latest"

echo "=== æµ‹è¯• MinerU ä¿®å¤ ==="

# 1. æ£€æŸ¥è¡¨æ ¼æ£€æµ‹
echo "1. æ£€æŸ¥è¡¨æ ¼æ£€æµ‹..."
if grep -q "ğŸ” æ£€æµ‹åˆ°è¡¨æ ¼ç±»å‹" logs/*.log; then
    echo "   âœ… è¡¨æ ¼å·²æ£€æµ‹"
else
    echo "   âŒ æœªæ£€æµ‹åˆ°è¡¨æ ¼"
fi

# 2. æ£€æŸ¥ HTML å»é™¤
echo "2. æ£€æŸ¥ HTML å»é™¤..."
if grep -q "ğŸ“ è¡¨æ ¼å»é™¤HTMLå" logs/*.log; then
    echo "   âœ… HTML å·²å»é™¤"
else
    echo "   âŒ HTML æœªå»é™¤"
fi

# 3. æ£€æŸ¥é¡µç 
echo "3. æ£€æŸ¥é¡µç ..."
if grep -q "=== PAGE 1 ===" $TASK_DIR/old.pdf.extracted.txt; then
    echo "   âœ… é¡µç æ­£ç¡®ï¼ˆä»1å¼€å§‹ï¼‰"
else
    echo "   âŒ é¡µç é”™è¯¯"
fi

# 4. æ£€æŸ¥ Category
echo "4. æ£€æŸ¥ Category..."
if grep -q '"type": "Table"' $TASK_DIR/ocr/mineru_processed*.json; then
    echo "   âœ… Category æ­£ç¡®ï¼ˆå¤§å†™ï¼‰"
else
    echo "   âŒ Category é”™è¯¯"
fi

echo "=== æµ‹è¯•å®Œæˆ ==="
```

---

## æ€»ç»“

å®Œæˆä»¥ä¸Šæµ‹è¯•åï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿç¡®è®¤ï¼š

1. âœ… è¡¨æ ¼å†…å®¹ä¸å†ä¸¢å¤±
2. âœ… HTML æ ‡ç­¾å·²æ­£ç¡®å»é™¤
3. âœ… é¡µç ä»ç¬¬1é¡µå¼€å§‹æ˜¾ç¤º
4. âœ… æ‰€æœ‰ç±»å‹éƒ½èƒ½æ­£ç¡®å¤„ç†
5. âœ… ä¸ dots.ocr æ ¼å¼å…¼å®¹

**æµ‹è¯•é€šè¿‡** = å¯ä»¥éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ ğŸ‰

