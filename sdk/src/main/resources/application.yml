server:
  port: 8080
  tomcat:
    uri-encoding: UTF-8

spring:
  application:
    name: contract-template-sdk
  mvc:
    pathmatch:
      matching-strategy: ant_path_matcher
  config:
    import:
      - classpath:application-ai.yml
  servlet:
    multipart:
      max-file-size: 100MB
      max-request-size: 100MB
      enabled: true
  # Flyway（启用DB迁移，加载依赖Jar中的 db/migration 脚本）
  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true
    validate-on-migrate: true
  
  # 数据库配置
  datasource:
    type: com.alibaba.druid.pool.DruidDataSource
    dynamic:
      primary: master
      datasource:
        master:
          driverClassName: com.mysql.cj.jdbc.Driver
          url: jdbc:mysql://localhost:3306/contract_tools?useUnicode=true&characterEncoding=utf8&zeroDateTimeBehavior=convertToNull&useSSL=true&serverTimezone=GMT%2B8&autoReconnect=true&rewriteBatchedStatements=true&nullCatalogMeansCurrent=true
          username: root
          password: root
      druid:
        initialSize: 5
        minIdle: 10
        maxActive: 200
        maxWait: 60000
        timeBetweenEvictionRunsMillis: 60000
        minEvictableIdleTimeMillis: 300000
        maxEvictableIdleTimeMillis: 900000
        validationQuery: SELECT 1 FROM DUAL
        testWhileIdle: true
        testOnBorrow: true
        testOnReturn: false
        filters: stat
        webStatFilter:
          enabled: true
        statViewServlet:
          enabled: true
          url-pattern: /druid/*
          login-username: admin
          login-password: admin
  
  # JPA配置
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQL8Dialect
        format_sql: true

# 日志配置
logging:
  level:
    com.zhaoxinms.contract.template.sdk: DEBUG
    com.zhaoxinms.contract.tools: DEBUG
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n" 

# 肇新合同工具集配置
zxcm:
  # OnlyOffice配置
  onlyoffice:
    domain: http://43.143.173.96
    port: 8082
    secret: zxcm
    callback:
      url: http://proxy.zhaoxinms.com:9100/api/onlyoffice/callback
    plugins:
      - http://43.143.173.96:8082/plugin/html/config.json
      - http://43.143.173.96:8082/plugin/comment/config.json
    logo:
      logo: ""
      logoEmbedded: ""
      logoUrl: ""
    permissions:
      view:
        print: true
      edit:
        print: true
        download: true
        comment: true
        chat: true
        review: true
        fillForms: true
        modifyContentControl: true
        modifyFilter: true
  
  # 文件上传配置
  file-upload:
    root-path: ./uploads
  
  # 比对功能配置
  compare:
    # ZXOCR配置（原GPU OCR）
    zxocr:
      # OCR服务配置
      ocr-base-url: http://192.168.0.100:8000
      ocr-model: model
      
      # 文件处理配置
      upload-path: ./uploads
      result-path: ./uploads/compare-pro/results
      save-ocr-images: true
      
      # 图像处理配置
      render-dpi: 180
      min-pixels: 3136
      max-pixels: 11289600
      
      # 并发处理配置
      parallel-threads: 30  # 默认并发线程数，可根据服务器性能调整
      
      # 幻觉校验配置
      hallucination-validation:
        enabled: true  # 是否启用RapidOCR幻觉校验
        page-threshold-multiplier: 3  # 页数阈值倍数，符合条件的块数超过 总页数*此倍数 时跳过校验
      
      # 调试配置
      debug-file-path: "./uploads/debug"

    # RapidOCR配置
    rapidocr:
      enabled: true
      base-url: http://192.168.0.100:9005
      timeout: PT2M  # 2分钟超时
      verbose-logging: false
      max-concurrency: 10
      default-use-detection: true
      default-use-classification: true
      default-use-recognition: true