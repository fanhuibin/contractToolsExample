server:
  port: 8080
  tomcat:
    uri-encoding: UTF-8

spring:
  application:
    name: contract-template-sdk
  mvc:
    pathmatch:
      matching-strategy: ant_path_matcher
  config:
    import:
      - classpath:application-ai.yml
      - classpath:application-extract.yml
  servlet:
    multipart:
      max-file-size: 100MB
      max-request-size: 100MB
      enabled: true

  # 数据库配置（固定数据源）
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/contract_tools?useUnicode=true&characterEncoding=utf8&zeroDateTimeBehavior=convertToNull&useSSL=true&serverTimezone=GMT%2B8&autoReconnect=true&rewriteBatchedStatements=true&nullCatalogMeansCurrent=true
    username: root
    password: root
    type: com.alibaba.druid.pool.DruidDataSource
    druid:
      initial-size: 5
      min-idle: 10
      max-active: 200
      max-wait: 60000
      time-between-eviction-runs-millis: 60000
      min-evictable-idle-time-millis: 300000
      max-evictable-idle-time-millis: 900000
      validation-query: SELECT 1 FROM DUAL
      test-while-idle: true
      test-on-borrow: true
      test-on-return: false
      filters: stat
      web-stat-filter:
        enabled: true
      stat-view-servlet:
        enabled: true
        url-pattern: /druid/*
        login-username: admin
        login-password: admin

# 文件上传配置
file:
  upload:
    root-path: ./uploads
  

# 日志配置
logging:
  level:
    com.zhaoxinms.contract.template.sdk: DEBUG
    com.zhaoxinms.contract.tools: DEBUG
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n" 

# 肇新合同工具集配置
zxcm:
  # OnlyOffice配置
  onlyoffice:
    domain: http://43.143.173.96
    port: 8082
    secret: zxcm
    callback:
      url: http://proxy.zhaoxinms.com:9100/api/onlyoffice/callback
    plugins:
      - http://43.143.173.96:8082/plugin/html/config.json
      - http://43.143.173.96:8082/plugin/comment/config.json
    logo:
      logo: ""
      logoEmbedded: ""
      logoUrl: ""
    permissions:
      view:
        print: true
      edit:
        print: true
        download: true
        comment: true
        chat: true
        review: true
        fillForms: true
        modifyContentControl: true
        modifyFilter: true
  
  # 文件上传配置
  file-upload:
    root-path: ./uploads
  
  
  # 比对功能配置
  compare:
    # ZXOCR配置（原GPU OCR）
    zxocr:
      # 默认OCR工具选择（全局配置，优先级高于前端传递）
      # 可选值: mineru, dotsocr, thirdparty
      default-ocr-service: mineru
      
      # OCR服务配置
      ocr-base-url: http://192.168.0.100:8000
      ocr-model: model
      
      # 文件处理配置
      upload-path: ./uploads
      result-path: ./uploads/compare-pro/results
      save-ocr-images: true
      
      # 图像处理配置
      # DPI 设置：影响前端显示清晰度
      # 150: 快速预览，文件小但不清晰
      # 160: 平衡清晰度和文件大小（当前设置）
      # 200: 标准清晰度，适合屏幕显示（推荐配合 PNG）
      # 300: 高清显示，文件较大
      # 400+: 专业印刷级别，文件很大
      render-dpi: 160
      
      # 图片格式：PNG（无损）或 JPEG（压缩）
      # PNG: 无损格式，画布缩放时最清晰（推荐）
      # JPEG: 有损压缩，文件小但缩放时可能模糊
      image-format: PNG
      
      # JPEG 质量（0.0-1.0，仅 JPEG 格式有效）
      # 0.85: 推荐，平衡质量和大小
      # 0.90: 高质量，文件稍大
      # 0.75: 更小的文件
      jpeg-quality: 0.85
      
      min-pixels: 3136
      max-pixels: 11289600
      
      # 并发处理配置
      parallel-threads: 30  # 默认并发线程数，可根据服务器性能调整
      
      # GPU OCR线程池配置
      thread-pool:
        # 核心线程数（始终保持活跃的线程数）
        core-pool-size: 2
        # 最大线程数（线程池允许的最大线程数）
        max-pool-size: 30
        # 任务队列容量（等待队列中最多能容纳的任务数）
        queue-capacity: 500
        # 线程空闲时间（秒）- 非核心线程的最大空闲时间
        keep-alive-time: 60
        # 线程名称前缀
        thread-name-prefix: "GPU-OCR-Worker-"
        # 是否允许核心线程超时
        allow-core-thread-timeout: false
        
      # 任务处理配置
      task:
        # 队列繁忙阈值（当队列使用率超过此值时认为繁忙）
        busy-threshold: 0.8
        # 任务超时时间（分钟）
        timeout-minutes: 30
        
      # 监控配置
      monitoring:
        # 是否启用详细日志
        enable-detailed-logging: true
        # 统计信息输出间隔（秒）
        stats-interval-seconds: 300
      
      # 幻觉校验配置
      hallucination-validation:
        enabled: true  # 是否启用RapidOCR幻觉校验
        page-threshold-multiplier: 3  # 页数阈值倍数，符合条件的块数超过 总页数*此倍数 时跳过校验
      
      # 调试配置
      debug-file-path: "./uploads/debug"
      
      # OCR性能参数配置（毫秒）
      performance:
        # 基础性能参数
        base-overhead: 500               # 基础开销时间（初始化等）
        page-setup-time: 50              # 每页设置时间
        
        # OCR识别性能参数（每页时间）- 基于实测数据：3页OCR第一文档8910ms，第二文档7423ms
        ocr-first-doc-per-page: 2500     # OCR第一个文档每页时间（毫秒）实测2970ms/页，预留缓冲
        ocr-second-doc-per-page: 2500    # OCR第二个文档每页时间（毫秒）实测2474ms/页，预留缓冲
        ocr-first-doc-min-time: 2500     # OCR第一个文档最小时间
        ocr-second-doc-min-time: 2500    # OCR第二个文档最小时间
        
        # 其他步骤性能参数（基于实测数据大幅优化）
        init-time: 10                    # 初始化时间（实测4ms）
        ocr-complete-time: 10            # OCR完成时间（实测0ms）
        text-compare-per-page: 5         # 文本比对每页时间（实测14ms/3页）
        text-compare-min-time: 15        # 文本比对最小时间
        diff-analysis-per-page: 6        # 差异分析每页时间（实测18ms/3页）
        diff-analysis-min-time: 20       # 差异分析最小时间
        block-merge-per-page: 1          # 块合并每页时间（实测1ms/3页）
        block-merge-min-time: 5          # 块合并最小时间
        ocr-validation-per-page: 6       # OCR验证每页时间（实测17ms/3页）
        ocr-validation-min-time: 20      # OCR验证最小时间
        result-generation-per-page: 1    # 结果生成每页时间（实测2ms/3页）
        result-generation-min-time: 10   # 结果生成最小时间
        task-complete-time: 10           # 任务完成时间（实测0ms）
        
        # 性能调整系数
        ocr-buffer-factor: 1.1           # OCR步骤缓冲系数（降低缓冲，更贴近实际）
        regression-fallback: true        # 是否启用线性回归作为备选

    # RapidOCR配置
    rapidocr:
      enabled: false  # 禁用RapidOCR
      base-url: http://192.168.0.100:9005
      timeout: PT2M  # 2分钟超时
      verbose-logging: false
      max-concurrency: 10
      default-use-detection: true
      default-use-classification: true
      default-use-recognition: true
      
    # MinerU OCR配置
    mineru:
      api-url: http://192.168.0.100:8000  # MinerU Web API地址
      vllm-server-url: http://192.168.0.100:30000  # vLLM Server地址
      backend: vlm-http-client  # 后端模式：pipeline, vlm-http-client等