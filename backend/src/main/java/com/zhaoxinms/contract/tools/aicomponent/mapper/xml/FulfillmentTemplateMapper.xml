<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zhaoxinms.contract.tools.aicomponent.mapper.FulfillmentTemplateMapper">
    
    <!-- 根据合同类型和用户ID查找默认模板 -->
    <select id="selectDefaultTemplate" resultType="com.zhaoxinms.contract.tools.aicomponent.model.FulfillmentTemplate">
        SELECT * FROM ai_fulfillment_template
        WHERE contract_type = #{contractType}
        AND is_default = true
        AND (user_id = #{userId} OR type = 'system')
        ORDER BY 
            CASE WHEN user_id = #{userId} THEN 1 
                 WHEN type = 'system' THEN 2 
                 ELSE 3 
            END
        LIMIT 1
    </select>
</mapper>
