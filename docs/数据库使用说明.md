# 数据库使用说明

## 1. 数据库准备

### 1.1 创建数据库
首先需要在MySQL中创建数据库：

```sql
CREATE DATABASE contract_tools CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 1.2 修改数据库配置
在 `backend/src/main/resources/application.yml` 中修改数据库连接信息：

```yaml
spring:
  datasource:
    type: com.alibaba.druid.pool.DruidDataSource
    dynamic:
      primary: master
      datasource:
        master:
          driverClassName: com.mysql.cj.jdbc.Driver
          url: jdbc:mysql://localhost:3306/contract_tools?useUnicode=true&characterEncoding=utf8&zeroDateTimeBehavior=convertToNull&useSSL=true&serverTimezone=GMT%2B8&autoReconnect=true&rewriteBatchedStatements=true&nullCatalogMeansCurrent=true
          username: 你的MySQL用户名
          password: 你的MySQL密码
      druid:
        initialSize: 5
        minIdle: 10
        maxActive: 200
        maxWait: 60000
        webStatFilter:
          enabled: true
        statViewServlet:
          enabled: true
          url-pattern: /druid/*
          login-username: admin
          login-password: admin
```

## 2. 启动应用

### 2.1 启动后端服务
```bash
cd backend
mvn spring-boot:run
```

应用启动时会自动：
- 连接数据库
- 执行Flyway迁移脚本，创建 `contract_extract_template` 表
- 初始化系统预设的合同提取模板

### 2.2 验证数据库表
启动成功后，可以在MySQL中查看表结构：

```sql
-- 查看表结构
DESCRIBE contract_extract_template;

-- 查看系统预设模板
SELECT * FROM contract_extract_template WHERE type = 'system';
```

## 3. 数据库监控

### 3.1 Druid监控页面
启动应用后，可以访问Druid监控页面查看数据库连接池状态：
- 地址：`http://localhost:8080/api/druid`
- 用户名：admin
- 密码：admin

监控页面提供以下功能：
- 数据源统计信息
- SQL监控
- Web应用统计
- URI监控
- Session监控

## 4. 使用合同提取模板功能

### 4.1 前端访问
启动前端服务：
```bash
cd frontend
npm install
npm run dev
```

访问：`http://localhost:5173`

### 4.2 功能说明
1. **选择合同类型**：选择对应的合同类型（租赁、购销、劳动等）
2. **选择模板**：系统会自动显示该类型的预设模板
3. **自定义字段**：可以选择"自定义提取字段"来手动添加字段
4. **保存模板**：可以将自定义的字段保存为新的模板
5. **上传文件**：上传合同文件进行信息提取

### 4.3 API接口
- `GET /api/ai/contract/template/list` - 获取所有模板
- `GET /api/ai/contract/template/contract-types` - 获取合同类型列表
- `POST /api/ai/contract/template/create` - 创建新模板
- `PUT /api/ai/contract/template/{id}` - 更新模板
- `DELETE /api/ai/contract/template/{id}` - 删除模板

## 5. 系统预设模板

系统会自动创建以下预设模板：

1. **通用合同模板** - 适用于大多数合同类型
2. **租赁合同模板** - 包含承租方、出租方、租赁费用等字段
3. **购销合同模板** - 包含合同金额、付款方式、交货信息等字段
4. **劳动合同模板** - 包含员工信息、工资、工作地点等字段
5. **建筑合同模板** - 包含工程信息、工期、质量标准等字段
6. **技术合同模板** - 包含技术内容、知识产权等字段
7. **知识产权合同模板** - 包含许可范围、使用期限等字段
8. **运营服务合同模板** - 包含服务内容、服务标准等字段

## 6. 故障排除

### 5.1 数据库连接失败
- 检查MySQL服务是否启动
- 检查数据库用户名密码是否正确
- 检查数据库是否创建

### 5.2 表创建失败
- 检查Flyway配置是否正确
- 查看应用启动日志中的错误信息
- 手动执行SQL脚本创建表

### 5.3 模板初始化失败
- 检查数据库连接
- 查看应用日志中的错误信息
- 重启应用，系统会自动重新初始化模板

## 7. 数据备份

建议定期备份数据库：

```bash
mysqldump -u root -p contract_tools > contract_tools_backup.sql
```

恢复数据：
```bash
mysql -u root -p contract_tools < contract_tools_backup.sql
``` 