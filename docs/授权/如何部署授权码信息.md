# Licenseæˆæƒæ–‡ä»¶éƒ¨ç½²æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•åœ¨ç”Ÿäº§ç¯å¢ƒä¸­éƒ¨ç½²Licenseæˆæƒæ–‡ä»¶ï¼Œç¡®ä¿SDKæ‰“åŒ…åèƒ½å¤Ÿæ­£ç¡®åŠ è½½æˆæƒã€‚

---

## ğŸ¯ éƒ¨ç½²ç»“æ„

### æ¨èçš„ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ç»“æ„

```
/opt/zhaoxin-contract-tools/
  â”œâ”€â”€ contract-tools-sdk-1.0.0.jar    # SDKä¸»ç¨‹åº
  â”œâ”€â”€ license.lic                      # æˆæƒæ–‡ä»¶ï¼ˆæ–¹å¼1ï¼šjaråŒ…åŒçº§ï¼‰
  â”œâ”€â”€ publicCerts.store                # å…¬é’¥æ–‡ä»¶ï¼ˆæ–¹å¼1ï¼šjaråŒ…åŒçº§ï¼‰
  â”œâ”€â”€ config/                          # é…ç½®ç›®å½•
  â”‚   â”œâ”€â”€ application.yml              # åº”ç”¨é…ç½®
  â”‚   â”œâ”€â”€ license.lic                  # æˆæƒæ–‡ä»¶ï¼ˆæ–¹å¼2ï¼šconfigç›®å½•ï¼‰
  â”‚   â””â”€â”€ publicCerts.store            # å…¬é’¥æ–‡ä»¶ï¼ˆæ–¹å¼2ï¼šconfigç›®å½•ï¼‰
  â””â”€â”€ logs/                            # æ—¥å¿—ç›®å½•
```

---

## ğŸ“‚ æ–‡ä»¶åŠ è½½ä¼˜å…ˆçº§

### Licenseæ–‡ä»¶ (`license.lic`)

ç³»ç»ŸæŒ‰ä»¥ä¸‹ä¼˜å…ˆçº§æŸ¥æ‰¾æˆæƒæ–‡ä»¶ï¼š

1. **jaråŒ…åŒçº§ç›®å½•** âœ… æ¨è
   ```
   ./license.lic
   ```

2. **configç›®å½•**
   ```
   ./config/license.lic
   ```

3. **classpath**ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
   ```
   classpath:license.lic
   ```

### å…¬é’¥æ–‡ä»¶ (`publicCerts.store`)

ä¸Licenseæ–‡ä»¶ä½¿ç”¨ç›¸åŒçš„ä¼˜å…ˆçº§è§„åˆ™ï¼š

1. **jaråŒ…åŒçº§ç›®å½•** âœ… æ¨è
   ```
   ./publicCerts.store
   ```

2. **configç›®å½•**
   ```
   ./config/publicCerts.store
   ```

3. **classpath**ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
   ```
   classpath:publicCerts.store
   ```

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### æ­¥éª¤1ï¼šæ„å»ºSDK

```bash
cd contract-tools-sdk
mvn clean package -DskipTests
```

**ç”Ÿæˆæ–‡ä»¶**ï¼š`target/contract-tools-sdk-1.0.0.jar`

### æ­¥éª¤2ï¼šåˆ›å»ºéƒ¨ç½²ç›®å½•

```bash
# Linux/Mac
mkdir -p /opt/zhaoxin-contract-tools/config
mkdir -p /opt/zhaoxin-contract-tools/logs

# Windows
mkdir C:\zhaoxin-contract-tools\config
mkdir C:\zhaoxin-contract-tools\logs
```

### æ­¥éª¤3ï¼šå¤åˆ¶æ–‡ä»¶

```bash
# å¤åˆ¶SDK jaråŒ…
cp target/contract-tools-sdk-1.0.0.jar /opt/zhaoxin-contract-tools/

# æ–¹å¼1ï¼šæ”¾åœ¨jaråŒ…åŒçº§ç›®å½•ï¼ˆæ¨èï¼‰
cp /path/to/license.lic /opt/zhaoxin-contract-tools/
cp /path/to/publicCerts.store /opt/zhaoxin-contract-tools/

# æˆ–è€…æ–¹å¼2ï¼šæ”¾åœ¨configç›®å½•
cp /path/to/license.lic /opt/zhaoxin-contract-tools/config/
cp /path/to/publicCerts.store /opt/zhaoxin-contract-tools/config/
```

### æ­¥éª¤4ï¼šé…ç½®æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦è‡ªå®šä¹‰é…ç½®ï¼Œåˆ›å»º `config/application.yml`ï¼š

```yaml
server:
  port: 8080

zhaoxin:
  auth:
    enabled: true
    license:
      file-path: classpath:license.lic  # ä½¿ç”¨classpathå‰ç¼€ï¼Œä¼šè‡ªåŠ¨æŒ‰ä¼˜å…ˆçº§æŸ¥æ‰¾
    signature:
      public-key-path: classpath:publicCerts.store
```

### æ­¥éª¤5ï¼šå¯åŠ¨åº”ç”¨

```bash
cd /opt/zhaoxin-contract-tools

# æ–¹å¼1ï¼šç›´æ¥å¯åŠ¨
java -jar contract-tools-sdk-1.0.0.jar

# æ–¹å¼2ï¼šæŒ‡å®šé…ç½®æ–‡ä»¶
java -jar contract-tools-sdk-1.0.0.jar --spring.config.location=./config/application.yml

# æ–¹å¼3ï¼šåå°è¿è¡Œ
nohup java -jar contract-tools-sdk-1.0.0.jar > logs/app.log 2>&1 &

# æ–¹å¼4ï¼šä½¿ç”¨systemdæœåŠ¡ï¼ˆLinuxï¼‰
systemctl start zhaoxin-contract-tools
```

---

## ğŸ”„ æ›´æ–°æˆæƒæ–‡ä»¶

### æ— éœ€é‡å¯æ›´æ–°ï¼ˆæ¨èï¼‰

**ä¼˜ç‚¹**ï¼šæˆæƒæ–‡ä»¶åœ¨jaråŒ…å¤–éƒ¨ï¼Œå¯ä»¥éšæ—¶æ›¿æ¢è€Œæ— éœ€é‡æ–°æ‰“åŒ…ã€‚

**æ­¥éª¤**ï¼š

```bash
# 1. åœæ­¢åº”ç”¨
kill <pid>

# 2. å¤‡ä»½æ—§æˆæƒ
cp license.lic license.lic.bak

# 3. æ›¿æ¢æ–°æˆæƒ
cp /path/to/new-license.lic ./license.lic

# 4. é‡å¯åº”ç”¨
java -jar contract-tools-sdk-1.0.0.jar
```

### éªŒè¯æ–°æˆæƒ

```bash
# æµ‹è¯•æˆæƒAPI
curl http://localhost:8080/api/auth/license-info

# æ£€æŸ¥æ—¥å¿—
tail -f logs/app.log | grep -i license
```

**é¢„æœŸæ—¥å¿—**ï¼š
```
ä»jaråŒ…åŒçº§ç›®å½•åŠ è½½æ–‡ä»¶: ./license.lic
ä»jaråŒ…åŒçº§ç›®å½•åŠ è½½æ–‡ä»¶: ./publicCerts.store
```

---

## ğŸ“ é…ç½®è¯´æ˜

### application.yml é…ç½®é¡¹

```yaml
zhaoxin:
  auth:
    enabled: true  # æ˜¯å¦å¯ç”¨æˆæƒéªŒè¯
    license:
      file-path: classpath:license.lic  # æˆæƒæ–‡ä»¶è·¯å¾„
    signature:
      public-key-path: classpath:publicCerts.store  # å…¬é’¥è·¯å¾„
```

### è·¯å¾„æ ¼å¼æ”¯æŒ

| æ ¼å¼ | ç¤ºä¾‹ | è¯´æ˜ |
|------|------|------|
| `classpath:` | `classpath:license.lic` | è‡ªåŠ¨æŒ‰ä¼˜å…ˆçº§æŸ¥æ‰¾ï¼ˆæ¨èï¼‰ |
| ç›¸å¯¹è·¯å¾„ | `./license.lic` | ç›¸å¯¹äºjaråŒ…æ‰€åœ¨ç›®å½• |
| ç»å¯¹è·¯å¾„ | `/etc/zhaoxin/license.lic` | æŒ‡å®šå®Œæ•´è·¯å¾„ |
| `file:` | `file:./license.lic` | æ˜¾å¼æŒ‡å®šæ–‡ä»¶ç³»ç»Ÿè·¯å¾„ |

---

## ğŸ³ Dockeréƒ¨ç½²

### Dockerfileç¤ºä¾‹

```dockerfile
FROM openjdk:11-jre-slim

# åˆ›å»ºåº”ç”¨ç›®å½•
WORKDIR /app

# å¤åˆ¶jaråŒ…
COPY target/contract-tools-sdk-1.0.0.jar app.jar

# æš´éœ²ç«¯å£
EXPOSE 8080

# å¯åŠ¨å‘½ä»¤ï¼ˆæˆæƒæ–‡ä»¶é€šè¿‡volumeæŒ‚è½½ï¼‰
ENTRYPOINT ["java", "-jar", "app.jar"]
```

### docker-compose.ymlç¤ºä¾‹

```yaml
version: '3.8'

services:
  contract-tools:
    build: .
    ports:
      - "8080:8080"
    volumes:
      # æŒ‚è½½æˆæƒæ–‡ä»¶åˆ°å®¹å™¨å†…jaråŒ…åŒçº§ç›®å½•
      - ./license.lic:/app/license.lic
      - ./publicCerts.store:/app/publicCerts.store
      # æŒ‚è½½é…ç½®æ–‡ä»¶
      - ./config:/app/config
      # æŒ‚è½½æ—¥å¿—ç›®å½•
      - ./logs:/app/logs
    environment:
      - JAVA_OPTS=-Xmx2g -Xms1g
```

### å¯åŠ¨Dockerå®¹å™¨

```bash
# æ„å»ºé•œåƒ
docker build -t zhaoxin-contract-tools:1.0.0 .

# è¿è¡Œå®¹å™¨
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

---

## ğŸ”§ systemdæœåŠ¡é…ç½®ï¼ˆLinuxï¼‰

### åˆ›å»ºæœåŠ¡æ–‡ä»¶

```bash
sudo vi /etc/systemd/system/zhaoxin-contract-tools.service
```

**å†…å®¹**ï¼š

```ini
[Unit]
Description=Zhaoxin Contract Tools SDK
After=network.target

[Service]
Type=simple
User=zhaoxin
Group=zhaoxin
WorkingDirectory=/opt/zhaoxin-contract-tools
ExecStart=/usr/bin/java -jar /opt/zhaoxin-contract-tools/contract-tools-sdk-1.0.0.jar
Restart=on-failure
RestartSec=10
StandardOutput=append:/opt/zhaoxin-contract-tools/logs/app.log
StandardError=append:/opt/zhaoxin-contract-tools/logs/error.log

[Install]
WantedBy=multi-user.target
```

### å¯ç”¨å’Œå¯åŠ¨æœåŠ¡

```bash
# é‡æ–°åŠ è½½systemdé…ç½®
sudo systemctl daemon-reload

# å¯ç”¨æœåŠ¡ï¼ˆå¼€æœºè‡ªå¯ï¼‰
sudo systemctl enable zhaoxin-contract-tools

# å¯åŠ¨æœåŠ¡
sudo systemctl start zhaoxin-contract-tools

# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status zhaoxin-contract-tools

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u zhaoxin-contract-tools -f
```

---

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šæ‰¾ä¸åˆ°æˆæƒæ–‡ä»¶

**ç—‡çŠ¶**ï¼š
```
Licenseæ–‡ä»¶ä¸å­˜åœ¨: classpath:license.lic
```

**æ’æŸ¥æ­¥éª¤**ï¼š

```bash
# 1. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la /opt/zhaoxin-contract-tools/license.lic
ls -la /opt/zhaoxin-contract-tools/config/license.lic

# 2. æ£€æŸ¥æ–‡ä»¶æƒé™
chmod 644 /opt/zhaoxin-contract-tools/license.lic

# 3. æ£€æŸ¥å·¥ä½œç›®å½•
pwd  # åº”è¯¥åœ¨jaråŒ…æ‰€åœ¨ç›®å½•

# 4. æŸ¥çœ‹æ—¥å¿—ä¸­çš„åŠ è½½ä¿¡æ¯
grep "åŠ è½½æ–‡ä»¶" logs/app.log
```

### é—®é¢˜2ï¼šå…¬é’¥æ–‡ä»¶è¯»å–å¤±è´¥

**ç—‡çŠ¶**ï¼š
```
å…¬é’¥æœªé…ç½®ä¸”å…¬é’¥æ–‡ä»¶ä¸å­˜åœ¨: classpath:publicCerts.store
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# ç¡®ä¿å…¬é’¥æ–‡ä»¶å­˜åœ¨
ls -la publicCerts.store

# æ£€æŸ¥æ–‡ä»¶å†…å®¹
head -n 5 publicCerts.store
# åº”è¯¥çœ‹åˆ°: -----BEGIN PUBLIC KEY-----
```

### é—®é¢˜3ï¼šæˆæƒéªŒè¯å¤±è´¥

**ç—‡çŠ¶**ï¼š
```
Licenseç­¾åéªŒè¯å¤±è´¥
```

**åŸå› **ï¼š
- å…¬é’¥ä¸æˆæƒæ–‡ä»¶ä¸åŒ¹é…
- æˆæƒæ–‡ä»¶è¢«ç¯¡æ”¹

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# é‡æ–°ç”Ÿæˆæˆæƒæ–‡ä»¶ï¼Œç¡®ä¿ä½¿ç”¨é…å¥—çš„å¯†é’¥å¯¹
cd contract-tools-auth-generator
java -jar target/contract-tools-auth-generator-1.0.0-jar-with-dependencies.jar
```

---

## ğŸ“Š æ—¥å¿—ç¤ºä¾‹

### æˆåŠŸåŠ è½½æˆæƒ

```
2025-10-18 18:00:00 [main] INFO  c.z.c.t.a.s.LicenseService - ä»jaråŒ…åŒçº§ç›®å½•åŠ è½½æ–‡ä»¶: ./license.lic
2025-10-18 18:00:00 [main] INFO  c.z.c.t.a.s.LicenseService - ä»jaråŒ…åŒçº§ç›®å½•åŠ è½½æ–‡ä»¶: ./publicCerts.store
2025-10-18 18:00:01 [main] INFO  c.z.c.t.a.s.LicenseService - LicenseéªŒè¯æˆåŠŸ
2025-10-18 18:00:01 [main] INFO  c.z.c.t.a.s.LicenseService - æˆæƒå•ä½: æµ‹è¯•å…¬å¸
2025-10-18 18:00:01 [main] INFO  c.z.c.t.a.s.LicenseService - æˆæƒæœ‰æ•ˆæœŸ: 2025-01-18 ~ 2026-01-18
2025-10-18 18:00:01 [main] INFO  c.z.c.t.a.s.LicenseService - æˆæƒæ¨¡å—: 6ä¸ª
```

### ä»configç›®å½•åŠ è½½

```
2025-10-18 18:00:00 [main] INFO  c.z.c.t.a.s.LicenseService - ä»configç›®å½•åŠ è½½æ–‡ä»¶: ./config/license.lic
2025-10-18 18:00:00 [main] INFO  c.z.c.t.a.s.LicenseService - ä»configç›®å½•åŠ è½½æ–‡ä»¶: ./config/publicCerts.store
```

### å¼€å‘ç¯å¢ƒï¼ˆclasspathï¼‰

```
2025-10-18 18:00:00 [main] INFO  c.z.c.t.a.s.LicenseService - ä»classpathåŠ è½½æ–‡ä»¶: classpath:license.lic
2025-10-18 18:00:00 [main] INFO  c.z.c.t.a.s.LicenseService - ä»classpathåŠ è½½æ–‡ä»¶: classpath:publicCerts.store
```

---

## âš ï¸ é‡è¦æç¤º

### æ–‡ä»¶æƒé™

```bash
# Linux/Macæƒé™è®¾ç½®
chmod 644 license.lic
chmod 644 publicCerts.store
chown zhaoxin:zhaoxin license.lic publicCerts.store
```

### å®‰å…¨å»ºè®®

1. **æˆæƒæ–‡ä»¶ä¿æŠ¤**ï¼š
   - è®¾ç½®é€‚å½“çš„æ–‡ä»¶æƒé™ï¼ˆ644æˆ–æ›´ä¸¥æ ¼ï¼‰
   - å®šæœŸå¤‡ä»½æˆæƒæ–‡ä»¶
   - ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–å®‰å…¨å·¥å…·ç®¡ç†æ•æ„Ÿé…ç½®

2. **å…¬é’¥æ–‡ä»¶**ï¼š
   - å¯ä»¥æ‰“åŒ…åˆ°jarå†…ï¼ˆclasspathï¼‰
   - ä¹Ÿå¯ä»¥å¤–éƒ¨éƒ¨ç½²ï¼Œä¾¿äºæ›´æ–°

3. **ç§é’¥æ–‡ä»¶**ï¼š
   - **ç»å¯¹ä¸è¦**éƒ¨ç½²åˆ°ç”Ÿäº§æœåŠ¡å™¨
   - ä»…åœ¨æˆæƒç”Ÿæˆç¯å¢ƒä¸­ä½¿ç”¨

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»ï¼š

- **ä¼ä¸šç½‘å€**ï¼šhttps://www.zhaoxinms.com
- **æŠ€æœ¯æ”¯æŒ**ï¼šdevelop@zhaoxinms.com
- **æˆæƒå’¨è¯¢**ï¼šè”ç³»å•†åŠ¡å›¢é˜Ÿ

---



