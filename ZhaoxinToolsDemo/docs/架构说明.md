# ZhaoxinToolsDemo 架构说明

## 📋 系统架构

```
┌─────────────┐         ┌─────────────┐         ┌─────────────┐
│   前端      │ ------> │  Demo后端   │ ------> │  肇新后端   │
│ (Vue3)      │         │ (8091)      │         │ (8080)      │
│ Port: 3004  │         │             │         │             │
└─────────────┘         └─────────────┘         └─────────────┘
     |                        |                        |
     |                        |                        |
  所有API请求            API代理转发              核心业务逻辑
  统一到8091              + 业务封装                和功能实现
```

## 🎯 设计原则

### 1. 前端单一连接点
**前端只连接 Demo 后端（8091端口）**

- ✅ 所有 `/api/*` 请求都代理到 Demo 后端
- ❌ 前端不直接连接肇新后端（8080）
- ❌ 前端不配置多个代理目标

**配置文件：** `frontend/vite.config.js`
```javascript
proxy: {
  '/api': {
    target: 'http://localhost:8091',  // Demo 后端地址（所有API都通过Demo后端）
    changeOrigin: true,
  }
}
```

### 2. Demo 后端作为代理层
**Demo 后端负责 API 转发和业务封装**

- ✅ 接收前端请求
- ✅ 转发到肇新后端
- ✅ 封装业务逻辑
- ✅ 返回统一响应格式

**配置文件：** `backend/src/main/resources/application.yml`
```yaml
zhaoxin:
  api:
    base-url: http://localhost:8080  # 肇新后端地址
    timeout: 120000
    connect-timeout: 10000
```

## 📡 API 调用流程

### 示例：文件上传和比对

```
1️⃣ 前端上传文件
   POST http://localhost:3004/api/files/upload
   ↓
   Vite 代理
   ↓
   POST http://localhost:8091/api/files/upload
   ↓
   FileUploadController 保存文件
   ↓
   返回文件 URL

2️⃣ 前端提交比对任务
   POST http://localhost:3004/api/compare/submit
   ↓
   Vite 代理
   ↓
   POST http://localhost:8091/api/compare/submit
   ↓
   CompareController 处理请求
   ↓
   ZhaoxinApiClient 转发到肇新后端
   ↓
   POST http://localhost:8080/api/gpu-ocr-compare/submit-url
   ↓
   返回任务 ID

3️⃣ 前端查询任务状态
   GET http://localhost:3004/api/compare/task/{taskId}
   ↓
   Vite 代理
   ↓
   GET http://localhost:8091/api/compare/task/{taskId}
   ↓
   CompareController 处理请求
   ↓
   ZhaoxinApiClient 转发到肇新后端
   ↓
   GET http://localhost:8080/api/gpu-ocr-compare/task/{taskId}
   ↓
   返回任务状态
```

## 🔧 核心组件

### 前端 (Port: 3004)
- **技术栈**: Vue 3 + Vite + Element Plus
- **职责**: 用户界面、交互逻辑
- **API 客户端**: `src/api/compare.js`, `src/api/extract.js`

### Demo 后端 (Port: 8091)
- **技术栈**: Spring Boot 3
- **职责**: 
  - API 代理转发
  - 业务逻辑封装
  - 文件临时存储
  - 任务状态管理
- **核心类**:
  - `FileUploadController` - 文件上传
  - `CompareController` - 比对功能代理
  - `ExtractController` - 抽取功能代理
  - `ZhaoxinApiClient` - 肇新 API 客户端

### 肇新后端 (Port: 8080)
- **技术栈**: Spring Boot
- **职责**: 核心业务功能实现
- **主要功能**:
  - 智能文档比对
  - 智能文档抽取
  - 智能文档解析
  - 合同智能合成

## 📝 配置清单

### 前端配置
```javascript
// frontend/vite.config.js
server: {
  port: 3004,
  proxy: {
    '/api': {
      target: 'http://localhost:8091',
      changeOrigin: true,
    }
  }
}

// frontend/src/config.js
export const ZHAOXIN_CONFIG = {
  frontendUrl: 'http://localhost:3000',  // 肇新前端（iframe用）
  apiBaseUrl: 'http://localhost:8080',   // 肇新后端（文档参考用）
  demoBaseUrl: 'http://localhost:8091'   // Demo后端（实际API调用）
}
```

### 后端配置
```yaml
# backend/src/main/resources/application.yml
server:
  port: 8091

zhaoxin:
  api:
    base-url: http://localhost:8080
    timeout: 120000
    connect-timeout: 10000
```

## 🌟 优势

### 1. 架构清晰
- 前端不需要关心多个后端地址
- 后端统一管理外部 API 调用
- 便于维护和扩展

### 2. 安全性更好
- 前端无法直接访问肇新后端
- 敏感配置（API 密钥等）只在后端
- 便于添加认证和授权

### 3. 易于部署
- 前端只需配置一个后端地址
- 修改肇新后端地址只需改后端配置
- 支持跨域问题由后端统一处理

### 4. 便于测试和调试
- 可以在 Demo 后端添加日志
- 可以在 Demo 后端进行请求/响应拦截
- 可以轻松切换不同的肇新后端环境

## 🚀 启动顺序

```bash
# 1. 启动肇新后端（8080）
cd zhaoxin-contract-tool-set
java -jar contract-tools.jar

# 2. 启动 Demo 后端（8091）
cd ZhaoxinToolsDemo/backend
mvn spring-boot:run

# 3. 启动前端（3004）
cd ZhaoxinToolsDemo/frontend
npm run dev
```

访问：`http://localhost:3004`

## ⚠️ 注意事项

1. **端口占用**：确保 8080、8091、3004 端口未被占用
2. **启动顺序**：必须先启动肇新后端，再启动 Demo 后端
3. **配置一致性**：确保前端 config.js 和后端 application.yml 的端口配置一致
4. **网络连接**：Demo 后端必须能访问肇新后端（8080）

## 📚 相关文档

- [快速开始](../START_HERE.md)
- [智能文档抽取集成指南](./智能文档抽取集成指南.md)
- [智能文档比对集成指南](./智能文档比对集成指南.md)
- [部署指南](../DEPLOYMENT_GUIDE.md)

