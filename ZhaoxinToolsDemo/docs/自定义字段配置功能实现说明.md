# è‡ªå®šä¹‰å­—æ®µé…ç½®åŠŸèƒ½å®ç°è¯´æ˜

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

å®ç°äº†åœ¨ Demo åç«¯è‡ªå®šä¹‰æ¨¡æ¿è®¾è®¡å™¨å­—æ®µé…ç½®çš„åŠŸèƒ½ã€‚ç”¨æˆ·åœ¨æ¨¡æ¿è®¾è®¡å™¨ä¸­æ’å…¥å­—æ®µæ—¶ï¼Œä¼šä½¿ç”¨ Demo åç«¯å®šä¹‰çš„è‡ªå®šä¹‰å­—æ®µï¼Œè€Œä¸æ˜¯ç³»ç»Ÿé»˜è®¤å­—æ®µã€‚

## ğŸ¯ å®ç°å†…å®¹

### 1. åç«¯å®ç°

#### 1.1 CustomFieldsConfig.java - å­—æ®µé…ç½®æ•°æ®æ¨¡å‹

**æ–‡ä»¶è·¯å¾„**: `ZhaoxinToolsDemo/backend/src/main/java/com/zhaoxin/tools/demo/model/CustomFieldsConfig.java`

**ä¸»è¦å†…å®¹**:
```java
public class CustomFieldsConfig {
    private List<FieldDefinition> baseFields;        // åŸºç¡€å­—æ®µ
    private List<FieldDefinition> clauseFields;      // æ¡æ¬¾å­—æ®µ
    private List<FieldDefinition> counterpartyFields; // ç›¸å¯¹æ–¹å­—æ®µ
    private List<FieldDefinition> sealFields;        // å°ç« å­—æ®µ
    
    public static class FieldDefinition {
        private String tag;          // å­—æ®µå”¯ä¸€æ ‡è¯†
        private String name;         // å­—æ®µæ˜¾ç¤ºåç§°
        private String type;         // å­—æ®µç±»å‹ï¼štextã€richTextã€table
        private String description;  // å­—æ®µæè¿°
        private Boolean richText;    // æ˜¯å¦ä¸ºå¯Œæ–‡æœ¬
        private String category;     // å­—æ®µåˆ†ç±»
    }
}
```

---

#### 1.2 CustomFieldsController.java - å­—æ®µé…ç½®æ¥å£

**æ–‡ä»¶è·¯å¾„**: `ZhaoxinToolsDemo/backend/src/main/java/com/zhaoxin/tools/demo/controller/CustomFieldsController.java`

**ä¸»è¦æ¥å£**:

##### GET `/api/custom-fields/config`

**å‚æ•°**:
- `templateType`ï¼ˆå¯é€‰ï¼‰ï¼šæ¨¡æ¿ç±»å‹
  - `default` - é€šç”¨åˆåŒï¼ˆé»˜è®¤ï¼‰
  - `purchase` - é‡‡è´­åˆåŒ
  - `service` - æœåŠ¡åè®®

**è¿”å›ç¤ºä¾‹**:
```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    "baseFields": [
      {
        "tag": "contract_no",
        "name": "åˆåŒç¼–å·",
        "type": "text",
        "description": "åˆåŒçš„å”¯ä¸€ç¼–å·",
        "richText": false,
        "category": "base"
      },
      {
        "tag": "contract_name",
        "name": "åˆåŒåç§°",
        "type": "text",
        "description": "åˆåŒæ ‡é¢˜æˆ–åç§°",
        "richText": false,
        "category": "base"
      }
    ],
    "clauseFields": [
      {
        "tag": "payment_terms",
        "name": "ä»˜æ¬¾æ¡æ¬¾",
        "type": "richText",
        "description": "ä»˜æ¬¾æ–¹å¼ã€ä»˜æ¬¾æœŸé™ç­‰",
        "richText": true,
        "category": "clause"
      }
    ],
    "counterpartyFields": [
      {
        "tag": "party_a_name",
        "name": "ç”²æ–¹åç§°",
        "type": "text",
        "description": "ç”²æ–¹å…¬å¸å…¨ç§°",
        "richText": false,
        "category": "party"
      }
    ],
    "sealFields": [
      {
        "tag": "party_a_seal",
        "name": "ç”²æ–¹ç›–ç« ",
        "type": "text",
        "description": "ç”²æ–¹å…¬ç« ä½ç½®",
        "richText": false,
        "category": "seal"
      }
    ]
  }
}
```

**é¢„è®¾å­—æ®µé…ç½®**:

##### 1ï¸âƒ£ é€šç”¨åˆåŒå­—æ®µï¼ˆ`templateType=default`ï¼‰

| åˆ†ç±» | å­—æ®µæ ‡è¯† | å­—æ®µåç§° | ç±»å‹ |
|------|---------|---------|------|
| åŸºç¡€ | contract_no | åˆåŒç¼–å· | text |
| åŸºç¡€ | contract_name | åˆåŒåç§° | text |
| åŸºç¡€ | sign_date | ç­¾è®¢æ—¥æœŸ | text |
| åŸºç¡€ | sign_location | ç­¾è®¢åœ°ç‚¹ | text |
| åŸºç¡€ | contract_amount | åˆåŒé‡‘é¢ | text |
| åŸºç¡€ | effective_date | ç”Ÿæ•ˆæ—¥æœŸ | text |
| åŸºç¡€ | expiry_date | åˆ°æœŸæ—¥æœŸ | text |
| æ¡æ¬¾ | payment_terms | ä»˜æ¬¾æ¡æ¬¾ | richText |
| æ¡æ¬¾ | delivery_terms | äº¤ä»˜æ¡æ¬¾ | richText |
| æ¡æ¬¾ | warranty_terms | è´¨ä¿æ¡æ¬¾ | richText |
| æ¡æ¬¾ | breach_clause | è¿çº¦æ¡æ¬¾ | richText |
| æ¡æ¬¾ | dispute_resolution | äº‰è®®è§£å†³ | richText |
| æ¡æ¬¾ | confidentiality | ä¿å¯†æ¡æ¬¾ | richText |
| æ¡æ¬¾ | items_table | å•†å“æ˜ç»†è¡¨ | table |
| ç›¸å¯¹æ–¹ | party_a_name | ç”²æ–¹åç§° | text |
| ç›¸å¯¹æ–¹ | party_a_address | ç”²æ–¹åœ°å€ | text |
| ç›¸å¯¹æ–¹ | party_a_legal_rep | ç”²æ–¹æ³•å®šä»£è¡¨äºº | text |
| ç›¸å¯¹æ–¹ | party_a_contact | ç”²æ–¹è”ç³»äºº | text |
| ç›¸å¯¹æ–¹ | party_a_phone | ç”²æ–¹è”ç³»ç”µè¯ | text |
| ç›¸å¯¹æ–¹ | party_b_name | ä¹™æ–¹åç§° | text |
| ç›¸å¯¹æ–¹ | party_b_address | ä¹™æ–¹åœ°å€ | text |
| ç›¸å¯¹æ–¹ | party_b_legal_rep | ä¹™æ–¹æ³•å®šä»£è¡¨äºº | text |
| ç›¸å¯¹æ–¹ | party_b_contact | ä¹™æ–¹è”ç³»äºº | text |
| ç›¸å¯¹æ–¹ | party_b_phone | ä¹™æ–¹è”ç³»ç”µè¯ | text |
| å°ç«  | party_a_seal | ç”²æ–¹ç›–ç«  | text |
| å°ç«  | party_b_seal | ä¹™æ–¹ç›–ç«  | text |
| å°ç«  | party_a_signature | ç”²æ–¹ä»£è¡¨ç­¾å­— | text |
| å°ç«  | party_b_signature | ä¹™æ–¹ä»£è¡¨ç­¾å­— | text |

##### 2ï¸âƒ£ é‡‡è´­åˆåŒå­—æ®µï¼ˆ`templateType=purchase`ï¼‰

| åˆ†ç±» | å­—æ®µæ ‡è¯† | å­—æ®µåç§° | ç±»å‹ |
|------|---------|---------|------|
| åŸºç¡€ | contract_no | é‡‡è´­åˆåŒç¼–å· | text |
| åŸºç¡€ | contract_name | é‡‡è´­åˆåŒåç§° | text |
| åŸºç¡€ | purchase_date | é‡‡è´­æ—¥æœŸ | text |
| åŸºç¡€ | total_amount | é‡‡è´­æ€»é¢ | text |
| åŸºç¡€ | currency | å¸ç§ | text |
| åŸºç¡€ | delivery_deadline | äº¤è´§æœŸé™ | text |
| æ¡æ¬¾ | purchase_items | é‡‡è´­æ˜ç»† | table |
| æ¡æ¬¾ | quality_standard | è´¨é‡æ ‡å‡† | richText |
| æ¡æ¬¾ | payment_method | ä»˜æ¬¾æ–¹å¼ | richText |
| æ¡æ¬¾ | delivery_method | äº¤è´§æ–¹å¼ | richText |
| æ¡æ¬¾ | inspection_method | éªŒæ”¶æ–¹å¼ | richText |
| æ¡æ¬¾ | after_sales_service | å”®åæœåŠ¡ | richText |
| æ¡æ¬¾ | penalty_clause | è¿çº¦è´£ä»» | richText |
| ç›¸å¯¹æ–¹ | buyer_name | é‡‡è´­æ–¹åç§° | text |
| ç›¸å¯¹æ–¹ | buyer_address | é‡‡è´­æ–¹åœ°å€ | text |
| ç›¸å¯¹æ–¹ | buyer_contact | é‡‡è´­æ–¹è”ç³»äºº | text |
| ç›¸å¯¹æ–¹ | buyer_phone | é‡‡è´­æ–¹ç”µè¯ | text |
| ç›¸å¯¹æ–¹ | supplier_name | ä¾›åº”å•†åç§° | text |
| ç›¸å¯¹æ–¹ | supplier_address | ä¾›åº”å•†åœ°å€ | text |
| ç›¸å¯¹æ–¹ | supplier_contact | ä¾›åº”å•†è”ç³»äºº | text |
| ç›¸å¯¹æ–¹ | supplier_phone | ä¾›åº”å•†ç”µè¯ | text |
| å°ç«  | buyer_seal | é‡‡è´­æ–¹ç›–ç«  | text |
| å°ç«  | supplier_seal | ä¾›åº”å•†ç›–ç«  | text |

##### 3ï¸âƒ£ æœåŠ¡åè®®å­—æ®µï¼ˆ`templateType=service`ï¼‰

| åˆ†ç±» | å­—æ®µæ ‡è¯† | å­—æ®µåç§° | ç±»å‹ |
|------|---------|---------|------|
| åŸºç¡€ | agreement_no | åè®®ç¼–å· | text |
| åŸºç¡€ | agreement_name | åè®®åç§° | text |
| åŸºç¡€ | service_type | æœåŠ¡ç±»å‹ | text |
| åŸºç¡€ | service_fee | æœåŠ¡è´¹ç”¨ | text |
| åŸºç¡€ | service_period | æœåŠ¡æœŸé™ | text |
| åŸºç¡€ | sign_date | ç­¾è®¢æ—¥æœŸ | text |
| æ¡æ¬¾ | service_content | æœåŠ¡å†…å®¹ | richText |
| æ¡æ¬¾ | service_standard | æœåŠ¡æ ‡å‡† | richText |
| æ¡æ¬¾ | payment_schedule | ä»˜è´¹æ–¹å¼ | richText |
| æ¡æ¬¾ | obligations | åŒæ–¹ä¹‰åŠ¡ | richText |
| æ¡æ¬¾ | termination_clause | ç»ˆæ­¢æ¡æ¬¾ | richText |
| æ¡æ¬¾ | confidentiality | ä¿å¯†æ¡æ¬¾ | richText |
| ç›¸å¯¹æ–¹ | client_name | å§”æ‰˜æ–¹åç§° | text |
| ç›¸å¯¹æ–¹ | client_contact | å§”æ‰˜æ–¹è”ç³»äºº | text |
| ç›¸å¯¹æ–¹ | client_phone | å§”æ‰˜æ–¹ç”µè¯ | text |
| ç›¸å¯¹æ–¹ | provider_name | æœåŠ¡æ–¹åç§° | text |
| ç›¸å¯¹æ–¹ | provider_contact | æœåŠ¡æ–¹è”ç³»äºº | text |
| ç›¸å¯¹æ–¹ | provider_phone | æœåŠ¡æ–¹ç”µè¯ | text |
| å°ç«  | client_seal | å§”æ‰˜æ–¹ç›–ç«  | text |
| å°ç«  | provider_seal | æœåŠ¡æ–¹ç›–ç«  | text |

---

### 2. å‰ç«¯å®ç°

#### 2.1 ComposeMain.vue - ä¼ é€’è‡ªå®šä¹‰å­—æ®µé…ç½®URL

**æ–‡ä»¶è·¯å¾„**: `ZhaoxinToolsDemo/frontend/src/views/ComposeMain.vue`

**ä¿®æ”¹å†…å®¹**:
```javascript
const templateManageUrl = computed(() => {
  // æ„å»ºè‡ªå®šä¹‰å­—æ®µé…ç½®URLï¼ˆæŒ‡å‘Demoåç«¯ï¼‰
  const fieldsConfigUrl = encodeURIComponent(
    `${ZHAOXIN_CONFIG.demoBaseUrl}/api/custom-fields/config?templateType=default`
  )
  
  return `${ZHAOXIN_CONFIG.frontendUrl}/templates?fieldsConfigUrl=${fieldsConfigUrl}`
})
```

**è¯´æ˜**:
- åœ¨æ‰“å¼€æ¨¡æ¿ç®¡ç†æ—¶ï¼Œé€šè¿‡ URL å‚æ•° `fieldsConfigUrl` ä¼ é€’è‡ªå®šä¹‰å­—æ®µé…ç½®æ¥å£åœ°å€
- `templateType=default` è¡¨ç¤ºä½¿ç”¨é€šç”¨åˆåŒå­—æ®µ
- URL éœ€è¦è¿›è¡Œç¼–ç ï¼ˆ`encodeURIComponent`ï¼‰

---

#### 2.2 TemplatesLibrary.vue - è¯»å–å¹¶ä¼ é€’å­—æ®µé…ç½®URL

**æ–‡ä»¶è·¯å¾„**: `frontend/src/views/templates/TemplatesLibrary.vue`

**ä¿®æ”¹å†…å®¹**:

##### a) è¯»å–å­—æ®µé…ç½®URL
```typescript
// è‡ªå®šä¹‰å­—æ®µé…ç½®URLï¼ˆä»URLå‚æ•°ä¸­è¯»å–ï¼‰
const fieldsConfigUrl = computed(() => route.query.fieldsConfigUrl as string)
```

##### b) ä¼ é€’ç»™è®¾è®¡å™¨
```typescript
function openDesigner(row: any) {
  const query: any = { 
    id: row.id || row.templateId, 
    fileId: row.fileId,
    returnUrl: '/templates'
  }
  
  // Embed æ¨¡å¼ä¸‹ï¼Œä¿æŒ embed å‚æ•°
  if (isEmbedMode.value) {
    query.embed = 'true'
    query.hideBack = 'true'
  }
  
  // ä¼ é€’è‡ªå®šä¹‰å­—æ®µé…ç½®URLï¼ˆå¦‚æœå­˜åœ¨ï¼‰
  if (fieldsConfigUrl.value) {
    query.fieldsConfigUrl = fieldsConfigUrl.value
    console.log('ğŸ“‹ ä¼ é€’è‡ªå®šä¹‰å­—æ®µé…ç½®URL:', fieldsConfigUrl.value)
  }
  
  router.push({ 
    path: '/template-design', 
    query 
  }) 
}
```

**è¯´æ˜**:
- ä» URL å‚æ•°ä¸­è¯»å– `fieldsConfigUrl`
- åœ¨æ‰“å¼€æ¨¡æ¿è®¾è®¡å™¨æ—¶ï¼Œå°† `fieldsConfigUrl` ä¼ é€’ç»™è®¾è®¡å™¨
- è®¾è®¡å™¨ä¼šä»è¯¥ URL åŠ è½½è‡ªå®šä¹‰å­—æ®µé…ç½®

---

### 3. è·¨åŸŸé…ç½®

#### 3.1 Demo åç«¯ CORS é…ç½®

**æ–‡ä»¶è·¯å¾„**: `ZhaoxinToolsDemo/backend/src/main/java/com/zhaoxin/tools/demo/config/WebConfig.java`

**å·²æœ‰é…ç½®**:
```java
@Override
public void addCorsMappings(CorsRegistry registry) {
    registry.addMapping("/api/**")
            .allowedOriginPatterns(
                "http://localhost:*",     // æ‰€æœ‰ localhost ç«¯å£
                "http://127.0.0.1:*"      // æ‰€æœ‰ 127.0.0.1 ç«¯å£
            )
            .allowedMethods("GET", "POST", "PUT", "DELETE", "OPTIONS")
            .allowedHeaders("*")
            .allowCredentials(true)
            .maxAge(3600);
}
```

**è¯´æ˜**:
- å…è®¸æ‰€æœ‰ `localhost:*` ç«¯å£è®¿é—® Demo åç«¯ API
- ä¸»ç³»ç»Ÿå‰ç«¯ï¼ˆ`http://localhost:3000`ï¼‰å¯ä»¥è®¿é—® Demo åç«¯ï¼ˆ`http://localhost:8091`ï¼‰

---

## ğŸ”„ å®Œæ•´äº¤äº’æµç¨‹

```
ç”¨æˆ·æ“ä½œæµç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ComposeMain.vue (Demo å‰ç«¯)                                  â”‚
â”‚                                                              â”‚
â”‚  1. ç”¨æˆ·ç‚¹å‡»"æ¨¡æ¿ç®¡ç†"æŒ‰é’®                                    â”‚
â”‚     æ„å»ºURL:                                                 â”‚
â”‚     /templates?fieldsConfigUrl=http%3A%2F%2Flocalhost       â”‚
â”‚     %3A8091%2Fapi%2Fcustom-fields%2Fconfig%3F               â”‚
â”‚     templateType%3Ddefault                                   â”‚
â”‚     â†“                                                        â”‚
â”‚  2. æ‰“å¼€ IframeDialogï¼ŒåµŒå…¥ä¸»ç³»ç»Ÿçš„æ¨¡æ¿ç®¡ç†é¡µé¢              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TemplatesLibrary.vue (ä¸»ç³»ç»Ÿ - iframe å†…)                    â”‚
â”‚                                                              â”‚
â”‚  3. ä» URL è¯»å– fieldsConfigUrl å‚æ•°                         â”‚
â”‚  4. ç”¨æˆ·ç‚¹å‡»"è®¾è®¡æ¨¡æ¿"                                        â”‚
â”‚     å°† fieldsConfigUrl ä¼ é€’ç»™è®¾è®¡å™¨                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TemplateDesign.vue (ä¸»ç³»ç»Ÿ - iframe å†…)                      â”‚
â”‚                                                              â”‚
â”‚  5. ä» URL è¯»å– fieldsConfigUrl å‚æ•°                         â”‚
â”‚  6. å‘é€ GET è¯·æ±‚åˆ° fieldsConfigUrl                          â”‚
â”‚     â†’ http://localhost:8091/api/custom-fields/config        â”‚
â”‚     â†“                                                        â”‚
â”‚  7. æ¥æ”¶è‡ªå®šä¹‰å­—æ®µé…ç½®                                        â”‚
â”‚  8. åœ¨å·¦ä¾§å­—æ®µé¢æ¿æ˜¾ç¤ºè‡ªå®šä¹‰å­—æ®µ                              â”‚
â”‚  9. ç”¨æˆ·å¯ä»¥æ’å…¥è‡ªå®šä¹‰å­—æ®µåˆ°æ¨¡æ¿                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CustomFieldsController (Demo åç«¯)                          â”‚
â”‚                                                              â”‚
â”‚ 10. å¤„ç† /api/custom-fields/config è¯·æ±‚                      â”‚
â”‚ 11. æ ¹æ® templateType è¿”å›å¯¹åº”çš„å­—æ®µé…ç½®                      â”‚
â”‚ 12. è¿”å› JSON æ ¼å¼çš„å­—æ®µåˆ—è¡¨                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… æµ‹è¯•æ­¥éª¤

### 1. å¯åŠ¨æ‰€æœ‰æœåŠ¡

```bash
# 1. å¯åŠ¨ä¸»ç³»ç»Ÿåç«¯ (ç«¯å£ 8080)
cd contract-tools-backend
mvn spring-boot:run

# 2. å¯åŠ¨ä¸»ç³»ç»Ÿå‰ç«¯ (ç«¯å£ 3000)
cd frontend
npm run dev

# 3. å¯åŠ¨ Demo åç«¯ (ç«¯å£ 8091)
cd ZhaoxinToolsDemo/backend
mvn spring-boot:run

# 4. å¯åŠ¨ Demo å‰ç«¯ (ç«¯å£ 3004)
cd ZhaoxinToolsDemo/frontend
npm run dev
```

### 2. æµ‹è¯•è‡ªå®šä¹‰å­—æ®µé…ç½®æ¥å£

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š
```
http://localhost:8091/api/custom-fields/config?templateType=default
```

åº”è¯¥çœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹çš„ JSON å“åº”ï¼š
```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    "baseFields": [...],
    "clauseFields": [...],
    "counterpartyFields": [...],
    "sealFields": [...]
  }
}
```

### 3. æµ‹è¯•æ¨¡æ¿è®¾è®¡å™¨é›†æˆ

1. è®¿é—® Demo å‰ç«¯ï¼š`http://localhost:3004/compose-main`
2. ç‚¹å‡»å·¦ä¾§"æ¨¡æ¿ç®¡ç†"æŒ‰é’®
3. åœ¨æ¨¡æ¿åˆ—è¡¨ä¸­ç‚¹å‡»"è®¾è®¡æ¨¡æ¿"
4. åœ¨è®¾è®¡å™¨å·¦ä¾§æŸ¥çœ‹å­—æ®µé¢æ¿
5. **éªŒè¯ç‚¹**ï¼š
   - âœ… å·¦ä¾§æ˜¾ç¤ºçš„æ˜¯è‡ªå®šä¹‰å­—æ®µï¼ˆå¦‚"åˆåŒç¼–å·"ã€"åˆåŒåç§°"ç­‰ï¼‰
   - âœ… ä¸æ˜¯ç³»ç»Ÿé»˜è®¤å­—æ®µ
   - âœ… å­—æ®µæŒ‰åˆ†ç±»æ˜¾ç¤ºï¼ˆåŸºç¡€å­—æ®µã€æ¡æ¬¾å­—æ®µã€ç›¸å¯¹æ–¹å­—æ®µã€å°ç« å­—æ®µï¼‰
   - âœ… å¯ä»¥ç‚¹å‡»å­—æ®µæ’å…¥åˆ°æ¨¡æ¿ä¸­

### 4. æµ‹è¯•ä¸åŒæ¨¡æ¿ç±»å‹

ä¿®æ”¹ `ComposeMain.vue` ä¸­çš„ `templateType` å‚æ•°ï¼š

```javascript
// æµ‹è¯•é‡‡è´­åˆåŒå­—æ®µ
const fieldsConfigUrl = encodeURIComponent(
  `${ZHAOXIN_CONFIG.demoBaseUrl}/api/custom-fields/config?templateType=purchase`
)

// æµ‹è¯•æœåŠ¡åè®®å­—æ®µ
const fieldsConfigUrl = encodeURIComponent(
  `${ZHAOXIN_CONFIG.demoBaseUrl}/api/custom-fields/config?templateType=service`
)
```

---

## ğŸ¨ è‡ªå®šä¹‰å­—æ®µç¤ºä¾‹

### æ·»åŠ æ–°å­—æ®µ

åœ¨ `CustomFieldsController.java` ä¸­æ·»åŠ æ–°å­—æ®µï¼š

```java
// åœ¨ getDefaultFields() æ–¹æ³•ä¸­æ·»åŠ 
baseFields.add(new FieldDefinition(
    "project_name",        // tag
    "é¡¹ç›®åç§°",             // name
    "text",                // type
    "é¡¹ç›®çš„æ­£å¼åç§°",        // description
    false,                 // richText
    "base"                 // category
));
```

### æ·»åŠ å¯Œæ–‡æœ¬å­—æ®µ

```java
clauseFields.add(new FieldDefinition(
    "special_terms",
    "ç‰¹æ®Šæ¡æ¬¾",
    "richText",
    "åˆåŒçš„ç‰¹æ®Šçº¦å®šæ¡æ¬¾",
    true,                  // richText = true
    "clause"
));
```

### æ·»åŠ è¡¨æ ¼å­—æ®µ

```java
clauseFields.add(new FieldDefinition(
    "payment_schedule",
    "ä»˜æ¬¾è®¡åˆ’è¡¨",
    "table",
    "åˆ†æœŸä»˜æ¬¾æ—¶é—´è¡¨",
    false,
    "clause"
));
```

---

## ğŸ”§ é«˜çº§é…ç½®

### 1. åŠ¨æ€å­—æ®µé…ç½®

å¯ä»¥å°†å­—æ®µé…ç½®å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œæ ¹æ®ç”¨æˆ·æƒé™æˆ–ä¸šåŠ¡éœ€æ±‚åŠ¨æ€è¿”å›ï¼š

```java
@GetMapping("/config")
public ApiResponse<CustomFieldsConfig> getCustomFieldsConfig(
        @RequestParam(required = false) String templateType,
        @RequestParam(required = false) String userId) {
    
    // ä»æ•°æ®åº“åŠ è½½ç”¨æˆ·çš„è‡ªå®šä¹‰å­—æ®µé…ç½®
    CustomFieldsConfig config = fieldConfigService.loadByUserId(userId, templateType);
    
    return ApiResponse.success(config);
}
```

### 2. å¤šæ¨¡æ¿ç±»å‹æ”¯æŒ

åœ¨ `ComposeMain.vue` ä¸­ï¼Œå¯ä»¥æ ¹æ®æ¼”ç¤ºæ–‡æ¡£åŠ¨æ€é€‰æ‹©æ¨¡æ¿ç±»å‹ï¼š

```javascript
const handleDemoDocSelect = async (doc) => {
  // æ ¹æ®æ–‡æ¡£ç±»å‹é€‰æ‹©å­—æ®µé…ç½®
  let templateType = 'default'
  if (doc.name.includes('é‡‡è´­')) {
    templateType = 'purchase'
  } else if (doc.name.includes('æœåŠ¡')) {
    templateType = 'service'
  }
  
  // æ›´æ–° fieldsConfigUrl
  const fieldsConfigUrl = encodeURIComponent(
    `${ZHAOXIN_CONFIG.demoBaseUrl}/api/custom-fields/config?templateType=${templateType}`
  )
  
  // ... å…¶ä»–é€»è¾‘
}
```

### 3. å­—æ®µéªŒè¯

åœ¨åç«¯æ·»åŠ å­—æ®µéªŒè¯é€»è¾‘ï¼š

```java
@Data
public static class FieldDefinition {
    @NotBlank(message = "å­—æ®µæ ‡è¯†ä¸èƒ½ä¸ºç©º")
    @Pattern(regexp = "^[a-z_]+$", message = "å­—æ®µæ ‡è¯†åªèƒ½åŒ…å«å°å†™å­—æ¯å’Œä¸‹åˆ’çº¿")
    private String tag;
    
    @NotBlank(message = "å­—æ®µåç§°ä¸èƒ½ä¸ºç©º")
    private String name;
    
    @NotBlank(message = "å­—æ®µç±»å‹ä¸èƒ½ä¸ºç©º")
    @Pattern(regexp = "^(text|richText|table)$", message = "å­—æ®µç±»å‹æ— æ•ˆ")
    private String type;
}
```

---

## ğŸ“ æ³¨æ„äº‹é¡¹

### 1. å­—æ®µæ ‡è¯†å‘½åè§„èŒƒ

- âœ… ä½¿ç”¨å°å†™å­—æ¯å’Œä¸‹åˆ’çº¿ï¼š`contract_no`ã€`party_a_name`
- âŒ é¿å…ä½¿ç”¨é©¼å³°å‘½åï¼š`contractNo`ã€`partyAName`
- âŒ é¿å…ä½¿ç”¨ä¸­æ–‡ï¼š`åˆåŒç¼–å·`

### 2. å­—æ®µç±»å‹è¯´æ˜

| ç±»å‹ | è¯´æ˜ | é€‚ç”¨åœºæ™¯ |
|------|------|---------|
| `text` | çº¯æ–‡æœ¬ | ç®€å•æ–‡æœ¬ï¼Œå¦‚åˆåŒç¼–å·ã€æ—¥æœŸã€é‡‘é¢ |
| `richText` | å¯Œæ–‡æœ¬ï¼ˆHTMLï¼‰ | å¤æ‚æ–‡æœ¬ï¼Œå¦‚æ¡æ¬¾å†…å®¹ã€åè®®è¯´æ˜ |
| `table` | è¡¨æ ¼ | åˆ—è¡¨æ•°æ®ï¼Œå¦‚å•†å“æ˜ç»†ã€ä»˜æ¬¾è®¡åˆ’ |

### 3. CORS é…ç½®

ç¡®ä¿ Demo åç«¯å…è®¸ä¸»ç³»ç»Ÿå‰ç«¯è®¿é—®ï¼š
- ä¸»ç³»ç»Ÿå‰ç«¯ï¼š`http://localhost:3000`
- Demo åç«¯ï¼š`http://localhost:8091`
- CORS é…ç½®å¿…é¡»å…è®¸è·¨åŸŸè¯·æ±‚

### 4. URL ç¼–ç 

`fieldsConfigUrl` å¿…é¡»è¿›è¡Œ URL ç¼–ç ï¼š
```javascript
const fieldsConfigUrl = encodeURIComponent('http://localhost:8091/api/custom-fields/config')
```

---

## ğŸš€ åç»­ä¼˜åŒ–å»ºè®®

1. **å­—æ®µé…ç½®ç®¡ç†ç•Œé¢**ï¼š
   - æä¾›å¯è§†åŒ–ç•Œé¢ï¼Œè®©ç”¨æˆ·è‡ªå·±é…ç½®å­—æ®µ
   - æ”¯æŒå­—æ®µçš„å¢åˆ æ”¹æŸ¥
   - æ”¯æŒå­—æ®µé¡ºåºè°ƒæ•´

2. **å­—æ®µæ¨¡æ¿**ï¼š
   - é¢„è®¾å¤šç§è¡Œä¸šæ¨¡æ¿ï¼ˆé‡‡è´­ã€é”€å”®ã€æœåŠ¡ç­‰ï¼‰
   - æ”¯æŒæ¨¡æ¿çš„å¯¼å…¥å¯¼å‡º
   - æ”¯æŒæ¨¡æ¿çš„å¤åˆ¶å’Œä¿®æ”¹

3. **å­—æ®µæ ¡éªŒ**ï¼š
   - åœ¨åˆåŒåˆæˆæ—¶æ ¡éªŒå¿…å¡«å­—æ®µ
   - æä¾›å­—æ®µæ ¼å¼éªŒè¯ï¼ˆå¦‚æ—¥æœŸæ ¼å¼ã€é‡‘é¢æ ¼å¼ï¼‰
   - æä¾›å­—æ®µé•¿åº¦é™åˆ¶

4. **å­—æ®µæƒé™**ï¼š
   - æ ¹æ®ç”¨æˆ·è§’è‰²æ˜¾ç¤ºä¸åŒå­—æ®µ
   - æ”¯æŒå­—æ®µçš„å¯è§æ€§æ§åˆ¶
   - æ”¯æŒå­—æ®µçš„ç¼–è¾‘æƒé™æ§åˆ¶

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [é›†æˆæ™ºèƒ½åˆåŒåˆæˆ](http://localhost:3000/doc-center?doc=integration-compose)
- [è‡ªå®šä¹‰å…ƒç´ ä½¿ç”¨æŒ‡å—](http://localhost:3000/doc-center?doc=custom-fields-guide)
- [åˆåŒåˆæˆæ¨¡æ¿ç®¡ç†åŠŸèƒ½å®ç°è¯´æ˜](./åˆåŒåˆæˆæ¨¡æ¿ç®¡ç†åŠŸèƒ½å®ç°è¯´æ˜.md)

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒç›¸å…³æ–‡æ¡£æˆ–è”ç³»æŠ€æœ¯æ”¯æŒã€‚

---

## ğŸ“Š æ€»ç»“

âœ… **å·²å®ç°**:
1. Demo åç«¯è‡ªå®šä¹‰å­—æ®µé…ç½®æ¥å£
2. ä¸‰ç§é¢„è®¾å­—æ®µæ¨¡æ¿ï¼ˆé€šç”¨åˆåŒã€é‡‡è´­åˆåŒã€æœåŠ¡åè®®ï¼‰
3. å‰ç«¯ä¼ é€’å­—æ®µé…ç½® URL
4. æ¨¡æ¿è®¾è®¡å™¨è¯»å–å’Œä½¿ç”¨è‡ªå®šä¹‰å­—æ®µ
5. å®Œæ•´çš„è·¨åŸŸé…ç½®

âœ… **æ•ˆæœ**:
- ç”¨æˆ·åœ¨æ¨¡æ¿è®¾è®¡å™¨ä¸­çœ‹åˆ°çš„æ˜¯ Demo åç«¯å®šä¹‰çš„è‡ªå®šä¹‰å­—æ®µ
- ä¸å†ä½¿ç”¨ç³»ç»Ÿé»˜è®¤å­—æ®µ
- å¯ä»¥æ ¹æ®ä¸åŒæ¨¡æ¿ç±»å‹æ˜¾ç¤ºä¸åŒå­—æ®µ
- å®Œå…¨æ§åˆ¶å­—æ®µçš„å®šä¹‰å’Œç®¡ç†

ğŸ‰ **åŠŸèƒ½å·²å®Œæ•´å®ç°ï¼**

