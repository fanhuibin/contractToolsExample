# MinerU LaTeX/Markdown 格式转换功能

## 功能说明

MinerU OCR 服务现在支持自动将 LaTeX/Markdown 格式转换为人类可读的纯文本，参考了 dots.ocr 的公式处理方式。

## 支持的转换格式

### 1. 数学公式
- **行内公式**: `$\Phi 14$` → `Φ 14`
- **行间公式**: `$$...$$` → 去除美元符号

### 2. 希腊字母
- `\Phi` → `Φ`
- `\phi` → `φ`
- `\alpha` → `α`
- `\beta` → `β`
- `\gamma` → `γ`
- `\delta` → `δ`
- `\theta` → `θ`
- `\lambda` → `λ`
- `\pi` → `π`
- `\sigma` → `σ`
- `\omega` → `ω`
- 等等...

### 3. 分数
- `\frac{1}{2}` → `1/2`
- `\frac12` → `1/2`
- `\frac34\%` → `3/4%`

### 4. 文本格式
- `\underline{文本}` → `文本` (去除下划线命令)
- `\underline` → 删除
- `\mathcalL` → `L`
- `\text{内容}` → `内容`
- `\mathbb{R}` → `R`
- `\mathrm{文本}` → `文本`
- `\textbf{粗体}` → `粗体`
- `\textit{斜体}` → `斜体`

### 5. 特殊符号
- `\%` → `%`
- `\text‰` → `‰` (千分号)
- `\\\\\\\\\\` → 删除（多余的反斜杠）
- `\&` → `&`
- `\#` → `#`
- `\_` → `_`
- `\$` → `$`

### 6. 数学运算符
- `\leq` → `≤`
- `\geq` → `≥`
- `\neq` → `≠`
- `\approx` → `≈`
- `\times` → `×`
- `\div` → `÷`
- `\pm` → `±`

### 7. 其他数学符号
- `\sim` 或 `\\sim` → `~` (波浪号，表示范围)
- `\cdot` 或 `\\cdot` → `·` (点乘)
- `\circ` → `°` (圆圈，角度)
- `\infty` → `∞` (无穷)
- `\partial` → `∂` (偏导数)
- `\nabla` → `∇` (梯度)
- `\sum` → `∑` (求和)
- `\int` → `∫` (积分)
- `\prod` → `∏` (乘积)
- `\sqrt{x}` → `√(x)` (平方根)
- `\rightarrow` → `→`
- `\leftarrow` → `←`
- `\Rightarrow` → `⇒`
- `\Leftarrow` → `⇐`

### 8. 上下标
- `x_{i}` → `xi`
- `x^{2}` → `x2`
- `_1`, `^2` → `1`, `2`

### 9. 括号
- `\left(` → `(`
- `\right)` → `)`
- `\left[` → `[`
- `\right]` → `]`

## 使用示例

### 输入示例 1
```
3. 我方保证的金额是主合同约定的工程款的 \\\\\\\\\\ \text‰ ，数额最高不超过人民币元（大写： \\\\\\\\\\ ）。
```

### 输出示例 1
```
3. 我方保证的金额是主合同约定的工程款的 ‰ ，数额最高不超过人民币元（大写：）。
```

### 输入示例 2
```
现在$\Phi 14$
 \underline{\mathcalL}
```

### 输出示例 2
```
现在Φ 14
 L
```

### 输入示例 3
```
或按下列第 \frac12 种方式解决：
\frac34\%
```

### 输出示例 3
```
或按下列第 1/2 种方式解决：
3/4%
```

### 输入示例 4（公式内的特殊情况）
```
(2) 在当年公布的政府保护价的基础上加价  $\frac{3}{4}\%$ ;
```

### 输出示例 4
```
(2) 在当年公布的政府保护价的基础上加价  3/4% ;
```

### 输入示例 5（双反斜杠情况）
```
$5\\%$ （ $5\\% \\sim -25\\%$ ）
```

### 输出示例 5
```
5% （ 5% ~ -25% ）
```

### 输入示例 6（只处理 $ 内的内容）
```
普通文本 $\frac{3}{4}\%$ 和 $\Phi$ 更多文本 \frac{5}{6}
```

### 输出示例 6
```
普通文本 3/4% 和 Φ 更多文本 \frac{5}{6}
```

**说明**：`\frac{5}{6}` 因为不在 `$` 内，所以保持原样不转换。

## 自动应用范围

该转换功能会自动应用于以下所有内容类型：
1. **普通文本** (`handleTextItem`)
2. **公式** (`handleFormulaItem`) - 包括 latex_text 和 formula_caption
3. **表格** (`handleTableItem`) - 包括 table_caption、table_body、table_footnote
4. **列表** (`handleListItem`) - 所有列表项
5. **图片说明** (`handleImageItem`) - figure_caption
6. **代码** (`handleCodeItem`) - code_caption 和 code_body

## 实现位置

转换逻辑在 `MinerUOCRService.java` 中的 `convertLatexToReadableText()` 方法实现。

## 处理逻辑说明

### 核心设计原则

**只处理 `$...$` 或 `$$...$$` 包裹的公式内容，不处理公式外的 LaTeX 命令。**

### 处理流程

1. **逐字符扫描文本**：
   - 遇到 `$$` → 查找下一个 `$$`，提取行间公式内容
   - 遇到 `$` → 查找下一个 `$`，提取行内公式内容
   - 其他字符 → 直接保留

2. **公式内容转换**（只对提取的公式内容进行）：
   - 先处理双反斜杠：`\\%` → 临时占位符
   - 处理 LaTeX 命令：`\frac{3}{4}` → `3/4`，希腊字母等
   - 恢复占位符：临时占位符 → `%`
   - 处理单反斜杠：`\%` → `%`

3. **公式外的内容**：
   - 直接保留原样
   - 只处理通用格式（如连续反斜杠、千分号等）

### 示例说明

```
输入：普通文本 $\frac{3}{4}\%$ 更多文本 \frac{5}{6}
输出：普通文本 3/4% 更多文本 \frac{5}{6}
```

注意：`\frac{5}{6}` 因为不在 `$` 内，所以不会被转换。

## 注意事项

1. 转换是自动进行的，不需要额外配置
2. 转换会保留文本的基本结构和换行
3. 多余的空格会被清理
4. 连续4个或以上的反斜杠会被删除
5. 转换后的文本更易于人类阅读和比对
6. 双反斜杠（如 `\\%`, `\\sim`）会被正确处理
7. 公式内外的格式都会被统一转换

## 测试建议

建议使用包含以下内容的 PDF 进行测试：
- 数学公式
- 希腊字母
- 分数表达式
- 特殊符号（千分号、百分号等）
- 下划线文本
- 上下标

比对转换前后的文本，确认所有 LaTeX/Markdown 格式都被正确转换。

