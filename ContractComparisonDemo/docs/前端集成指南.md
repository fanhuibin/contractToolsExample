# å‰ç«¯é›†æˆæŒ‡å—

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜å¦‚ä½•åœ¨ä½ çš„å‰ç«¯é¡¹ç›®ä¸­é›†æˆè‚‡æ–°åˆåŒæ¯”å¯¹æœåŠ¡ã€‚

## ğŸ“‹ ç›®å½•

- [é›†æˆæ–¹å¼](#é›†æˆæ–¹å¼)
- [iframe åµŒå¥—æ–¹æ¡ˆ](#iframe-åµŒå¥—æ–¹æ¡ˆ)
- [API å¯¹æ¥æ–¹æ¡ˆ](#api-å¯¹æ¥æ–¹æ¡ˆ)
- [æ··åˆæ–¹æ¡ˆï¼ˆæ¨èï¼‰](#æ··åˆæ–¹æ¡ˆæ¨è)
- [å®æˆ˜æ¡ˆä¾‹](#å®æˆ˜æ¡ˆä¾‹)

---

## é›†æˆæ–¹å¼

è‚‡æ–°åˆåŒæ¯”å¯¹æœåŠ¡æä¾›ä¸¤ç§é›†æˆæ–¹å¼ï¼š

| æ–¹å¼ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|------|---------|
| **iframe åµŒå¥—** | é›¶ä»£ç ï¼Œå¿«é€Ÿé›†æˆ | æ ·å¼éš¾ä»¥è‡ªå®šä¹‰ | å¿«é€ŸåŸå‹ï¼Œå†…éƒ¨ç³»ç»Ÿ |
| **API å¯¹æ¥** | å®Œå…¨è‡ªå®šä¹‰ | å¼€å‘å·¥ä½œé‡å¤§ | å“ç‰ŒåŒ–éœ€æ±‚å¼º |
| **æ··åˆæ–¹æ¡ˆ** | å¹³è¡¡å®šåˆ¶ä¸å¼€å‘æˆæœ¬ | éœ€è¦ç†è§£ä¸¤ç§æ–¹å¼ | **æ¨èæ–¹æ¡ˆ** |

---

## iframe åµŒå¥—æ–¹æ¡ˆ

### 1. åŸºç¡€åµŒå¥—

#### åµŒå¥—æ¯”å¯¹é¡µé¢

```html
<iframe 
  src="http://localhost:3000/gpu-ocr-compare" 
  width="100%" 
  height="800px"
  frameborder="0">
</iframe>
```

#### åµŒå¥—ç»“æœé¡µé¢

```html
<iframe 
  src="http://localhost:3000/gpu-ocr-compare/canvas-result/{taskId}" 
  width="100%" 
  height="800px"
  frameborder="0">
</iframe>
```

### 2. åµŒå…¥æ¨¡å¼ï¼ˆéšè—å¯¼èˆªæ ï¼‰

ä¸ºäº†è®© iframe å†…å®¹æ›´åŠ çº¯å‡€ï¼Œå¯ä»¥ä½¿ç”¨**åµŒå…¥æ¨¡å¼**ï¼š

```html
<iframe 
  src="http://localhost:3000/gpu-ocr-compare/canvas-result/{taskId}?embed=true" 
  width="100%" 
  height="800px"
  frameborder="0">
</iframe>
```

**æ•ˆæœ**ï¼š
- âœ… éšè—è‚‡æ–°å‰ç«¯çš„ä¾§è¾¹æ 
- âœ… éšè—é¡¶éƒ¨å¯¼èˆªæ 
- âœ… åªæ˜¾ç¤ºæ ¸å¿ƒæ¯”å¯¹ç»“æœ

### 3. Vue 3 ç¤ºä¾‹

```vue
<template>
  <div class="result-page">
    <iframe :src="iframeUrl" class="result-iframe" />
  </div>
</template>

<script setup>
import { computed } from 'vue'
import { useRoute } from 'vue-router'

const route = useRoute()
const taskId = computed(() => route.params.taskId)

const iframeUrl = computed(() => 
  `http://localhost:3000/gpu-ocr-compare/canvas-result/${taskId.value}?embed=true`
)
</script>

<style scoped>
.result-iframe {
  width: 100%;
  height: 100vh;
  border: none;
  display: block;
}
</style>
```

### 4. React ç¤ºä¾‹

```jsx
import { useParams } from 'react-router-dom';

function ResultPage() {
  const { taskId } = useParams();
  const iframeUrl = `http://localhost:3000/gpu-ocr-compare/canvas-result/${taskId}?embed=true`;
  
  return (
    <div className="result-page">
      <iframe 
        src={iframeUrl}
        className="result-iframe"
        style={{ width: '100%', height: '100vh', border: 'none' }}
      />
    </div>
  );
}

export default ResultPage;
```

### 5. Angular ç¤ºä¾‹

```typescript
import { Component, OnInit } from '@angular/core';
import { ActivatedRoute } from '@angular/router';
import { DomSanitizer, SafeResourceUrl } from '@angular/platform-browser';

@Component({
  selector: 'app-result',
  template: `
    <div class="result-page">
      <iframe [src]="iframeUrl" class="result-iframe"></iframe>
    </div>
  `,
  styles: [`
    .result-iframe {
      width: 100%;
      height: 100vh;
      border: none;
      display: block;
    }
  `]
})
export class ResultComponent implements OnInit {
  iframeUrl: SafeResourceUrl;

  constructor(
    private route: ActivatedRoute,
    private sanitizer: DomSanitizer
  ) {}

  ngOnInit() {
    const taskId = this.route.snapshot.paramMap.get('taskId');
    const url = `http://localhost:3000/gpu-ocr-compare/canvas-result/${taskId}?embed=true`;
    this.iframeUrl = this.sanitizer.bypassSecurityTrustResourceUrl(url);
  }
}
```

### 6. çº¯ HTML ç¤ºä¾‹

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ¯”å¯¹ç»“æœ</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
    }
    .result-iframe {
      width: 100%;
      height: 100vh;
      border: none;
      display: block;
    }
  </style>
</head>
<body>
  <iframe 
    id="resultFrame"
    class="result-iframe">
  </iframe>

  <script>
    // ä» URL è·å– taskId
    const urlParams = new URLSearchParams(window.location.search);
    const taskId = urlParams.get('taskId');
    
    // è®¾ç½® iframe src
    const iframe = document.getElementById('resultFrame');
    iframe.src = `http://localhost:3000/gpu-ocr-compare/canvas-result/${taskId}?embed=true`;
  </script>
</body>
</html>
```

---

## API å¯¹æ¥æ–¹æ¡ˆ

### 1. æ ¸å¿ƒæµç¨‹

```
ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶ â†’ è°ƒç”¨æ¯”å¯¹API â†’ è½®è¯¢çŠ¶æ€ â†’ è·å–ç»“æœ â†’ å±•ç¤ºç»“æœ
```

### 2. API ç«¯ç‚¹

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/compare-pro/submit-url` | POST | æäº¤æ¯”å¯¹ä»»åŠ¡ |
| `/api/compare-pro/task/{taskId}` | GET | æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€ |
| `/api/compare-pro/canvas-result/{taskId}` | GET | è·å–æ¯”å¯¹ç»“æœ |
| `/api/compare-pro/tasks` | GET | è·å–ä»»åŠ¡åˆ—è¡¨ |
| `/api/compare-pro/export-report` | POST | å¯¼å‡ºæŠ¥å‘Š |

è¯¦ç»† API è¯´æ˜è¯·å‚è€ƒ [APIå¯¹æ¥è¯´æ˜.md](./APIå¯¹æ¥è¯´æ˜.md)

### 3. Axios å®¢æˆ·ç«¯ç¤ºä¾‹

```javascript
import axios from 'axios'

const client = axios.create({
  baseURL: 'http://localhost:8080',
  timeout: 60000
})

export default {
  // æäº¤æ¯”å¯¹ä»»åŠ¡
  async submitCompare(oldFileUrl, newFileUrl, options = {}) {
    const { data } = await client.post('/api/compare-pro/submit-url', {
      oldFileUrl,
      newFileUrl,
      removeWatermark: options.removeWatermark || false,
      oldFileName: options.oldFileName || '',
      newFileName: options.newFileName || ''
    })
    return data.data // taskId
  },

  // æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€
  async getTaskStatus(taskId) {
    const { data } = await client.get(`/api/compare-pro/task/${taskId}`)
    return data.data
  },

  // è·å–æ¯”å¯¹ç»“æœ
  async getResult(taskId) {
    const { data } = await client.get(`/api/compare-pro/canvas-result/${taskId}`)
    return data.data
  },

  // è·å–ä»»åŠ¡åˆ—è¡¨
  async getAllTasks() {
    const { data } = await client.get('/api/compare-pro/tasks')
    return data.data
  }
}
```

### 4. è½®è¯¢ä»»åŠ¡çŠ¶æ€

```javascript
async function pollTaskStatus(taskId, onProgress) {
  const maxAttempts = 60 // æœ€å¤šè½®è¯¢ 60 æ¬¡
  const interval = 2000  // æ¯ 2 ç§’è½®è¯¢ä¸€æ¬¡
  
  for (let i = 0; i < maxAttempts; i++) {
    const status = await api.getTaskStatus(taskId)
    
    if (onProgress) {
      onProgress(i / maxAttempts, status)
    }
    
    if (status.status === 'COMPLETED') {
      return status
    }
    
    if (status.status === 'FAILED') {
      throw new Error(status.errorMessage || 'ä»»åŠ¡å¤±è´¥')
    }
    
    await new Promise(resolve => setTimeout(resolve, interval))
  }
  
  throw new Error('ä»»åŠ¡è¶…æ—¶')
}
```

---

## æ··åˆæ–¹æ¡ˆï¼ˆæ¨èï¼‰

**è‡ªå®šä¹‰ä¸Šä¼ é¡µé¢ + iframe åµŒå¥—ç»“æœé¡µ**

### ä¼˜åŠ¿

- âœ… **ä¸Šä¼ é¡µé¢å®Œå…¨è‡ªå®šä¹‰** - ç¬¦åˆå“ç‰Œé£æ ¼
- âœ… **ç»“æœé¡µå¿«é€Ÿé›†æˆ** - é›¶å¼€å‘æˆæœ¬
- âœ… **ç»´æŠ¤æˆæœ¬ä½** - è‚‡æ–°å‡çº§è‡ªåŠ¨åŒæ­¥

### æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ä½ çš„å‰ç«¯      â”‚
â”‚                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ä¸Šä¼ é¡µé¢  â”‚  â”‚ â† è‡ªå®šä¹‰ UI
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚
â”‚        â”‚        â”‚
â”‚        â†“ æäº¤   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Demoåç«¯  â”‚  â”‚ â† API ä»£ç†
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚
â”‚        â”‚        â”‚
â”‚        â†“ è½¬å‘   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚è‚‡æ–°åç«¯   â”‚  â”‚ â† æ ¸å¿ƒæœåŠ¡
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚
â”‚        â”‚        â”‚
â”‚        â†“ taskId â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ç»“æœé¡µé¢  â”‚  â”‚ â† iframe åµŒå¥—
â”‚  â”‚  (iframe) â”‚  â”‚    è‚‡æ–°å‰ç«¯
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å®ç°æ­¥éª¤

#### æ­¥éª¤1ï¼šè‡ªå®šä¹‰ä¸Šä¼ é¡µé¢

```vue
<template>
  <div class="upload-page">
    <h1>åˆåŒæ¯”å¯¹</h1>
    
    <!-- æ–‡ä»¶ä¸Šä¼  -->
    <input type="file" @change="handleOldFile" accept=".pdf,.doc,.docx">
    <input type="file" @change="handleNewFile" accept=".pdf,.doc,.docx">
    
    <!-- æäº¤æŒ‰é’® -->
    <button @click="handleSubmit" :disabled="!canSubmit">
      å¼€å§‹æ¯”å¯¹
    </button>
    
    <!-- è¿›åº¦æ˜¾ç¤º -->
    <div v-if="comparing">
      <progress :value="progress" max="100"></progress>
      <p>{{ statusText }}</p>
    </div>
  </div>
</template>

<script setup>
import { ref } from 'vue'
import { useRouter } from 'vue-router'
import api from '@/api'

const router = useRouter()
const oldFile = ref(null)
const newFile = ref(null)
const comparing = ref(false)
const progress = ref(0)
const statusText = ref('')

const handleOldFile = (e) => {
  oldFile.value = e.target.files[0]
}

const handleNewFile = (e) => {
  newFile.value = e.target.files[0]
}

const handleSubmit = async () => {
  comparing.value = true
  
  try {
    // 1. ä¸Šä¼ æ–‡ä»¶
    progress.value = 20
    statusText.value = 'ä¸Šä¼ æ–‡ä»¶ä¸­...'
    const oldUrl = await uploadFile(oldFile.value)
    const newUrl = await uploadFile(newFile.value)
    
    // 2. æäº¤æ¯”å¯¹
    progress.value = 40
    statusText.value = 'æäº¤æ¯”å¯¹ä»»åŠ¡...'
    const taskId = await api.submitCompare(oldUrl, newUrl)
    
    // 3. è½®è¯¢çŠ¶æ€
    progress.value = 60
    statusText.value = 'æ¯”å¯¹ä¸­...'
    await pollTaskStatus(taskId, (prog) => {
      progress.value = 60 + prog * 40
    })
    
    // 4. è·³è½¬åˆ°ç»“æœé¡µ
    router.push(`/result/${taskId}`)
    
  } catch (error) {
    alert('æ¯”å¯¹å¤±è´¥: ' + error.message)
  } finally {
    comparing.value = false
  }
}
</script>
```

#### æ­¥éª¤2ï¼šç»“æœé¡µé¢ï¼ˆiframeï¼‰

```vue
<template>
  <div class="result-page">
    <iframe :src="resultUrl" class="result-iframe" />
  </div>
</template>

<script setup>
import { computed } from 'vue'
import { useRoute } from 'vue-router'

const route = useRoute()
const taskId = computed(() => route.params.taskId)

const resultUrl = computed(() => 
  `http://localhost:3000/gpu-ocr-compare/canvas-result/${taskId.value}?embed=true`
)
</script>

<style scoped>
.result-iframe {
  width: 100%;
  height: 100vh;
  border: none;
}
</style>
```

---

## å®æˆ˜æ¡ˆä¾‹

æœ¬ Demo é¡¹ç›®é‡‡ç”¨çš„å°±æ˜¯**æ··åˆæ–¹æ¡ˆ**ï¼š

### é¡¹ç›®ç»“æ„

```
frontend-vue/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ views/
â”‚   â”‚   â”œâ”€â”€ Compare.vue     â† è‡ªå®šä¹‰ä¸Šä¼ é¡µé¢
â”‚   â”‚   â””â”€â”€ Result.vue      â† iframe åµŒå¥—ç»“æœé¡µ
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ index.js        â† API å®¢æˆ·ç«¯
```

### æŸ¥çœ‹æºç 

- [Compare.vue](../frontend-vue/src/views/Compare.vue) - ä¸Šä¼ é¡µé¢å®ç°
- [Result.vue](../frontend-vue/src/views/Result.vue) - ç»“æœé¡µé¢å®ç°
- [api/index.js](../frontend-vue/src/api/index.js) - API å®¢æˆ·ç«¯å®ç°

---

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

å»ºè®®ä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç†ä¸åŒç¯å¢ƒçš„é…ç½®ï¼š

```javascript
// config.js
export const ZHAOXIN_CONFIG = {
  frontendUrl: import.meta.env.VITE_ZHAOXIN_FRONTEND_URL || 'http://localhost:3000',
  backendUrl: import.meta.env.VITE_ZHAOXIN_BACKEND_URL || 'http://localhost:8080'
}
```

```.env.development
VITE_ZHAOXIN_FRONTEND_URL=http://localhost:3000
VITE_ZHAOXIN_BACKEND_URL=http://localhost:8080
```

```.env.production
VITE_ZHAOXIN_FRONTEND_URL=https://zhaoxin.example.com
VITE_ZHAOXIN_BACKEND_URL=https://api.zhaoxin.example.com
```

---

## ğŸ“ æ³¨æ„äº‹é¡¹

### 1. CORS é…ç½®

å¦‚æœä½ çš„å‰ç«¯å’Œè‚‡æ–°æœåŠ¡ä¸åœ¨åŒä¸€åŸŸåï¼Œéœ€è¦åœ¨è‚‡æ–°åç«¯é…ç½® CORSï¼š

```java
@Configuration
public class WebConfig implements WebMvcConfigurer {
    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/api/**")
                .allowedOrigins("https://your-domain.com")
                .allowedMethods("GET", "POST", "PUT", "DELETE")
                .allowCredentials(true);
    }
}
```

### 2. æ–‡ä»¶å¤§å°é™åˆ¶

ç¡®ä¿ä½ çš„æœåŠ¡å™¨æ”¯æŒå¤§æ–‡ä»¶ä¸Šä¼ ï¼ˆé»˜è®¤ 50MBï¼‰ï¼š

```yaml
spring:
  servlet:
    multipart:
      max-file-size: 50MB
      max-request-size: 50MB
```

### 3. ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

- ä½¿ç”¨ HTTPS åè®®
- é…ç½®åå‘ä»£ç†ï¼ˆNginxï¼‰
- å¯ç”¨ Gzip å‹ç¼©
- è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´

---

## ğŸ“ æœ€ä½³å®è·µ

1. **ç»Ÿä¸€é…ç½®ç®¡ç†** - æ‰€æœ‰ URL é›†ä¸­åœ¨é…ç½®æ–‡ä»¶
2. **é”™è¯¯å¤„ç†** - æä¾›å‹å¥½çš„é”™è¯¯æç¤º
3. **åŠ è½½çŠ¶æ€** - æ˜¾ç¤ºè¿›åº¦æ¡å’ŒçŠ¶æ€ä¿¡æ¯
4. **å“åº”å¼è®¾è®¡** - æ”¯æŒç§»åŠ¨ç«¯
5. **å®‰å…¨æ€§** - éªŒè¯æ–‡ä»¶ç±»å‹å’Œå¤§å°

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒï¼š
- [APIå¯¹æ¥è¯´æ˜](./APIå¯¹æ¥è¯´æ˜.md)
- [å¿«é€Ÿå¼€å§‹](./å¿«é€Ÿå¼€å§‹.md)
- æˆ–è”ç³»è‚‡æ–°æŠ€æœ¯æ”¯æŒå›¢é˜Ÿ

