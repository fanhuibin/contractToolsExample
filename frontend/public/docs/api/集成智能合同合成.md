# é›†æˆæ™ºèƒ½åˆåŒåˆæˆ

## ğŸ“š æ–‡æ¡£å¯¼èˆª

- [æ™ºèƒ½åˆåŒåˆæˆ - APIç‰ˆæœ¬ æ–‡æ¡£](./æ™ºèƒ½åˆåŒåˆæˆ-APIç‰ˆæœ¬-APIæ–‡æ¡£.md)ï¼šæ¥å£å®šä¹‰ã€è¯·æ±‚ä¸å“åº”
- [åˆåŒåˆæˆæ¨¡æ¿è®¾è®¡æŒ‡å—](./åˆåŒåˆæˆæ¨¡æ¿è®¾è®¡æŒ‡å—.md)ï¼šåœ¨çº¿è®¾è®¡æ¨¡å—ã€å­—æ®µä½“ç³»ã€è‡ªå®šä¹‰å­—æ®µ
- æœ¬æ–‡æ¡£ï¼šåˆæˆåŸç†ã€è·å–æ¨¡æ¿å­—æ®µã€æ„å»ºåˆæˆ JSONã€ç›–ç« ä¸ä¸‹è½½æµç¨‹

---

## ğŸ“˜ æ–‡æ¡£èŒƒå›´

æœ¬æ–‡èšç„¦ **â€œå¦‚ä½•è°ƒç”¨åˆæˆå¼•æ“â€**ï¼Œæ¶µç›–ä»¥ä¸‹ä¸»é¢˜ï¼š

1. åˆåŒåˆæˆæ•´ä½“æ¶æ„ä¸æµç¨‹
2. å¦‚ä½•è·å–æ¨¡æ¿å­—æ®µä¿¡æ¯ï¼ˆæ¥å£æŸ¥è¯¢ã€ç•Œé¢æŸ¥çœ‹å…ƒç´ ï¼‰
3. å¦‚ä½•æ„å»ºåˆæˆè¯·æ±‚ JSONï¼ˆ`values`ã€`stampImageUrls`ã€`extraFiles`ã€`ridingStampUrl`ï¼‰
4. åˆæˆæˆåŠŸåçš„ä¸‹è½½ã€é¢„è§ˆä¸æ‰¹é‡å¤„ç†
5. é”™è¯¯å¤„ç†ã€æ€§èƒ½ä¼˜åŒ–ä¸å¸¸è§é—®é¢˜

> ğŸ’¡ æ¨¡æ¿è®¾è®¡ã€å­—æ®µé…ç½®ã€è®¾è®¡å™¨æ¥å…¥è¯·å‚è€ƒã€ŠåˆåŒåˆæˆæ¨¡æ¿è®¾è®¡æŒ‡å—ã€‹ã€‚

---

## ğŸ“š æ¦‚è¿°

æ™ºèƒ½åˆåŒåˆæˆåŠŸèƒ½å…è®¸é€šè¿‡å¯è§†åŒ–è®¾è®¡åˆåŒæ¨¡æ¿ï¼Œç„¶åé€šè¿‡æ•°æ®é©±åŠ¨çš„æ–¹å¼åŠ¨æ€ç”ŸæˆåˆåŒæ–‡æ¡£ã€‚æœ¬æ–‡æ¡£ä»‹ç»å¦‚ä½•å°†æ­¤åŠŸèƒ½é›†æˆåˆ°ä½ çš„ç³»ç»Ÿä¸­ï¼ˆåˆæˆè§†è§’ï¼‰ã€‚

> âš ï¸ **é‡è¦æç¤º**ï¼š
> - **`values` å’Œ `stampImageUrls` çš„keyå¿…é¡»ä½¿ç”¨tagï¼Œä¸æ˜¯code**
> - tagæ ¼å¼ï¼š`tagElement{code}_{timestamp}_{random}`ï¼Œä¾‹å¦‚ï¼š`tagElementbase_contractCode_1762826537996_2xuxwr`
> - tagä»æ¨¡æ¿æŸ¥è¯¢æ¥å£è¿”å›çš„`elementsJson`ä¸­è·å–
> - ä¸è¦ä½¿ç”¨codeä½œä¸ºkeyï¼Œå¿…é¡»ä½¿ç”¨å®Œæ•´çš„tag

> ğŸ’¡ **å…³äºç¤ºä¾‹ä»£ç **ï¼šæœ¬æ–‡æ¡£ä¸­çš„ä»£ç ç¤ºä¾‹é»˜è®¤åŸºäº **Java + Vue3** æŠ€æœ¯æ ˆï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬æ¨èçš„æŠ€æœ¯ç»„åˆã€‚ä½†è¯·æ³¨æ„ï¼Œ**æˆ‘ä»¬çš„ API æ˜¯è¯­è¨€æ— å…³çš„**ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»»ä½•è¯­è¨€ï¼ˆPythonã€PHPã€.NETã€Go ç­‰ï¼‰å’Œä»»ä½•å‰ç«¯æ¡†æ¶ï¼ˆReactã€Angular ç­‰ï¼‰è¿›è¡Œé›†æˆã€‚æˆ‘ä»¬æä¾› Java ç¤ºä¾‹ä»…ä½œä¸ºå‚è€ƒã€‚

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

- âœ… **æ¨¡æ¿è®¾è®¡å™¨**ï¼šå¯è§†åŒ–è®¾è®¡åˆåŒæ¨¡æ¿ï¼ˆåŸºäº OnlyOfficeï¼‰
- âœ… **ContentControl æ”¯æŒ**ï¼šæ”¯æŒ Word ContentControl å†…å®¹æ§ä»¶
- âœ… **å¯Œæ–‡æœ¬å†…å®¹**ï¼šæ”¯æŒ HTML æ ¼å¼çš„å¯Œæ–‡æœ¬å¡«å……
- âœ… **è¡¨æ ¼æ”¯æŒ**ï¼šæ”¯æŒåŠ¨æ€è¡¨æ ¼æ•°æ®å¡«å……
- âœ… **æ ·å¼ç»§æ‰¿**ï¼šè‡ªåŠ¨ç»§æ‰¿æ¨¡æ¿æ ·å¼
- âœ… **æ‰¹é‡ç”Ÿæˆ**ï¼šæ”¯æŒæ‰¹é‡åˆæˆå¤šä»½åˆåŒ

## ğŸ“‹ æ¨èé›†æˆæ–¹æ¡ˆ

### â­ æ¨èæ–¹æ¡ˆï¼šè‡ªå»ºç®¡ç† + iframe è®¾è®¡å™¨ + API åˆæˆï¼ˆæœ€ä½³å®è·µï¼‰

**æˆ‘ä»¬å¼ºçƒˆå»ºè®®é‡‡ç”¨ä»¥ä¸‹é›†æˆæ–¹å¼ï¼š**

1. **æ¨¡æ¿ç®¡ç†**ï¼šè‡ªå·±å®ç°ï¼ˆAPI é›†æˆï¼‰
   - âœ… åœ¨ä½ çš„ç³»ç»Ÿä¸­å®ç°æ¨¡æ¿åˆ—è¡¨ç•Œé¢
   - âœ… é€šè¿‡ API åˆ›å»ºã€æŸ¥è¯¢ã€åˆ é™¤æ¨¡æ¿
   - âœ… åŒæ­¥åœ¨æˆ‘ä»¬ç³»ç»Ÿä¸­åˆ›å»ºæ¨¡æ¿è®°å½•
   - âœ… å®Œå…¨æ§åˆ¶æ¨¡æ¿çš„ç»„ç»‡å’Œæƒé™

2. **æ¨¡æ¿è®¾è®¡**ï¼šä½¿ç”¨æˆ‘ä»¬çš„è®¾è®¡å™¨ï¼ˆiframe åµŒå…¥ï¼‰
   - âœ… ä¸“ä¸šçš„å¯è§†åŒ–è®¾è®¡ç•Œé¢ï¼ˆåŸºäº OnlyOfficeï¼‰
   - âœ… å¯è§†åŒ–æ’å…¥ ContentControl å­—æ®µ
   - âœ… å®æ—¶é¢„è§ˆå’Œæµ‹è¯•
   - âœ… æ— éœ€å¼€å‘å¤æ‚çš„è®¾è®¡å™¨UI
   - âš ï¸ **ä¸è¦è‡ªå·±å¼€å‘è®¾è®¡å™¨**ï¼ˆæ¶‰åŠ ContentControl æ“ä½œç­‰å¤æ‚åŠŸèƒ½ï¼‰

3. **åˆåŒåˆæˆ**ï¼šä½¿ç”¨ API è°ƒç”¨
   - âœ… çµæ´»æ§åˆ¶åˆæˆæµç¨‹
   - âœ… æ‰¹é‡åˆæˆæ”¯æŒ
   - âœ… è‡ªå®šä¹‰ä¸‹è½½å’Œé¢„è§ˆé€»è¾‘

### é›†æˆæµç¨‹å›¾

```
ä½ çš„ç³»ç»Ÿ                    æˆ‘ä»¬çš„ç³»ç»Ÿ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ¨¡æ¿åˆ—è¡¨é¡µé¢     â”‚ â”€â”€APIâ”€â†’ â”‚ åˆ›å»ºæ¨¡æ¿è®°å½•     â”‚
â”‚ (è‡ªå·±å®ç°)      â”‚        â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç‚¹å‡»"è®¾è®¡æ¨¡æ¿"  â”‚ â”€iframeâ†’â”‚ æ¨¡æ¿è®¾è®¡å™¨       â”‚
â”‚                 â”‚        â”‚ (OnlyOffice)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç‚¹å‡»"ç”ŸæˆåˆåŒ"  â”‚ â”€â”€APIâ”€â†’ â”‚ åˆåŒåˆæˆå¼•æ“     â”‚
â”‚                 â”‚        â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¸‹è½½/é¢„è§ˆåˆåŒ    â”‚
â”‚ (APIè°ƒç”¨)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ–¹æ¡ˆå¯¹æ¯”

| é›†æˆæ–¹å¼ | æ¨¡æ¿ç®¡ç† | æ¨¡æ¿è®¾è®¡ | åˆåŒåˆæˆ | æ¨èæŒ‡æ•° |
|---------|---------|---------|---------|---------|
| **æ¨èæ–¹æ¡ˆ** | è‡ªå·±å®ç° | iframe åµŒå…¥ | API è°ƒç”¨ | â­â­â­â­â­ |
| **å®Œå…¨ iframe** | iframe åµŒå…¥ | iframe åµŒå…¥ | iframe åµŒå…¥ | â­â­â­ |
| **å®Œå…¨ API** | è‡ªå·±å®ç° | è‡ªå·±å¼€å‘ | API è°ƒç”¨ | â­ (ä¸æ¨è) |

> âš ï¸ **é‡è¦æç¤º**ï¼š
> - âœ… **å»ºè®®**ï¼šè‡ªå·±å®ç°æ¨¡æ¿åˆ—è¡¨ç®¡ç†ï¼Œé€šè¿‡ API ä¸æˆ‘ä»¬ç³»ç»ŸåŒæ­¥
> - âœ… **å¿…é¡»**ï¼šä½¿ç”¨æˆ‘ä»¬çš„ iframe è®¾è®¡å™¨è¿›è¡Œæ¨¡æ¿è®¾è®¡
> - âŒ **ä¸è¦**ï¼šè‡ªå·±å¼€å‘æ¨¡æ¿è®¾è®¡å™¨ï¼ˆæŠ€æœ¯å¤æ‚åº¦é«˜ï¼Œå¼€å‘æˆæœ¬å¤§ï¼‰

---

## ğŸ“– é›†æˆæ­¥éª¤ï¼ˆæ¨èæ–¹æ¡ˆï¼‰

### æ­¥éª¤1ï¼šå®ç°æ¨¡æ¿ç®¡ç†ç•Œé¢

åœ¨ä½ çš„ç³»ç»Ÿä¸­åˆ›å»ºæ¨¡æ¿åˆ—è¡¨é¡µé¢ï¼š

```html
<!DOCTYPE html>
<html>
<head>
  <title>åˆåŒæ¨¡æ¿ç®¡ç†</title>
</head>
<body>
  <div class="template-management">
    <h2>åˆåŒæ¨¡æ¿</h2>
    
    <!-- æ¨¡æ¿åˆ—è¡¨ -->
    <table id="templateList">
      <thead>
        <tr>
          <th>æ¨¡æ¿åç§°</th>
          <th>æ¨¡æ¿ç¼–ç </th>
          <th>åˆ›å»ºæ—¶é—´</th>
          <th>æ“ä½œ</th>
        </tr>
      </thead>
      <tbody>
        <!-- é€šè¿‡APIåŠ è½½æ¨¡æ¿åˆ—è¡¨ -->
      </tbody>
    </table>
    
    <button onclick="createTemplate()">æ–°å»ºæ¨¡æ¿</button>
  </div>
  
  <script>
    // 1. åŠ è½½æ¨¡æ¿åˆ—è¡¨ï¼ˆå¯é€‰æŒ‰çŠ¶æ€ç­›é€‰ï¼‰
    async function loadTemplates(status = null) {
      // status å¯é€‰å€¼ï¼šPUBLISHEDï¼ˆå·²å‘å¸ƒï¼‰ã€DRAFTï¼ˆè‰ç¨¿ï¼‰ã€DISABLEDï¼ˆå·²ç¦ç”¨ï¼‰ã€DELETEDï¼ˆå·²åˆ é™¤ï¼‰
      // ä¸ä¼  status å‚æ•°åˆ™è¿”å›æ‰€æœ‰æ¨¡æ¿
      const url = status 
        ? `http://your-domain:8080/api/template/design/list?status=${status}`
        : 'http://your-domain:8080/api/template/design/list';
      
      const response = await fetch(url);
      const result = await response.json();
      
      // æ¸²æŸ“æ¨¡æ¿åˆ—è¡¨
      renderTemplateList(result.data);
    }
    
    // ç¤ºä¾‹ï¼šåªåŠ è½½å·²å‘å¸ƒçš„æ¨¡æ¿
    loadTemplates('PUBLISHED');
    
    // 2. åˆ›å»ºæ–°æ¨¡æ¿
    async function createTemplate() {
      const templateData = {
        templateCode: 'purchase_contract_' + Date.now(),
        templateName: 'é‡‡è´­åˆåŒæ¨¡æ¿',
        templateType: 'contract',
        description: 'æ ‡å‡†é‡‡è´­åˆåŒæ¨¡æ¿'
      };
      
      // è°ƒç”¨APIåˆ›å»ºæ¨¡æ¿è®°å½•
      const response = await fetch('http://your-domain:8080/api/templates', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(templateData)
      });
      
      const result = await response.json();
      if (result.success) {
        const templateId = result.data.id;
        
        // è·³è½¬åˆ°è®¾è®¡å™¨
        openDesigner(templateId);
      }
    }
    
    // 3. æ‰“å¼€è®¾è®¡å™¨ï¼ˆiframeæˆ–æ–°çª—å£ï¼‰
    function openDesigner(templateId) {
      // æ–¹å¼1ï¼šiframeåµŒå…¥
      const designerUrl = `http://your-domain:3000/templates/design?templateId=${templateId}`;
      
      // æ–¹å¼2ï¼šæ–°çª—å£æ‰“å¼€
      window.open(designerUrl, '_blank');
      
      // æ–¹å¼3ï¼šåœ¨å½“å‰é¡µé¢æ˜¾ç¤ºiframe
      showDesignerIframe(designerUrl);
    }
  </script>
</body>
</html>
```

### æ­¥éª¤2ï¼šåµŒå…¥æ¨¡æ¿è®¾è®¡å™¨

å½“ç”¨æˆ·ç‚¹å‡»"è®¾è®¡æ¨¡æ¿"æ—¶ï¼Œä½¿ç”¨ iframe åµŒå…¥æˆ‘ä»¬çš„è®¾è®¡å™¨ï¼š

```html
<!DOCTYPE html>
<html>
<head>
  <title>è®¾è®¡åˆåŒæ¨¡æ¿</title>
</head>
<body>
  <div class="designer-container">
    <div class="toolbar">
      <button onclick="goBack()">è¿”å›åˆ—è¡¨</button>
      <span>æ­£åœ¨è®¾è®¡ï¼šé‡‡è´­åˆåŒæ¨¡æ¿</span>
    </div>
    
    <!-- åµŒå…¥æˆ‘ä»¬çš„è®¾è®¡å™¨ -->
    <iframe 
      id="templateDesigner"
      src="http://your-domain:3000/templates/design?templateId=xxx"
      width="100%"
      height="800px"
      frameborder="0"
      style="border: 1px solid #dcdfe6; border-radius: 4px;"
    ></iframe>
  </div>
  
  <script>
    function goBack() {
      // è¿”å›æ¨¡æ¿åˆ—è¡¨
      window.location.href = '/templates';
    }
  </script>
</body>
</html>
```

> ğŸ’¡ **æç¤º**ï¼šè®¾è®¡å™¨ä¸­çš„"ä¿å­˜"æŒ‰é’®ä¼šè‡ªåŠ¨ä¿å­˜æ¨¡æ¿ï¼Œæ— éœ€åœ¨å¤–éƒ¨é¡µé¢å¤„ç†ä¿å­˜é€»è¾‘ã€‚

---

### ğŸ“‹ è‡ªå®šä¹‰å¯æ’å…¥å…ƒç´ 

è®¾è®¡å™¨æ”¯æŒè‡ªå®šä¹‰å¯æ’å…¥çš„å­—æ®µåˆ—è¡¨ã€‚é€šè¿‡ URL å‚æ•°ä¼ é€’è‡ªå®šä¹‰å­—æ®µï¼Œä½ å¯ä»¥å®Œå…¨æ§åˆ¶ç”¨æˆ·èƒ½æ’å…¥å“ªäº›å­—æ®µåˆ°æ¨¡æ¿ä¸­ã€‚

#### ä¸ºä»€ä¹ˆéœ€è¦è‡ªå®šä¹‰å…ƒç´ ï¼Ÿ

- âœ… **ä¸šåŠ¡å®šåˆ¶**ï¼šä¸åŒè¡Œä¸šã€ä¸åŒåˆåŒç±»å‹éœ€è¦ä¸åŒçš„å­—æ®µ
- âœ… **å­—æ®µæ§åˆ¶**ï¼šåªæ˜¾ç¤ºç”¨æˆ·éœ€è¦çš„å­—æ®µï¼Œéšè—ä¸ç›¸å…³çš„å­—æ®µ
- âœ… **å‘½åç»Ÿä¸€**ï¼šä½¿ç”¨ä½ è‡ªå·±ç³»ç»Ÿçš„å­—æ®µå‘½åè§„èŒƒ

#### å¿«é€Ÿç¤ºä¾‹

```javascript
// 1. åœ¨ä½ çš„ç³»ç»Ÿä¸­æä¾›ä¸€ä¸ªé…ç½®æ¥å£
// GET http://your-system.com/api/get-fields-config?templateType=purchase
// è¿”å›ï¼š
// {
//   "baseFields": [...],
//   "clauseFields": [...],
//   "counterpartyFields": [...],
//   "sealFields": [...]
// }

// 2. æ„å»ºè®¾è®¡å™¨ URLï¼ˆURL åªä¼ æ¥å£åœ°å€ï¼‰
const fieldsConfigUrl = encodeURIComponent(
  'http://your-system.com/api/get-fields-config?templateType=purchase'
);

const designerUrl = `http://editor-domain:3000/templates/design?templateId=${templateId}&fieldsConfigUrl=${fieldsConfigUrl}`;

// 3. åµŒå…¥è®¾è®¡å™¨
document.getElementById('designer-frame').src = designerUrl;

// æˆ–è€…ç›´æ¥åœ¨ HTML ä¸­ï¼š
// <iframe src="http://editor-domain:3000/templates/design?templateId=xxx&fieldsConfigUrl=http%3A%2F%2Fyour-system.com%2Fapi%2Fget-fields-config"></iframe>
```

> ğŸ“– **è¯¦ç»†è¯´æ˜**ï¼š
> - å®Œæ•´çš„å®ç°æ­¥éª¤ã€æ¥å£æ ¼å¼ã€ç¤ºä¾‹ä»£ç è¯·æŸ¥çœ‹ [è‡ªå®šä¹‰å…ƒç´ ä½¿ç”¨æŒ‡å—](./è‡ªå®šä¹‰å…ƒç´ ä½¿ç”¨æŒ‡å—.md)
> - **æ¨èä½¿ç”¨"ç”¨æˆ·æ¥å£"æ–¹å¼**ï¼šå‚è€ƒ OnlyOffice è®¾è®¡ï¼ŒURL æ— é•¿åº¦é™åˆ¶ï¼Œé…ç½®å®Œå…¨ç”±ç”¨æˆ·ç³»ç»Ÿç®¡ç†
> - **ä¼˜åŠ¿**ï¼šæ— éœ€ä¸Šä¼ é…ç½®ï¼Œå®æ—¶æ›´æ–°ï¼Œæ”¯æŒæ— é™å­—æ®µæ•°é‡

---

### ğŸ” æŸ¥çœ‹æ¨¡æ¿å…ƒç´ 

è®¾è®¡å®Œæˆåï¼Œä½ å¯èƒ½éœ€è¦çŸ¥é“æ¨¡æ¿ä¸­æ’å…¥äº†å“ªäº›å­—æ®µï¼Œä»¥ä¾¿åœ¨åˆæˆæ—¶æä¾›å¯¹åº”çš„æ•°æ®ã€‚

#### æ–¹æ³•1ï¼šé€šè¿‡ API æŸ¥è¯¢ï¼ˆæ¨èï¼‰

```javascript
// æŸ¥è¯¢æ¨¡æ¿å·²æ’å…¥çš„å…ƒç´ 
async function getTemplateElements(templateId) {
  const response = await fetch(`http://your-domain:8080/api/templates/${templateId}/elements`);
  const result = await response.json();
  
  if (result.success) {
    const elements = result.data;
    console.log('æ¨¡æ¿å…ƒç´ åˆ—è¡¨:', elements);
    
    // å…ƒç´ æ•°æ®ç»“æ„ç¤ºä¾‹ï¼š
    // [
    //   { code: 'contract_no', name: 'åˆåŒç¼–å·', type: 'text' },
    //   { code: 'amount', name: 'åˆåŒé‡‘é¢', type: 'text' },
    //   { code: 'items', name: 'å•†å“æ˜ç»†', type: 'table' }
    // ]
    
    return elements;
  }
}

// æ ¹æ®å…ƒç´ åˆ—è¡¨ç”ŸæˆåˆåŒæ•°æ®
function generateContractData(elements) {
  const data = {};
  
  elements.forEach(element => {
    if (element.type === 'text') {
      data[element.code] = 'å¾…å¡«å……çš„å€¼';
    } else if (element.type === 'table') {
      data[element.code] = '<table>...</table>';
    }
  });
  
  return data;
}
```

#### æ–¹æ³•2ï¼šä½¿ç”¨"æŸ¥çœ‹å…ƒç´ "ç•Œé¢

å¦‚æœä½ ä½¿ç”¨æˆ‘ä»¬çš„æ¨¡æ¿ç®¡ç†ç•Œé¢ï¼Œå¯ä»¥ç›´æ¥ç‚¹å‡»"æŸ¥çœ‹å…ƒç´ "æŒ‰é’®ï¼š

```html
<!-- æ¨¡æ¿åˆ—è¡¨ä¸­çš„"æŸ¥çœ‹å…ƒç´ "æŒ‰é’® -->
<el-button @click="viewElements(template)">æŸ¥çœ‹å…ƒç´ </el-button>

<script>
  // æ‰“å¼€æŸ¥çœ‹å…ƒç´ å¯¹è¯æ¡†
  function viewElements(template) {
    const viewUrl = `http://your-domain:3000/templates?action=viewElements&templateId=${template.id}`;
    
    // æ–¹å¼1ï¼šæ–°çª—å£æ‰“å¼€
    window.open(viewUrl, '_blank');
    
    // æ–¹å¼2ï¼šåœ¨å¯¹è¯æ¡†ä¸­æ˜¾ç¤º iframe
    showDialog({
      title: 'æŸ¥çœ‹æ¨¡æ¿å…ƒç´ ',
      content: `<iframe src="${viewUrl}" width="100%" height="600px"></iframe>`
    });
  }
</script>
```

#### å…ƒç´ ä¿¡æ¯è¯´æ˜

æŸ¥çœ‹å…ƒç´ åŠŸèƒ½ä¼šè¿”å›ä»¥ä¸‹ä¿¡æ¯ï¼š

| å­—æ®µ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `code` | å­—æ®µç¼–ç ï¼ˆç”¨äºæ•°æ®ç»‘å®šï¼‰ | `contract_no` |
| `name` | å­—æ®µåç§°ï¼ˆæ˜¾ç¤ºåï¼‰ | `åˆåŒç¼–å·` |
| `type` | å­—æ®µç±»å‹ | `text` / `table` / `image` |
| `category` | å­—æ®µåˆ†ç±» | `base` / `clause` / `party` / `seal` |
| `insertedAt` | æ’å…¥æ—¶é—´ | `2025-11-05 18:00:00` |

#### å®Œæ•´ç¤ºä¾‹ï¼šä»æŸ¥çœ‹å…ƒç´ åˆ°åˆæˆåˆåŒ

```javascript
// å®Œæ•´æµç¨‹ç¤ºä¾‹
async function composeContractFlow(templateId) {
  // 1. æŸ¥è¯¢æ¨¡æ¿å…ƒç´ 
  const elements = await getTemplateElements(templateId);
  console.log('æ¨¡æ¿éœ€è¦çš„å­—æ®µ:', elements);
  
  // 2. æ ¹æ®å…ƒç´ å‡†å¤‡æ•°æ®
  const contractData = {
    // åŸºç¡€å­—æ®µ
    contract_no: 'GY-2025-001',
    contract_name: 'é‡‡è´­åˆåŒ',
    sign_date: '2025å¹´11æœˆ5æ—¥',
    
    // æ¡æ¬¾å­—æ®µ
    payment_terms: 'åˆåŒç­¾è®¢å30å¤©å†…ä»˜æ¬¾',
    
    // ç›¸å¯¹æ–¹å­—æ®µ
    party_a_name: 'åŒ—äº¬æŸæŸç§‘æŠ€æœ‰é™å…¬å¸',
    party_b_name: 'ä¸Šæµ·æŸæŸè´¸æ˜“æœ‰é™å…¬å¸',
    
    // è¡¨æ ¼å­—æ®µ
    items: `
      <table>
        <tr><th>å•†å“åç§°</th><th>æ•°é‡</th><th>å•ä»·</th></tr>
        <tr><td>å•†å“A</td><td>10</td><td>100.00</td></tr>
      </table>
    `
  };
  
  // 3. è°ƒç”¨åˆæˆ APIï¼ˆæ¨èä½¿ç”¨æ¨¡æ¿ç¼–å·ï¼‰
  const response = await fetch('http://your-domain:8080/api/compose/sdt', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      templateCode: 'purchase_contract',  // ä½¿ç”¨æ¨¡æ¿ç¼–å·ï¼ˆæ¨èï¼‰
      values: contractData  // æ³¨æ„ï¼šå­—æ®µåæ˜¯ valuesï¼Œä¸æ˜¯ data
    })
  });
  
  const result = await response.json();
  if (result.success) {
    console.log('åˆæˆæˆåŠŸï¼Œæ–‡ä»¶ID:', result.data.fileId);
    
    // 4. ä¸‹è½½åˆåŒ
    downloadContract(result.data.fileId);
  }
}
```

---

### æ­¥éª¤3ï¼šä½¿ç”¨ API åˆæˆåˆåŒ

```javascript
// å‡†å¤‡åˆåŒæ•°æ®
const contractData = {
  "contractNo": "GY-2025-001",
  "contractName": "é‡‡è´­åˆåŒ",
  "partyA": "åŒ—äº¬æŸæŸç§‘æŠ€æœ‰é™å…¬å¸",
  "partyB": "ä¸Šæµ·æŸæŸè´¸æ˜“æœ‰é™å…¬å¸",
  "amount": "1,000,000.00",
  "signDate": "2025å¹´11æœˆ5æ—¥",
  "items": `
    <table style="width:100%; border-collapse:collapse;">
      <tr style="background:#409eff; color:#fff;">
        <th style="border:1px solid #dcdfe6; padding:8px;">åºå·</th>
        <th style="border:1px solid #dcdfe6; padding:8px;">å•†å“åç§°</th>
        <th style="border:1px solid #dcdfe6; padding:8px;">æ•°é‡</th>
        <th style="border:1px solid #dcdfe6; padding:8px;">å•ä»·</th>
        <th style="border:1px solid #dcdfe6; padding:8px;">é‡‘é¢</th>
      </tr>
      <tr>
        <td style="border:1px solid #dcdfe6; padding:8px;">1</td>
        <td style="border:1px solid #dcdfe6; padding:8px;">ç¬”è®°æœ¬ç”µè„‘</td>
        <td style="border:1px solid #dcdfe6; padding:8px;">10</td>
        <td style="border:1px solid #dcdfe6; padding:8px;">8,000.00</td>
        <td style="border:1px solid #dcdfe6; padding:8px;">80,000.00</td>
      </tr>
    </table>
  `
};

// è°ƒç”¨åˆæˆAPIï¼ˆæ¨èä½¿ç”¨æ¨¡æ¿ç¼–å·ï¼‰
async function composeContract(templateCode, data, extraFiles = null, stampImageUrls = null, ridingStampUrl = null) {
  const requestBody = {
    templateCode: templateCode,  // ä½¿ç”¨æ¨¡æ¿ç¼–å·ï¼ˆæ¨èï¼‰
    values: data  // æ³¨æ„ï¼šå­—æ®µåæ˜¯ valuesï¼Œä¸æ˜¯ data
  };
  
  // å¦‚æœéœ€è¦åˆå¹¶é¢å¤–PDFæ–‡ä»¶
  if (extraFiles && extraFiles.length > 0) {
    requestBody.extraFiles = extraFiles;
  }
  
  // å¦‚æœéœ€è¦ç›–æ™®é€šç« 
  if (stampImageUrls) {
    requestBody.stampImageUrls = stampImageUrls;
  }
  
  // å¦‚æœéœ€è¦ç›–éª‘ç¼ç« ï¼ˆç‹¬ç«‹å‚æ•°ï¼‰
  if (ridingStampUrl) {
    requestBody.ridingStampUrl = ridingStampUrl;
  }
  
  const response = await fetch('http://your-domain:8080/api/compose/sdt', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(requestBody)
  });
  
  const result = await response.json();
  
  if (result.code === 200 || result.success) {
    return result.data.fileId;
  } else {
    throw new Error(result.message || 'åˆæˆå¤±è´¥');
  }
}

// ç¤ºä¾‹ï¼šåˆæˆåˆåŒå¹¶åˆå¹¶é™„ä»¶PDFï¼Œç„¶åç›–éª‘ç¼ç« 
async function composeContractWithAttachments() {
  const templateCode = 'purchase_contract';
  
  // 1. è·å–æ¨¡æ¿ä¿¡æ¯ï¼Œæå–tag
  const templateInfo = await getTemplateInfo(templateCode);
  const elements = JSON.parse(templateInfo.elementsJson).elements;
  
  // 2. æ„å»ºvaluesï¼ˆä½¿ç”¨tagä½œä¸ºkeyï¼‰
  const contractData = {};
  elements.forEach(el => {
    if (el.type !== 'seal') { // å°ç« å­—æ®µçš„valueç”±ç³»ç»Ÿç”Ÿæˆ
      // æ ¹æ®å­—æ®µçš„codeè®¾ç½®å€¼ï¼ˆç¤ºä¾‹ï¼‰
      if (el.meta?.code === 'base_contractCode') {
        contractData[el.tag] = 'GY-2025-001';
      } else if (el.meta?.code === 'party_a_name') {
        contractData[el.tag] = 'åŒ—äº¬æŸæŸç§‘æŠ€æœ‰é™å…¬å¸';
      } else if (el.meta?.code === 'party_b_name') {
        contractData[el.tag] = 'ä¸Šæµ·æŸæŸè´¸æ˜“æœ‰é™å…¬å¸';
      }
    }
  });
  
  // éœ€è¦åˆå¹¶çš„é™„ä»¶PDFæ–‡ä»¶URLåˆ—è¡¨
  const extraFiles = [
    'https://example.com/contracts/technical_spec.pdf',
    'https://example.com/contracts/price_list.pdf'
  ];
  
  // 1. è·å–æ¨¡æ¿ä¿¡æ¯ï¼Œè¯†åˆ«å°ç« å­—æ®µ
  const templateInfo = await getTemplateInfo(templateCode);
  const elements = JSON.parse(templateInfo.elementsJson).elements;
  
  // 2. æ‰¾å‡ºæ‰€æœ‰å°ç« å­—æ®µï¼ˆtype === "seal"ï¼‰
  const sealElements = elements.filter(el => el.type === 'seal');
  
  // 3. æ„å»ºæ™®é€šç« å›¾ç‰‡URLæ˜ å°„ï¼ˆkeyä¸ºtagï¼‰
  const stampImageUrls = {};
  sealElements.forEach(seal => {
    stampImageUrls[seal.tag] = {
      normal: `https://example.com/stamps/${seal.meta.code}.png`
    };
  });
  // ç¤ºä¾‹ç»“æœï¼š
  // {
  //   "tagElementseal_party_a_1762827325581_rjhjvg": {
  //     "normal": "https://example.com/stamps/seal_party_a.png"
  //   },
  //   "tagElementseal_party_b_1762827344941_0yfagr": {
  //     "normal": "https://example.com/stamps/seal_party_b.png"
  //   }
  // }
  
  // 4. éª‘ç¼ç« å›¾ç‰‡URLï¼ˆç‹¬ç«‹å‚æ•°ï¼Œå¯é€‰ï¼Œä¸ç»‘å®šä»»ä½•å­—æ®µï¼‰
  const ridingStampUrl = 'https://example.com/stamps/riding_seal.png';
  
  const fileId = await composeContract(templateCode, contractData, extraFiles, stampImageUrls, ridingStampUrl);
  console.log('åˆåŒåˆæˆæˆåŠŸï¼Œæ–‡ä»¶ID:', fileId);
  
  // ä¸‹è½½åˆåŒ
  downloadContract(fileId);
}

// æˆ–è€…ä½¿ç”¨æ¨¡æ¿æ–‡ä»¶IDï¼ˆå‘åå…¼å®¹ï¼‰
async function composeContractByFileId(templateFileId, data) {
  const response = await fetch('http://your-domain:8080/api/compose/sdt', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      templateFileId: templateFileId,  // ä½¿ç”¨æ¨¡æ¿æ–‡ä»¶ID
      values: data
    })
  });
  
  const result = await response.json();
  
  if (result.code === 200 || result.success) {
    return result.data.fileId;
  } else {
    throw new Error(result.message || 'åˆæˆå¤±è´¥');
  }
}

// ä¸‹è½½åˆæˆçš„åˆåŒ
async function downloadContract(fileId) {
  window.open(`http://your-domain:8080/api/onlyoffice/download/${fileId}`);
}

// å®Œæ•´æµç¨‹ï¼ˆä½¿ç”¨æ¨¡æ¿ç¼–å·ï¼‰
async function generateContract() {
  try {
    // 1. åˆæˆåˆåŒï¼ˆä½¿ç”¨æ¨¡æ¿ç¼–å·ï¼Œæ¨èæ–¹å¼ï¼‰
    const templateCode = 'purchase_contract';  // æ¨¡æ¿ç¼–å·
    const fileId = await composeContract(templateCode, contractData);
    console.log('åˆåŒåˆæˆæˆåŠŸï¼Œæ–‡ä»¶ID:', fileId);
    
    // 2. ä¸‹è½½åˆåŒ
    downloadContract(fileId);
    
  } catch (error) {
    console.error('åˆåŒç”Ÿæˆå¤±è´¥:', error);
    alert('ç”Ÿæˆå¤±è´¥: ' + error.message);
  }
}

// å®Œæ•´æµç¨‹ï¼šåˆåŒ + é™„ä»¶PDF + éª‘ç¼ç« 
async function generateContractWithAttachments() {
  try {
    const templateCode = 'purchase_contract';
    const contractData = {
      contractNo: 'GY-2025-001',
      partyA: 'åŒ—äº¬æŸæŸç§‘æŠ€æœ‰é™å…¬å¸',
      partyB: 'ä¸Šæµ·æŸæŸè´¸æ˜“æœ‰é™å…¬å¸',
      amount: '1,000,000.00'
    };
    
    // éœ€è¦åˆå¹¶çš„é™„ä»¶PDF
    const extraFiles = [
      'https://example.com/contracts/attachment1.pdf',
      'https://example.com/contracts/attachment2.pdf'
    ];
    
    // 1. è·å–æ¨¡æ¿ä¿¡æ¯ï¼Œè¯†åˆ«å°ç« å­—æ®µ
    const templateInfo = await getTemplateInfo(templateCode);
    const elements = JSON.parse(templateInfo.elementsJson).elements;
    const sealElements = elements.filter(el => el.type === 'seal');
    
    // 2. æ„å»ºæ™®é€šç« å›¾ç‰‡URLæ˜ å°„ï¼ˆkeyä¸ºtagï¼‰
    const stampImageUrls = {};
    sealElements.forEach(seal => {
      stampImageUrls[seal.tag] = {
        normal: `https://example.com/stamps/${seal.meta.code}.png`
      };
    });
    
    // 3. éª‘ç¼ç« å›¾ç‰‡URLï¼ˆç‹¬ç«‹å‚æ•°ï¼Œå¯é€‰ï¼Œä¸ç»‘å®šä»»ä½•å­—æ®µï¼‰
    const ridingStampUrl = 'https://example.com/stamps/riding_seal.png';
    
    // 4. åˆæˆåˆåŒï¼ˆä¼šè‡ªåŠ¨åˆå¹¶é™„ä»¶PDFå¹¶ç›–éª‘ç¼ç« ï¼‰
    const fileId = await composeContract(templateCode, contractData, extraFiles, stampImageUrls, ridingStampUrl);
    console.log('åˆåŒåˆæˆæˆåŠŸï¼ˆå·²åˆå¹¶é™„ä»¶å¹¶ç›–ç« ï¼‰ï¼Œæ–‡ä»¶ID:', fileId);
    
    // 2. ä¸‹è½½åˆåŒ
    downloadContract(fileId);
    
  } catch (error) {
    console.error('åˆåŒç”Ÿæˆå¤±è´¥:', error);
    alert('ç”Ÿæˆå¤±è´¥: ' + error.message);
  }
}
```

### æ­¥éª¤4ï¼šé¢„è§ˆåˆæˆç»“æœ

```html
<!-- é¢„è§ˆç”Ÿæˆçš„åˆåŒ -->
<iframe 
  id="contractPreview"
  src="http://your-domain:3000/onlyoffice/editor?fileId=xxx&canEdit=false"
  width="100%"
  height="800px"
  frameborder="0"
></iframe>

<script>
  // é¢„è§ˆåˆåŒ
  async function previewContract() {
  // åˆæˆåˆåŒï¼ˆä½¿ç”¨æ¨¡æ¿ç¼–å·ï¼‰
  const templateCode = 'purchase_contract';  // æ¨¡æ¿ç¼–å·
  const fileId = await composeContract(templateCode, contractData);
    
    // åœ¨iframeä¸­æ˜¾ç¤º
    document.getElementById('contractPreview').src = 
      `http://your-domain:3000/onlyoffice/editor?fileId=${fileId}&canEdit=false`;
  }
</script>
```

---

## ğŸ“š å®Œæ•´ API å‚è€ƒ

### 1. æ¨¡æ¿ç®¡ç† API

> ğŸ“– **è¯¦ç»†è¯´æ˜**ï¼šæ¨¡æ¿ç®¡ç†çš„å®Œæ•´ API æ–‡æ¡£è¯·æŸ¥çœ‹ [æ™ºèƒ½åˆåŒåˆæˆ API æ–‡æ¡£](./æ™ºèƒ½åˆåŒåˆæˆ-APIç‰ˆæœ¬-APIæ–‡æ¡£.md)

#### åˆ›å»ºæ¨¡æ¿

```http
POST /api/templates
Content-Type: application/json

{
  "templateCode": "purchase_contract",
  "templateName": "é‡‡è´­åˆåŒæ¨¡æ¿",
  "templateType": "contract",
  "description": "æ ‡å‡†é‡‡è´­åˆåŒæ¨¡æ¿"
}
```

#### æŸ¥è¯¢æ¨¡æ¿åˆ—è¡¨

```http
GET /api/template/design/list?status={status}
```

**æŸ¥è¯¢å‚æ•°**ï¼š
- `status`ï¼ˆå¯é€‰ï¼‰ï¼šæ¨¡æ¿çŠ¶æ€ç­›é€‰
  - `PUBLISHED`ï¼šå·²å‘å¸ƒï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èåªä½¿ç”¨å·²å‘å¸ƒçš„æ¨¡æ¿ï¼‰
  - `DRAFT`ï¼šè‰ç¨¿
  - `DISABLED`ï¼šå·²ç¦ç”¨
  - `DELETED`ï¼šå·²åˆ é™¤
  - ä¸ä¼ åˆ™è¿”å›æ‰€æœ‰çŠ¶æ€çš„æ¨¡æ¿

**è¿”å›ç¤ºä¾‹**ï¼š
```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": [
    {
      "id": "244414270903816192",
      "templateCode": "purchase_contract",
      "templateName": "é‡‡è´­åˆåŒæ¨¡æ¿",
      "version": "1.0",
      "fileId": "244414270018818048",
      "status": "PUBLISHED",
      "description": "æ ‡å‡†é‡‡è´­åˆåŒæ¨¡æ¿",
      "createdAt": "2025-11-05T10:55:03",
      "updatedAt": "2025-11-05T17:57:12"
    }
  ]
}
```

#### åˆ é™¤æ¨¡æ¿

```http
DELETE /api/templates/{templateId}
```

### 2. åˆåŒåˆæˆ API

#### æ–¹å¼1ï¼šä½¿ç”¨æ¨¡æ¿ç¼–å·ï¼ˆæ¨èï¼‰

```http
POST /api/compose/sdt
Content-Type: application/json

{
  "templateCode": "purchase_contract",
  "values": {
    "tagElementbase_contractCode_1762826537996_2xuxwr": "GY-2025-001",
    "tagElementparty_a_name_1762826807666_4dgdl6": "åŒ—äº¬æŸæŸç§‘æŠ€æœ‰é™å…¬å¸",
    "tagElementparty_b_name_1762826824516_08dxc4": "ä¸Šæµ·æŸæŸè´¸æ˜“æœ‰é™å…¬å¸",
    "tagElementbase_signLocation_1762826575800_m9nit8": "åŒ—äº¬å¸‚",
    "tagElementbase_productTable_1762826784646_hl679b": "<table>...</table>"
  }
}
```

#### æ–¹å¼1æ‰©å±•ï¼šåŒ…å«é¢å¤–PDFæ–‡ä»¶ï¼ˆåˆå¹¶åå†ç›–éª‘ç¼ç« ï¼‰

```http
POST /api/compose/sdt
Content-Type: application/json

{
  "templateCode": "purchase_contract",
  "values": {
    "contractNo": "GY-2025-001",
    "partyA": "åŒ—äº¬æŸæŸç§‘æŠ€æœ‰é™å…¬å¸",
    "partyB": "ä¸Šæµ·æŸæŸè´¸æ˜“æœ‰é™å…¬å¸",
    "amount": "1,000,000.00",
    "signDate": "2025å¹´11æœˆ5æ—¥"
  },
  "extraFiles": [
    "https://example.com/contracts/attachment1.pdf",
    "https://example.com/contracts/attachment2.pdf"
  ],
  "stampImageUrls": {
    "tagElementseal_party_a_1762827325581_rjhjvg": {
      "normal": "https://example.com/stamps/seal_party_a.png"
    },
    "tagElementseal_party_b_1762827344941_0yfagr": {
      "normal": "https://example.com/stamps/seal_party_b.png"
    }
  },
  "ridingStampUrl": "https://example.com/stamps/riding_seal.png"
}
```

> ğŸ’¡ **PDFåˆå¹¶åŠŸèƒ½è¯´æ˜**ï¼š
> - `extraFiles` å­—æ®µç”¨äºæŒ‡å®šéœ€è¦åˆå¹¶çš„é¢å¤–PDFæ–‡ä»¶URLåˆ—è¡¨
> - ç³»ç»Ÿä¼šè‡ªåŠ¨ä¸‹è½½è¿™äº›PDFæ–‡ä»¶å¹¶åˆå¹¶åˆ°ä¸»åˆåŒPDFåé¢
> - åˆå¹¶é¡ºåºï¼šä¸»åˆåŒPDF + extraFiles[0] + extraFiles[1] + ...
> - **åˆå¹¶å®Œæˆåå†è¿›è¡Œç›–ç« æ“ä½œ**
> - å¦‚æœæŸä¸ªPDFä¸‹è½½å¤±è´¥ï¼Œä¼šè·³è¿‡è¯¥æ–‡ä»¶ç»§ç»­å¤„ç†å…¶ä»–æ–‡ä»¶
> - é€‚ç”¨äºéœ€è¦å°†åˆåŒæ­£æ–‡ä¸é™„ä»¶ã€è¡¥å……åè®®ç­‰åˆå¹¶çš„åœºæ™¯

> ğŸ’¡ **éª‘ç¼ç« è¯´æ˜**ï¼š
> - `ridingStampUrl` æ˜¯**ç‹¬ç«‹çš„å‚æ•°**ï¼Œç”¨äºæŒ‡å®šéª‘ç¼ç« å›¾ç‰‡URL
> - **åªæœ‰æ˜ç¡®æä¾›äº† `ridingStampUrl` æ‰ä¼šç›–éª‘ç¼ç« **ï¼Œä¸ä¼šè‡ªåŠ¨ä»å…¶ä»–å‚æ•°ä¸­è·å–
> - `stampImageUrls` ä»…ç”¨äºæ™®é€šç« ï¼ˆnormalï¼‰ï¼Œä¸å†åŒ…å« riding å­—æ®µ
> - éª‘ç¼ç« ä¼šåœ¨åˆå¹¶åçš„å®Œæ•´PDFä¸Šç›–ç« ï¼ˆåŒ…æ‹¬ä¸»åˆåŒå’Œæ‰€æœ‰é™„ä»¶ï¼‰

> ğŸ’¡ **æ¨èä½¿ç”¨æ¨¡æ¿ç¼–å·ï¼ˆtemplateCodeï¼‰**ï¼š
> - âœ… **æ”¯æŒå¤šç‰ˆæœ¬**ï¼šåŒä¸€æ¨¡æ¿ç¼–å·å¯ä»¥æœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨é€‰æ‹©å·²å‘å¸ƒçš„ç‰ˆæœ¬
> - âœ… **ä¸šåŠ¡å‹å¥½**ï¼šä½¿ç”¨æœ‰æ„ä¹‰çš„ç¼–å·ï¼ˆå¦‚ `purchase_contract`ï¼‰è€Œä¸æ˜¯æ•°å­—ID
> - âœ… **ç‰ˆæœ¬ç®¡ç†**ï¼šæ¨¡æ¿æ›´æ–°åï¼Œç¼–å·ä¸å˜ï¼Œç³»ç»Ÿè‡ªåŠ¨ä½¿ç”¨æœ€æ–°å·²å‘å¸ƒç‰ˆæœ¬
> - âš ï¸ **æ³¨æ„**ï¼šå¦‚æœæä¾›äº† `templateCode`ï¼Œç³»ç»Ÿä¼šä¼˜å…ˆä½¿ç”¨å®ƒï¼›å¦‚æœæœªæ‰¾åˆ°å·²å‘å¸ƒç‰ˆæœ¬ï¼Œä¼šå°è¯•è·å–æœ€æ–°ç‰ˆæœ¬

#### æ–¹å¼2ï¼šä½¿ç”¨æ¨¡æ¿æ–‡ä»¶IDï¼ˆå‘åå…¼å®¹ï¼‰

```http
POST /api/compose/sdt
Content-Type: application/json

{
  "templateFileId": "1234567890",
  "values": {
    "contractNo": "GY-2025-001",
    "partyA": "åŒ—äº¬æŸæŸç§‘æŠ€æœ‰é™å…¬å¸",
    "partyB": "ä¸Šæµ·æŸæŸè´¸æ˜“æœ‰é™å…¬å¸",
    "amount": "1,000,000.00",
    "signDate": "2025å¹´11æœˆ5æ—¥",
    "items": "<table>...</table>"
  }
}
```

> âš ï¸ **å‚æ•°è¯´æ˜**ï¼š
> - `templateCode` å’Œ `templateFileId` è‡³å°‘æä¾›ä¸€ä¸ª
> - å¦‚æœåŒæ—¶æä¾›ï¼Œä¼˜å…ˆä½¿ç”¨ `templateCode`
> - `values` å­—æ®µåå·²æ›´æ–°ï¼ˆä¹‹å‰æ˜¯ `data`ï¼Œç°åœ¨ç»Ÿä¸€ä¸º `values`ï¼‰

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
  "code": 200,
  "message": "åˆåŒåˆæˆæˆåŠŸ",
  "data": {
    "fileId": "9876543210",
    "fileName": "é‡‡è´­åˆåŒ-GY-2025-001.docx",
    "downloadUrl": "/api/onlyoffice/download/9876543210",
    "previewUrl": "/api/onlyoffice/editor?fileId=9876543210",
    "generatedTime": "2025-11-05 18:05:00"
  },
  "success": true
}
```

### 3. æ‰¹é‡åˆæˆ API

```http
POST /api/compose/batch
Content-Type: application/json

{
  "templateFileId": "1234567890",
  "dataList": [
    {
      "contractNo": "GY-2025-001",
      "partyA": "åŒ—äº¬æŸæŸç§‘æŠ€æœ‰é™å…¬å¸",
      "partyB": "ä¸Šæµ·æŸæŸè´¸æ˜“æœ‰é™å…¬å¸",
      "amount": "1,000,000.00"
    },
    {
      "contractNo": "GY-2025-002",
      "partyA": "åŒ—äº¬æŸæŸç§‘æŠ€æœ‰é™å…¬å¸",
      "partyB": "æ·±åœ³æŸæŸç”µå­æœ‰é™å…¬å¸",
      "amount": "500,000.00"
    }
  ]
}
```

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
  "code": 200,
  "data": {
    "batchId": "batch-20251105-001",
    "totalCount": 2,
    "successCount": 2,
    "results": [
      {
        "index": 0,
        "status": "success",
        "fileId": "9876543210",
        "fileName": "é‡‡è´­åˆåŒ-GY-2025-001.docx"
      },
      {
        "index": 1,
        "status": "success",
        "fileId": "9876543211",
        "fileName": "é‡‡è´­åˆåŒ-GY-2025-002.docx"
      }
    ]
  },
  "success": true
}
```

---

## ğŸ“ ContentControl å­—æ®µå®šä¹‰

åœ¨ Word æ¨¡æ¿ä¸­ä½¿ç”¨ **å¼€å‘å·¥å…·** â†’ **å†…å®¹æ§ä»¶** åˆ›å»ºå­—æ®µã€‚

### å­—æ®µå‘½åè§„èŒƒ

```
å­—æ®µæ ‡è®°(Tag) = å­—æ®µä»£ç 
ä¾‹å¦‚ï¼šcontractNo, partyA, items
```

### æ”¯æŒçš„å†…å®¹ç±»å‹

#### 1. çº¯æ–‡æœ¬

```json
{
  "contractNo": "GY-2025-001",
  "partyA": "åŒ—äº¬æŸæŸç§‘æŠ€æœ‰é™å…¬å¸"
}
```

#### 2. å¯Œæ–‡æœ¬ï¼ˆHTMLï¼‰

```json
{
  "title": "<b>é‡‡è´­åˆåŒ</b>",
  "description": "æœ¬åˆåŒç”±<span style='color:red;'>ç”²æ–¹</span>å’Œ<span style='color:blue;'>ä¹™æ–¹</span>ç­¾è®¢ã€‚",
  "importantNotice": "è¯·æ³¨æ„ï¼š<mark>æ­¤æ¡æ¬¾ä¸ºå¿…å¡«é¡¹</mark>ï¼Œä¸èƒ½ä¸ºç©ºã€‚",
  "highlightedText": "<span style='background-color: #ffeb3b;'>é‡è¦æç¤ºï¼šè¯·ä»”ç»†é˜…è¯»</span>"
}
```

**æ”¯æŒçš„æ ¼å¼**ï¼š
- **ç²—ä½“/æ–œä½“/ä¸‹åˆ’çº¿**ï¼š`<b>ç²—ä½“</b>`ã€`<i>æ–œä½“</i>`ã€`<u>ä¸‹åˆ’çº¿</u>`
- **é¢œè‰²**ï¼š`<span style="color: #409eff;">è“è‰²æ–‡å­—</span>`
- **é«˜äº®/èƒŒæ™¯è‰²**ï¼š
  - ä½¿ç”¨ `<mark>` æ ‡ç­¾ï¼ˆé»˜è®¤é»„è‰²èƒŒæ™¯ï¼‰ï¼š`<mark>é«˜äº®æ–‡æœ¬</mark>`
  - ä½¿ç”¨ CSS æ ·å¼è‡ªå®šä¹‰é¢œè‰²ï¼š`<mark style="background-color: #ff9800;">æ©™è‰²é«˜äº®</mark>`
  - ä½¿ç”¨ span æ ‡ç­¾ï¼š`<span style="background-color: yellow;">é»„è‰²èƒŒæ™¯</span>`
- **åˆ é™¤çº¿**ï¼š`<s>åˆ é™¤çš„æ–‡æœ¬</s>` æˆ– `<del>åˆ é™¤çš„æ–‡æœ¬</del>`
- **ç»„åˆæ–‡æœ¬è£…é¥°**ï¼š`<span style="text-decoration: underline line-through;">ä¸‹åˆ’çº¿+åˆ é™¤çº¿</span>`ï¼ˆåŒæ—¶åº”ç”¨å¤šç§è£…é¥°ï¼‰
- **ä¸Šæ ‡/ä¸‹æ ‡**ï¼š`H<sub>2</sub>O`ï¼ˆæ°´ï¼‰ã€`x<sup>2</sup>`ï¼ˆå¹³æ–¹ï¼‰

> ğŸ“– æ›´å¤šHTMLæ ·å¼æ”¯æŒè¯·å‚è€ƒï¼š[æ–‡æ¡£åˆæˆåŠŸèƒ½æ”¯æŒè¯´æ˜](./æ–‡æ¡£åˆæˆåŠŸèƒ½æ”¯æŒè¯´æ˜.md)

#### 3. è¡¨æ ¼

```json
{
  "items": `
    <table style="width:100%; border-collapse:collapse;">
      <thead>
        <tr style="background:#409eff; color:#fff;">
          <th style="border:1px solid #dcdfe6; padding:8px;">åºå·</th>
          <th style="border:1px solid #dcdfe6; padding:8px;">å•†å“åç§°</th>
          <th style="border:1px solid #dcdfe6; padding:8px;">æ•°é‡</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td style="border:1px solid #dcdfe6; padding:8px;">1</td>
          <td style="border:1px solid #dcdfe6; padding:8px;">ç¬”è®°æœ¬ç”µè„‘</td>
          <td style="border:1px solid #dcdfe6; padding:8px;">10</td>
        </tr>
      </tbody>
    </table>
  `
}
```

### æ”¯æŒçš„HTMLæ ·å¼

è¯¦è§ï¼š[æ–‡æ¡£åˆæˆåŠŸèƒ½æ”¯æŒè¯´æ˜](./æ–‡æ¡£åˆæˆåŠŸèƒ½æ”¯æŒè¯´æ˜.md)

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. æ¨¡æ¿è®¾è®¡å»ºè®®

```
âœ… ä½¿ç”¨æœ‰æ„ä¹‰çš„å­—æ®µåï¼šcontractNo, partyA, items
âŒ é¿å…ä½¿ç”¨ï¼šfield1, field2, data

âœ… ä¸ºå­—æ®µè®¾ç½®å ä½ç¬¦æ–‡æœ¬ï¼š"è¯·å¡«å†™åˆåŒç¼–å·"
âŒ ç•™ç©ºå ä½ç¬¦

âœ… ä½¿ç”¨å—çº§ContentControlåŒ…å«è¡¨æ ¼
âŒ åœ¨è¡¨æ ¼å•å…ƒæ ¼å†…ä½¿ç”¨ContentControl

âœ… æµ‹è¯•å„ç§æ•°æ®åœºæ™¯
âŒ åªæµ‹è¯•ç†æƒ³æƒ…å†µ
```

### 2. æ•°æ®å‡†å¤‡

```javascript
// æ ¼å¼åŒ–é‡‘é¢
function formatAmount(amount) {
  return parseFloat(amount).toLocaleString('zh-CN', {
    minimumFractionDigits: 2,
    maximumFractionDigits: 2
  });
}

// æ ¼å¼åŒ–æ—¥æœŸ
function formatDate(date) {
  const d = new Date(date);
  return `${d.getFullYear()}å¹´${d.getMonth() + 1}æœˆ${d.getDate()}æ—¥`;
}

// ç”Ÿæˆå¸¦æ ·å¼çš„é‡‘é¢ï¼ˆé«˜äº®æ˜¾ç¤ºï¼‰
function formatAmountWithHighlight(amount) {
  const formatted = formatAmount(amount);
  return `<mark style="background-color: #fff3cd;">${formatted}</mark> å…ƒ`;
}

// ç”Ÿæˆå¸¦æ ·å¼çš„é‡è¦æç¤º
function createImportantNotice(text) {
  return `<span style="background-color: #ffeb3b; padding: 2px 4px; border-radius: 2px;">${text}</span>`;
}

// ç”Ÿæˆä½œåºŸ/åˆ é™¤æ ‡è®°ï¼ˆä¸‹åˆ’çº¿+åˆ é™¤çº¿ç»„åˆï¼‰
function createVoidedText(text) {
  return `<span style="text-decoration: underline line-through; color: #909399;">${text}</span>`;
}

// ç”Ÿæˆå¼ºè°ƒæ–‡æœ¬ï¼ˆç»„åˆå¤šç§æ ·å¼ï¼‰
function createEmphasisText(text) {
  return `<span style="background-color: #fff3cd; color: #f56c6c; font-weight: bold; text-decoration: underline;">${text}</span>`;
}

// å‡†å¤‡æ•°æ®
const contractData = {
  contractNo: "GY-2025-001",
  amount: formatAmount(1000000),                    // "1,000,000.00"
  totalAmount: formatAmountWithHighlight(1000000),  // å¸¦é«˜äº®çš„é‡‘é¢
  signDate: formatDate(new Date()),                 // "2025å¹´11æœˆ5æ—¥"
  
  // å¯Œæ–‡æœ¬å­—æ®µç¤ºä¾‹ï¼šå¸¦é«˜äº®çš„æ¡æ¬¾
  paymentTerms: `
    <p>ä»˜æ¬¾æ¡ä»¶ï¼š</p>
    <p>1. <mark>åˆåŒç­¾è®¢å7æ—¥å†…</mark>æ”¯ä»˜é¢„ä»˜æ¬¾ï¼Œé‡‘é¢ä¸ºåˆåŒæ€»é¢çš„30%ï¼›</p>
    <p>2. è´§ç‰©éªŒæ”¶åˆæ ¼åï¼Œ<mark>15æ—¥å†…</mark>æ”¯ä»˜å°¾æ¬¾ã€‚</p>
    <p style="background-color: #e3f2fd; padding: 8px; margin-top: 10px;">
      ğŸ’¡ <b>é‡è¦æç¤º</b>ï¼šé€¾æœŸä»˜æ¬¾å°†æŒ‰æ—¥æ”¶å–åƒåˆ†ä¹‹äº”çš„è¿çº¦é‡‘ã€‚
    </p>
  `,
  
  // ç®€å•çš„é«˜äº®æ–‡æœ¬
  importantClause: "è¯·æ³¨æ„ï¼š<mark>æ­¤æ¡æ¬¾ä¸å¯æ’¤é”€</mark>ï¼ŒåŒæ–¹åº”ä¸¥æ ¼éµå®ˆã€‚",
  
  // ä½¿ç”¨è¾…åŠ©å‡½æ•°ç”Ÿæˆçš„æ ·å¼æ–‡æœ¬
  voidedClause: createVoidedText("æœ¬æ¡æ¬¾å·²ä½œåºŸï¼Œä¸å†é€‚ç”¨"),
  emphasisWarning: createEmphasisText("é‡è¦è­¦å‘Šï¼šè¿çº¦å°†æ‰¿æ‹…æ³•å¾‹è´£ä»»"),
  
  // ç»„åˆè£…é¥°ç¤ºä¾‹ï¼šä¿®è®¢ç—•è¿¹
  revisedClause: `åŸæ¡æ¬¾ï¼š<span style="text-decoration: line-through;">30å¤©å†…ä»˜æ¬¾</span> â†’ ä¿®è®¢ä¸ºï¼š<span style="text-decoration: underline; color: #409eff; font-weight: bold;">15å¤©å†…ä»˜æ¬¾</span>`
};
```

**æ•°æ®å‡†å¤‡å»ºè®®**ï¼š
- âœ… å…³é”®é‡‘é¢ä½¿ç”¨é«˜äº®æ ‡è®°ï¼Œä¾¿äºå®¡æ ¸æ—¶å¿«é€Ÿå®šä½
- âœ… é‡è¦æ—¶é—´èŠ‚ç‚¹ä½¿ç”¨ `<mark>` æ ‡ç­¾çªå‡ºæ˜¾ç¤º
- âœ… æç¤ºä¿¡æ¯å¯ä»¥ä½¿ç”¨æµ…è‰²èƒŒæ™¯åŒºåˆ†ï¼ˆå¦‚ `#e3f2fd`ï¼‰
- âœ… ä½œåºŸ/åˆ é™¤å†…å®¹ä½¿ç”¨ `text-decoration: underline line-through` ç»„åˆæ ‡è®°
- âœ… ä¿®è®¢ç—•è¿¹å¯ä»¥ç”¨åˆ é™¤çº¿æ ‡è®°æ—§å†…å®¹ï¼Œä¸‹åˆ’çº¿æ ‡è®°æ–°å†…å®¹
- âš ï¸ é¿å…åœ¨åŒä¸€æ®µæ–‡å­—ä¸­è¿‡åº¦ä½¿ç”¨é«˜äº®ï¼Œä¿æŒå¯è¯»æ€§

**ç»„åˆè£…é¥°çš„å…¸å‹åº”ç”¨åœºæ™¯**ï¼š
1. **åˆåŒä¿®è®¢**ï¼šç”¨åˆ é™¤çº¿æ ‡è®°åˆ é™¤çš„å†…å®¹ï¼Œä¸‹åˆ’çº¿æ ‡è®°æ–°å¢å†…å®¹
2. **ä½œåºŸæ ‡è®°**ï¼šç”¨ä¸‹åˆ’çº¿+åˆ é™¤çº¿ç»„åˆæ ‡è®°å·²ä½œåºŸçš„æ¡æ¬¾
3. **å¼ºè°ƒæç¤º**ï¼šç»„åˆèƒŒæ™¯è‰²ã€é¢œè‰²ã€ç²—ä½“ã€ä¸‹åˆ’çº¿æ¥çªå‡ºé‡è¦ä¿¡æ¯
4. **å®¡æ‰¹æ ‡è®°**ï¼šç”¨ä¸åŒé¢œè‰²å’Œè£…é¥°åŒºåˆ†ä¸åŒçš„å®¡æ‰¹çŠ¶æ€

### 3. é”™è¯¯å¤„ç†

```javascript
async function composeWithRetry(templateId, data, maxRetries = 3) {
  for (let i = 0; i < maxRetries; i++) {
    try {
      return await composeContract(templateId, data);
    } catch (error) {
      if (i === maxRetries - 1) throw error;
      
      console.log(`é‡è¯• ${i + 1}/${maxRetries}...`);
      await new Promise(resolve => setTimeout(resolve, 1000 * (i + 1)));
    }
  }
}
```

### 4. æ€§èƒ½ä¼˜åŒ–

```javascript
// æ‰¹é‡åˆæˆæ—¶åˆ†æ‰¹å¤„ç†
async function batchCompose(templateId, dataList, batchSize = 10) {
  const results = [];
  
  for (let i = 0; i < dataList.length; i += batchSize) {
    const batch = dataList.slice(i, i + batchSize);
    
    const batchResults = await fetch('/api/compose/batch', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        templateFileId: templateId,
        dataList: batch
      })
    }).then(r => r.json());
    
    results.push(...batchResults.data.results);
    
    // æ¯æ‰¹ä¹‹é—´æš‚åœ1ç§’
    if (i + batchSize < dataList.length) {
      await new Promise(resolve => setTimeout(resolve, 1000));
    }
  }
  
  return results;
}
```

---

## â“ å¸¸è§é—®é¢˜

### Q1: ContentControl å­—æ®µæ²¡æœ‰è¢«æ›¿æ¢ï¼Ÿ

**A**: æ£€æŸ¥ï¼š
1. å­—æ®µçš„ Tag å±æ€§æ˜¯å¦æ­£ç¡®è®¾ç½®
2. æ•°æ®ä¸­çš„å­—æ®µåæ˜¯å¦ä¸ Tag åŒ¹é…
3. ContentControl ç±»å‹æ˜¯å¦æ­£ç¡®ï¼ˆå¯Œæ–‡æœ¬/çº¯æ–‡æœ¬ï¼‰

### Q2: è¡¨æ ¼æ ·å¼ä¸¢å¤±ï¼Ÿ

**A**: 
- ä½¿ç”¨ `border-collapse:collapse;` é¿å…åŒçº¿è¾¹æ¡†
- ä½¿ç”¨å†…è”æ ·å¼ï¼Œä¸è¦ä¾èµ–CSSç±»
- å‚è€ƒ[æ–‡æ¡£åˆæˆåŠŸèƒ½æ”¯æŒè¯´æ˜](./æ–‡æ¡£åˆæˆåŠŸèƒ½æ”¯æŒè¯´æ˜.md)

### Q3: åˆæˆåçš„æ–‡æ¡£æ— æ³•ç¼–è¾‘ï¼Ÿ

**A**: 
- è¿™æ˜¯å·²çŸ¥é—®é¢˜ï¼Œæˆ‘ä»¬å·²ä¿®å¤
- ç¡®ä¿ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ç³»ç»Ÿ
- å¦‚æœä»æœ‰é—®é¢˜ï¼Œè¯·æä¾›æ¨¡æ¿æ–‡ä»¶ä»¥ä¾¿æ’æŸ¥

### Q4: å¦‚ä½•åœ¨åˆåŒä¸­æ’å…¥å›¾ç‰‡ï¼Ÿ

**A**: 
- ä½¿ç”¨ base64 ç¼–ç çš„å›¾ç‰‡
- æˆ–ä½¿ç”¨å›¾ç‰‡URLï¼ˆéœ€è¦é…ç½®å›¾ç‰‡æœåŠ¡ï¼‰

```json
{
  "logo": "<img src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA...' />"
}
```

### Q4.5: å¦‚ä½•ä½¿ç”¨èƒŒæ™¯è‰²/é«˜äº®æ ‡è®°é‡è¦å†…å®¹ï¼Ÿ

**A**: 
ç³»ç»Ÿæ”¯æŒä¸‰ç§æ–¹å¼æ·»åŠ èƒŒæ™¯è‰²ï¼š

**æ–¹å¼1ï¼šä½¿ç”¨ `<mark>` æ ‡ç­¾ï¼ˆæ¨èï¼‰**
```json
{
  "importantClause": "è¯·æ³¨æ„ï¼š<mark>æ­¤æ¡æ¬¾ä¸ºå¿…å¡«é¡¹</mark>ï¼Œä¸èƒ½ä¸ºç©ºã€‚"
}
```
- é»˜è®¤é»„è‰²èƒŒæ™¯
- å¯é€šè¿‡ style è‡ªå®šä¹‰é¢œè‰²ï¼š`<mark style="background-color: #ff9800;">æ©™è‰²é«˜äº®</mark>`

**æ–¹å¼2ï¼šä½¿ç”¨ CSS æ ·å¼**
```json
{
  "notice": "é‡è¦æç¤ºï¼š<span style='background-color: #ffeb3b;'>è¯·ä»”ç»†é˜…è¯»</span>"
}
```

**æ–¹å¼3ï¼šç»„åˆä½¿ç”¨å¤šç§æ ·å¼**
```json
{
  "amount": "åˆåŒé‡‘é¢ï¼š<span style='background-color: #fff3cd; color: #f56c6c; font-weight: bold;'>1,000,000.00</span> å…ƒ"
}
```

**å¸¸ç”¨èƒŒæ™¯è‰²æ¨è**ï¼š
- é»„è‰²é«˜äº®ï¼š`#ffeb3b` æˆ– `yellow`
- æµ…è“è‰²ï¼ˆæç¤ºï¼‰ï¼š`#e3f2fd` æˆ– `lightblue`
- æµ…ç»¿è‰²ï¼ˆæˆåŠŸï¼‰ï¼š`#e8f5e9` æˆ– `lightgreen`
- æµ…æ©™è‰²ï¼ˆè­¦å‘Šï¼‰ï¼š`#fff3cd`
- æµ…çº¢è‰²ï¼ˆé‡è¦ï¼‰ï¼š`#ffebee`

> ğŸ“– å®Œæ•´æ ·å¼æ”¯æŒè¯·å‚è€ƒï¼š[æ–‡æ¡£åˆæˆåŠŸèƒ½æ”¯æŒè¯´æ˜](./æ–‡æ¡£åˆæˆåŠŸèƒ½æ”¯æŒè¯´æ˜.md)

### Q5: å¦‚ä½•åˆå¹¶é¢å¤–çš„PDFæ–‡ä»¶ï¼Ÿ

**A**: 
ä½¿ç”¨ `extraFiles` å­—æ®µä¼ é€’PDFæ–‡ä»¶URLåˆ—è¡¨ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä¸‹è½½å¹¶åˆå¹¶ï¼š

```javascript
// 1. è·å–æ¨¡æ¿ä¿¡æ¯ï¼Œè¯†åˆ«å°ç« å­—æ®µ
const templateInfo = await getTemplateInfo('purchase_contract');
const elements = JSON.parse(templateInfo.elementsJson).elements;
const sealElements = elements.filter(el => el.type === 'seal');

// 2. æ„å»ºæ™®é€šç« å›¾ç‰‡URLæ˜ å°„ï¼ˆkeyä¸ºtagï¼‰
const stampImageUrls = {};
sealElements.forEach(seal => {
  stampImageUrls[seal.tag] = {
    normal: `https://example.com/stamps/${seal.meta.code}.png`
  };
});

// 3. æ„å»ºè¯·æ±‚
const requestBody = {
  templateCode: 'purchase_contract',
  values: { /* åˆåŒæ•°æ® */ },
  extraFiles: [
    'https://example.com/attachments/attachment1.pdf',
    'https://example.com/attachments/attachment2.pdf'
  ],
  stampImageUrls: stampImageUrls,
  ridingStampUrl: 'https://example.com/stamps/riding_seal.png'  // éª‘ç¼ç« æ˜¯ç‹¬ç«‹å‚æ•°
};
```

**å¤„ç†æµç¨‹**ï¼š
1. åˆæˆåˆåŒDOCXå¹¶è½¬æ¢ä¸ºPDF
2. ä¸‹è½½å¹¶åˆå¹¶ `extraFiles` ä¸­çš„æ‰€æœ‰PDFæ–‡ä»¶ï¼ˆæŒ‰é¡ºåºè¿½åŠ ï¼‰
3. åœ¨åˆå¹¶åçš„PDFä¸Šç›–æ™®é€šç« ï¼ˆå¦‚æœæœ‰ `stampImageUrls`ï¼‰
4. åœ¨åˆå¹¶åçš„PDFä¸Šç›–éª‘ç¼ç« ï¼ˆ**åªæœ‰æä¾›äº† `ridingStampUrl` æ‰ä¼šæ‰§è¡Œ**ï¼‰

**æ³¨æ„äº‹é¡¹**ï¼š
- PDFæ–‡ä»¶å¿…é¡»æ˜¯å¯å…¬å¼€è®¿é—®çš„URL
- å¦‚æœæŸä¸ªPDFä¸‹è½½å¤±è´¥ï¼Œä¼šè·³è¿‡è¯¥æ–‡ä»¶ç»§ç»­å¤„ç†
- åˆå¹¶åçš„PDFæ€»é¡µæ•° = ä¸»åˆåŒé¡µæ•° + æ‰€æœ‰é™„ä»¶é¡µæ•°ä¹‹å’Œ
- **éª‘ç¼ç« æ˜¯ç‹¬ç«‹å‚æ•°**ï¼šåªæœ‰æ˜ç¡®æä¾› `ridingStampUrl` æ‰ä¼šç›–éª‘ç¼ç« 
- `stampImageUrls` çš„keyæ˜¯æ¨¡æ¿å­—æ®µçš„tagï¼ˆä»æ¨¡æ¿æŸ¥è¯¢æ¥å£çš„`elementsJson`ä¸­è·å–ï¼‰
- å°ç« å­—æ®µçš„è¯†åˆ«ï¼šåœ¨æ¨¡æ¿çš„`elementsJson`ä¸­ï¼Œ`type === "seal"`çš„å­—æ®µå³ä¸ºå°ç« å­—æ®µ
- å°ç« å­—æ®µçš„valueç”±ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆï¼Œä¸éœ€è¦åœ¨`values`ä¸­ä¼ é€’
- éª‘ç¼ç« ä¸ç»‘å®šä»»ä½•æ¨¡æ¿å­—æ®µï¼Œæ˜¯å…¨å±€çš„
- éª‘ç¼ç« ä¼šè¦†ç›–æ•´ä¸ªåˆå¹¶åçš„PDFæ–‡æ¡£

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚éœ€äº†è§£æ›´å¤šåŠŸèƒ½æˆ–æœ‰å®šåˆ¶éœ€æ±‚ï¼Œè¯·è”ç³»ï¼š

- ğŸ“§ å®˜æ–¹ç½‘ç«™ï¼š[https://zhaoxinms.com](https://zhaoxinms.com)
- ğŸ“¦ äº§å“ä»·æ ¼ï¼š[https://zhaoxinms.com/price](https://zhaoxinms.com/price)

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [æ™ºèƒ½åˆåŒåˆæˆ API æ–‡æ¡£](./æ™ºèƒ½åˆåŒåˆæˆ-APIç‰ˆæœ¬-APIæ–‡æ¡£.md)
- [æ–‡æ¡£åˆæˆåŠŸèƒ½æ”¯æŒè¯´æ˜](./æ–‡æ¡£åˆæˆåŠŸèƒ½æ”¯æŒè¯´æ˜.md)
- [API è®¾è®¡è§„èŒƒ](./APIè®¾è®¡æ–‡æ¡£.md)

