# 文档合成功能支持说明

## 📋 功能概述

肇新智能合同合成系统基于 **ContentControl（内容控件）** 技术，支持复杂的文档合成需求。本文档详细说明系统支持的各种内容类型、格式和功能。

---

## 📝 支持的内容类型

### 1. 纯文本

**说明**：最基础的文本内容替换

**模板设计**：
```
插入内容控件，设置tag：party_a_name
内容控件中的占位文本：{甲方名称}
```

**合成数据**：
```json
{
  "party_a_name": "北京某某科技有限公司"
}
```

**合成结果**：
```
北京某某科技有限公司
```

**支持特性**：
- ✅ 中文、英文、数字、符号
- ✅ 多行文本
- ✅ 特殊字符（©、®、™等）

---

### 2. 富文本（带样式的文本）

**说明**：支持文本的字体、颜色、大小、粗体、斜体、下划线等样式

#### 2.1 样式支持清单

| 样式类型 | 支持情况 | 说明 |
|---------|---------|------|
| **字体** | ✅ 完全支持 | 宋体、黑体、微软雅黑、Times New Roman等 |
| **字号** | ✅ 完全支持 | 任意字号（如10.5pt、14pt） |
| **颜色** | ✅ 完全支持 | RGB颜色、主题颜色 |
| **粗体** | ✅ 完全支持 | Bold |
| **斜体** | ✅ 完全支持 | Italic |
| **下划线** | ✅ 完全支持 | 单下划线、双下划线、波浪线等 |
| **删除线** | ✅ 完全支持 | 单删除线、双删除线 |
| **上标/下标** | ✅ 完全支持 | X²、H₂O |
| **突出显示** | ✅ 完全支持 | 背景高亮颜色 |

#### 2.2 模板样式继承（推荐方式）

**模板设计**：
```
创建内容控件，tag：important_clause
应用样式：字体红色、加粗、14pt
```

**合成数据**：
```json
{
  "important_clause": "本条款为关键条款，请仔细阅读"
}
```

**合成结果**：  
文本会自动继承模板中设置的所有样式（红色、加粗、14pt）

#### 2.3 HTML内联样式（高级方式）

**说明**：通过HTML标签和CSS样式，可以精确控制每个字符的样式。**HTML内联样式的优先级最高**，会覆盖模板中设置的样式。

##### 支持的HTML标签

| 标签 | 用途 | 示例 |
|------|------|------|
| `<b>` 或 `<strong>` | 粗体 | `<b>粗体文本</b>` |
| `<i>` 或 `<em>` | 斜体 | `<i>斜体文本</i>` |
| `<u>` | 下划线 | `<u>下划线文本</u>` |
| `<s>` 或 `<strike>` 或 `<del>` | 删除线 | `<s>删除线</s>` |
| `<sup>` | 上标 | `E=mc<sup>2</sup>` |
| `<sub>` | 下标 | `H<sub>2</sub>O` |
| `<span>` | 通用容器 | `<span style="...">文本</span>` |
| `<font>` | 字体样式（兼容） | `<font color="red">文本</font>` |
| `<br>` | 换行 | `第一行<br>第二行` |
| `<p>` | 段落 | `<p>段落内容</p>` |

##### 支持的CSS样式属性

| CSS属性 | 用途 | 支持的值 | 示例 |
|---------|------|---------|------|
| `color` | 文字颜色 | 十六进制、RGB、颜色名 | `color: #409eff` <br> `color: rgb(64, 158, 255)` <br> `color: blue` |
| `font-size` | 字体大小 | px、pt、em、rem | `font-size: 14px` <br> `font-size: 12pt` <br> `font-size: 1.2em` |
| `font-weight` | 字体粗细 | bold、700-900 | `font-weight: bold` <br> `font-weight: 700` |
| `font-style` | 字体样式 | italic | `font-style: italic` |
| `text-decoration` | 文本装饰 | underline, line-through，支持组合 | `text-decoration: underline` <br> `text-decoration: line-through` <br> `text-decoration: underline line-through` （下划线+删除线） |
| `background-color` | 文字背景色（高亮） | 十六进制、RGB、颜色名 | `background-color: #ffeb3b` <br> `background-color: rgb(255, 235, 59)` <br> `background-color: yellow` |

##### 单位转换规则

**字体大小单位详解**：

| 单位 | 说明 | 转换公式 | 示例 |
|------|------|---------|------|
| `pt`（磅） | Word标准单位，推荐使用 | 直接对应 | `12pt` = Word显示12pt |
| `px`（像素） | 网页单位 | 1px ≈ 0.75pt | `30px` = Word显示23pt |
| `em` | 相对单位 | 1em ≈ 12pt | `1.5em` = Word显示18pt |
| `rem` | 相对单位 | 1rem ≈ 12pt | `1.5rem` = Word显示18pt |

**为什么px和pt不一样？**

- **1英寸 = 96px**（屏幕显示标准）
- **1英寸 = 72pt**（打印标准）
- **转换关系**：`1px = 72÷96 pt = 0.75pt`

**实际转换示例**：

```
输入：<span style='font-size:30px'>文字</span>
转换过程：30px × 0.75 = 22.5pt
Word显示：23pt（四舍五入）
```

##### 完整示例

**所有功能综合测试**

```html
测试<b>粗体</b>、<i>斜体</i>、<u>下划线</u>、<s>删除线1</s>、<span style='text-decoration:line-through;'>删除线2</span>。<br>颜色：<span style='color:#409eff;'>蓝色</span>、<span style='color:#f56c6c; font-size:16pt;'>红色大字</span>。<br>装饰组合：<span style='text-decoration: underline line-through;'>下划线+删除线</span>、<mark>黄色高亮</mark>、<span style='background-color:#e3f2fd;'>浅蓝背景</span>。<br>组合：<b><i><span style='color:#67c23a;'>粗斜绿</span></i></b>。<br>上下标：H<sub>2</sub>O、E=mc<sup>2</sup>、X<sup>n</sup>+Y<sub>i</sub>。
```

**渲染效果说明**：
- ✅ **基础样式**：粗体、斜体、下划线都正确显示
- ✅ **删除线**：支持标签和CSS两种方式
- ✅ **装饰组合**：`text-decoration: underline line-through` 同时显示下划线和删除线
- ✅ **颜色**：蓝色（#409eff）正常显示
- ✅ **背景色/高亮**：支持 mark 标签和 CSS background-color 属性
- ✅ **组合样式**：红色16pt大字正确应用
- ✅ **嵌套标签**：粗体+斜体+绿色组合样式正确
- ✅ **上下标**：H₂O（化学式）、E=mc²（物理公式）、Xⁿ+Yᵢ（数学式）都正确显示

**样式继承说明**：
- 如果模板ContentControl中设置了字体大小为14pt，但HTML未指定字体大小，则继承14pt
- HTML中明确指定的样式（如颜色、字号）会覆盖模板样式
- 未设置的属性会从模板继承

#### 2.4 样式优先级规则

从高到低：

1. **HTML内联样式** - 最高优先级
   - 示例：`<span style='color:blue;'>` 的颜色会覆盖模板颜色
   - 规则：HTML中未设置的属性（如字体大小）会从模板继承

2. **模板ContentControl样式** - 中等优先级
   - 示例：在Word中为ContentControl设置的字体、颜色、大小等
   - 规则：会被HTML样式覆盖，但为HTML未设置的属性提供默认值

3. **段落样式** - 较低优先级
   - 示例：段落应用的"标题1"、"正文"等样式
   - 规则：会被ContentControl样式和HTML样式覆盖

4. **文档默认样式** - 最低优先级
   - 示例：文档的默认字体"宋体"、默认字号"五号"
   - 规则：仅在所有其他样式都未设置时生效

#### 2.5 常见问题

**Q1：为什么我的字体大小没有生效？或者大小不是我期望的？**

A：请检查：
- ✅ 确认CSS属性名正确：`font-size`（不是 `fontSize`）
- ✅ 确认单位格式正确：`30px`、`12pt`（数字和单位之间可有可无空格）
- ✅ 理解单位转换：`30px` 在Word中会显示为 `23pt`（详见上方"单位转换规则"）
- ✅ **推荐使用pt单位**：如果想要精确控制，直接使用 `font-size:30pt`
- ✅ 确认是否被模板样式覆盖（优先级问题）

**Q2：HTML样式和模板样式哪个优先级高？**

A：**HTML内联样式优先级最高**。如果HTML中设置了某个属性（如颜色），会覆盖模板样式；但HTML中未设置的属性（如字体大小）会从模板继承。

**Q3：如何确保样式完全一致？**

A：推荐做法：
1. 在模板中设置默认样式（字体、大小、对齐方式等）
2. 只在需要特殊强调时使用HTML样式覆盖特定属性
3. 避免在HTML中重复设置模板已有的样式

---

### 3. 段落格式

**说明**：支持段落的对齐、缩进、行距、间距等格式

**支持的段落格式**：

| 格式类型 | 支持情况 | 可选值 |
|---------|---------|--------|
| **对齐方式** | ✅ 完全支持 | 左对齐、居中、右对齐、两端对齐 |
| **首行缩进** | ✅ 完全支持 | 任意缩进值（如2字符） |
| **左缩进** | ✅ 完全支持 | 任意缩进值 |
| **右缩进** | ✅ 完全支持 | 任意缩进值 |
| **段前间距** | ✅ 完全支持 | 任意间距值 |
| **段后间距** | ✅ 完全支持 | 任意间距值 |
| **行距** | ✅ 完全支持 | 单倍、1.5倍、2倍、固定值 |
| **编号/项目符号** | ✅ 完全支持 | 自动编号、项目符号 |

**示例**：
```
模板中设置段落：
- 首行缩进2字符
- 行距1.5倍
- 段后间距0.5行

合成后会保持这些格式
```

---

### 4. 表格

**说明**：强大的表格支持，可以插入复杂的表格结构

**⚠️ 重要提示**：
- 表格必须在**块级ContentControl**中使用，不能在行内ContentControl中使用
- 建议使用 `border-collapse: collapse;` 以获得更好的边框效果
- Word对某些CSS样式的解析有限制，建议优先使用内联样式
- 边框颜色建议明确指定，如 `border:1px solid #dcdfe6`
- 背景色在Word中可能显示略有差异，建议使用常见的安全色值

#### 4.1 静态表格

**模板设计**：
```
插入内容控件，tag：product_list
内容控件中包含一个表格模板
```

**合成数据**（HTML格式）：
```html
<table style='width:100%; border-collapse: collapse;'>
  <thead>
    <tr style='background:#f5f7fa; color:#333;'>
      <th style='border:1px solid #ddd; padding:6px;'>序号</th>
      <th style='border:1px solid #ddd; padding:6px;'>产品名称</th>
      <th style='border:1px solid #ddd; padding:6px;'>数量</th>
      <th style='border:1px solid #ddd; padding:6px;'>单价</th>
    </tr>
  </thead>
  <tbody style='color:#606266;'>
    <tr>
      <td style='border:1px solid #ddd; padding:6px;'>1</td>
      <td style='border:1px solid #ddd; padding:6px;'>产品A</td>
      <td style='border:1px solid #ddd; padding:6px;'>10</td>
      <td style='border:1px solid #ddd; padding:6px;'>1000.00</td>
    </tr>
    <tr>
      <td style='border:1px solid #ddd; padding:6px;'>2</td>
      <td style='border:1px solid #ddd; padding:6px;'>产品B</td>
      <td style='border:1px solid #ddd; padding:6px;'>5</td>
      <td style='border:1px solid #ddd; padding:6px;'>500.00</td>
    </tr>
  </tbody>
</table>
```

**合成结果**：  
生成一个完整的Word表格，保留所有样式

#### 4.2 表格样式支持

| 样式类型 | 支持情况 | 说明 |
|---------|---------|------|
| **表格边框** | ✅ 完全支持 | 边框颜色、粗细、样式 |
| **单元格背景色** | ✅ 完全支持 | 任意RGB颜色 |
| **单元格文字颜色** | ✅ 完全支持 | 支持表头、表体分别设置 |
| **单元格对齐** | ✅ 完全支持 | 水平/垂直对齐 |
| **单元格合并** | ✅ 完全支持 | 横向、纵向合并 |
| **表格宽度** | ✅ 完全支持 | 百分比、固定宽度 |
| **列宽** | ✅ 完全支持 | 自动、固定、按比例 |
| **行高** | ✅ 完全支持 | 自动、固定 |
| **内边距** | ✅ 完全支持 | 单元格内边距 |

#### 4.3 表格高级功能

**表头表体颜色区分**：
```html
<table>
  <thead>
    <tr style="background:#f5f7fa; color:#333333;">
      <th>表头1</th>
      <th>表头2</th>
    </tr>
  </thead>
  <tbody style="color:#606266;">
    <tr>
      <td>内容1</td>
      <td>内容2</td>
    </tr>
  </tbody>
</table>
```

**行级颜色设置**：
```html
<tr style="background:#fff; color:#000;">
  <td>第一行</td>
</tr>
<tr style="background:#f9f9f9; color:#666;">
  <td>第二行（斑马纹）</td>
</tr>
```

**单元格级颜色设置**：
```html
<td style="background:#ffebee; color:#c62828;">
  重要单元格
</td>
```

---

### 5. 条款（变量替换）

**说明**：条款可以包含固定文本和变量，变量会被实际值替换

**格式支持**：
- `${variable}` 格式
- `{{variable}}` 格式

**模板设计**：
```
创建内容控件，tag：contract_clause
内容：甲方：${party_a_name}，乙方：${party_b_name}，就${contract_name}达成如下协议：
```

**合成数据**：
```json
{
  "contract_clause": "甲方：${party_a_name}，乙方：${party_b_name}，就${contract_name}达成如下协议：",
  "party_a_name": "北京某某公司",
  "party_b_name": "上海某某公司",
  "contract_name": "技术服务合同"
}
```

**合成结果**：
```
甲方：北京某某公司，乙方：上海某某公司，就技术服务合同达成如下协议：
```

**高级特性**：
- ✅ 变量可以引用其他字段的值
- ✅ 支持嵌套变量
- ✅ 固定文本不可修改
- ✅ 变量值可以独立输入

---

### 6. 签约方信息（多方合同支持）

**说明**：系统支持多方合同，通过签约方索引区分不同的签约方

#### 6.1 签约方命名规范

**重要说明**：签约方字段采用**通用字段名** + **counterpartyIndex索引**的方式定义。

**字段命名格式**：
```
<fieldName>
```

例如：
- `companyName`（公司名称）
- `address`（地址）
- `contact`（联系人）
- `phone`（联系电话）

**通过 `counterpartyIndex` 指定属于第几方**：
- `counterpartyIndex: 1` → 第1方（甲方）
- `counterpartyIndex: 2` → 第2方（乙方）
- `counterpartyIndex: 3` → 第3方（丙方）

**说明**：系统不要求在字段名中添加 `party_a`、`party_b` 等前缀。相同的字段名（如 `companyName`）配合不同的 `counterpartyIndex`，会自动识别为不同签约方的字段。

**常用字段示例**：

| 字段代码 | 字段名称 | counterpartyIndex | 对应签约方 | 示例值 |
|---------|---------|------------------|-----------|--------|
| `companyName` | 公司名称 | 1 | 第1方（甲方） | 北京某某科技有限公司 |
| `companyName` | 公司名称 | 2 | 第2方（乙方） | 上海某某贸易有限公司 |
| `companyName` | 公司名称 | 3 | 第3方（丙方） | 广州某某服务有限公司 |
| `address` | 地址 | 1 | 第1方（甲方） | 北京市朝阳区XX路XX号 |
| `address` | 2 | 地址 | 第2方（乙方） | 上海市浦东新区XX路XX号 |
| `contact` | 联系人 | 1 | 第1方（甲方） | 张三 |
| `contact` | 联系人 | 2 | 第2方（乙方） | 李四 |
| `phone` | 联系电话 | 1 | 第1方（甲方） | 010-12345678 |
| `phone` | 联系电话 | 2 | 第2方（乙方） | 021-87654321 |

**注意**：
- ✅ 字段 `code` 可以是任意合法的标识符（如 `companyName`、`subject_name`、`party_name` 等）
- ✅ 系统会根据 `counterpartyIndex` 自动区分不同签约方的相同字段
- ✅ 在 Word 模板中插入时，系统会自动生成唯一的 `tag`
- ✅ **tag格式**：`tagElement` + `code` + `_` + `时间戳` + `_` + `随机字符串`（如 `tagElementcompanyName_1762826807666_4dgdl6`）
- ⚠️ **tag中不包含签约方索引信息**，签约方通过字段元数据中的 `partyIndex` 或 `counterpartyIndex` 识别

#### 6.2 签约方索引说明

**索引对应关系**：

| counterpartyIndex | 中文称谓 | 说明 |
|------------------|---------|------|
| `1` | 甲方 | 第1签约方 |
| `2` | 乙方 | 第2签约方 |
| `3` | 丙方 | 第3签约方 |
| `4` | 丁方 | 第4签约方 |
| `5` | 戊方 | 第5签约方 |
| `6` | 己方 | 第6签约方 |

**重要说明**：
- ✅ `counterpartyIndex` 是必填字段，用于指定该字段属于第几个签约方
- ✅ 系统支持最多10个签约方（`counterpartyIndex`: 1-10）
- ✅ 字段 `code` 可以是任意合法标识符，不强制要求包含签约方信息
- ✅ 相同的 `code`（如 `companyName`）配合不同的 `counterpartyIndex`，会被识别为不同签约方的字段
- ⚠️ 签约方索引从 1 开始，不是从 0 开始

#### 6.3 字段配置（fields.json）

**签约方字段必须在 `counterpartyFields` 数组中配置**，配置格式：

```json
{
  "counterpartyFields": [
    {
      "id": "party_1_company",
      "name": "买方公司名称",
      "code": "companyName",
      "counterpartyIndex": 1,
      "sampleValue": "北京某某科技有限公司"
    },
    {
      "id": "party_1_address",
      "name": "买方地址",
      "code": "address",
      "counterpartyIndex": 1,
      "sampleValue": "北京市朝阳区XX路XX号"
    },
    {
      "id": "party_2_company",
      "name": "卖方公司名称",
      "code": "companyName",
      "counterpartyIndex": 2,
      "sampleValue": "上海某某贸易有限公司"
    },
    {
      "id": "party_2_address",
      "name": "卖方地址",
      "code": "address",
      "counterpartyIndex": 2,
      "sampleValue": "上海市浦东新区XX路XX号"
    },
    {
      "id": "party_3_company",
      "name": "担保方公司名称",
      "code": "companyName",
      "counterpartyIndex": 3,
      "sampleValue": "广州某某服务有限公司"
    }
  ]
}
```

**字段说明**：
- `id`：字段唯一标识（必须全局唯一，不能重复）
- `name`：字段显示名称（用于模板设计器界面显示）
- `code`：字段代码（可以是任意合法标识符，如 `companyName`、`address`、`contact` 等）
- `counterpartyIndex`：签约方索引（**必填**，数字，1表示甲方，2表示乙方，3表示丙方...）
- `sampleValue`：示例值（可选）

**关键点**：
- ✅ 相同的 `code`（如 `companyName`）可以在多个签约方中使用，通过 `counterpartyIndex` 区分
- ✅ `id` 必须唯一（如 `party_1_company`、`party_2_company`）
- ✅ 插入到Word模板时，系统会自动生成唯一的 `tag`
- ✅ **tag格式**：`tagElement + code + "_" + 时间戳 + "_" + 随机字符串`
- ✅ **tag中不包含签约方信息**，签约方信息存储在字段的 `meta.partyIndex` 中

#### 6.4 模板设计示例

**双方合同（甲方、乙方）**：

```
1. 在 fields.json 中配置签约方字段：
   - companyName (counterpartyIndex: 1) → 甲方公司名称
   - companyName (counterpartyIndex: 2) → 乙方公司名称
   - address (counterpartyIndex: 1) → 甲方地址
   - address (counterpartyIndex: 2) → 乙方地址

2. 在模板设计器中插入字段：
   - 选择"甲方公司名称"字段插入 → 生成唯一tag: tagElementcompanyName_1762826807666_4dgdl6
   - 选择"乙方公司名称"字段插入 → 生成唯一tag: tagElementcompanyName_1762826824516_08dxc4
   
3. Word模板中的效果：
   - 两个字段使用相同的 code (companyName)，但有不同的 tag（通过时间戳和随机字符串保证唯一性）
   - 每个字段的 meta.partyIndex 存储了该字段属于第几方
   - 系统通过 meta.partyIndex 区分甲方和乙方，**不是通过tag**
```

**三方合同（甲方、乙方、丙方）**：

```
1. 在 fields.json 中配置三方字段：
   - companyName (counterpartyIndex: 1, 2, 3)
   - address (counterpartyIndex: 1, 2, 3)
   
2. 在模板设计器中分别插入：
   - 甲方公司名称 → tag: tagElementcompanyName_1762826807666_4dgdl6（meta.partyIndex: 1）
   - 乙方公司名称 → tag: tagElementcompanyName_1762826824516_08dxc4（meta.partyIndex: 2）
   - 丙方公司名称 → tag: tagElementcompanyName_1762826845123_9xyzab（meta.partyIndex: 3）
```

#### 6.5 合成数据示例

**双方合同数据**：

```json
{
  "party_a_name": "北京某某科技有限公司",
  "party_b_name": "上海某某贸易有限公司",
  "party_a_address": "北京市朝阳区科技园路100号",
  "party_b_address": "上海市浦东新区金融街200号",
  "party_a_contact": "张三",
  "party_b_contact": "李四",
  "party_a_phone": "010-12345678",
  "party_b_phone": "021-87654321"
}
```

**三方合同数据**：

```json
{
  "party_a_name": "北京某某科技有限公司",
  "party_b_name": "上海某某贸易有限公司",
  "party_c_name": "广州某某服务有限公司",
  "party_a_address": "北京市朝阳区科技园路100号",
  "party_b_address": "上海市浦东新区金融街200号",
  "party_c_address": "广州市天河区商业大道300号"
}
```

#### 6.6 印章字段命名规范

**印章字段格式**：
```
seal_party_<letter>
```

**常用印章字段**：

| 字段代码 | 说明 | 对应签约方 | fields.json配置 |
|---------|------|-----------|----------------|
| `seal_party_a` | 甲方公章 | party_a | `sealFields` 数组 |
| `seal_party_b` | 乙方公章 | party_b | `sealFields` 数组 |
| `seal_party_c` | 丙方公章 | party_c | `sealFields` 数组 |

**印章字段配置示例（fields.json）**：

```json
{
  "sealFields": [
    {
      "id": "seal_1",
      "name": "买方公章",
      "code": "seal_party_a",
      "type": "party_a",
      "orderIndex": 1
    },
    {
      "id": "seal_2",
      "name": "卖方公章",
      "code": "seal_party_b",
      "type": "party_b",
      "orderIndex": 2
    }
  ]
}
```

**印章数据格式**：

```json
{
  "stampImageUrls": {
    "seal_party_a": {
      "normal": "http://example.com/stamps/party_a_seal.png"
    },
    "seal_party_b": {
      "normal": "http://example.com/stamps/party_b_seal.png"
    }
  }
}
```

**印章说明**：
- ✅ `normal`：普通公章图片URL
- ✅ 印章图片支持PNG格式（推荐带透明背景）
- ✅ 系统会根据模板中的印章ContentControl自动定位盖章位置
- ✅ 支持骑缝章：使用 `ridingStampUrl` 字段

#### 6.7 完整的多方合同示例

**场景**：一份三方采购合同，包含公司信息、联系方式、印章

**模板设计（elementsJson中的元素）**：

```json
{
  "elements": [
    {"code": "party_a_name", "tag": "tagElementparty_a_name_xxx", "type": "party", "partyIndex": "1"},
    {"code": "party_b_name", "tag": "tagElementparty_b_name_xxx", "type": "party", "partyIndex": "2"},
    {"code": "party_c_name", "tag": "tagElementparty_c_name_xxx", "type": "party", "partyIndex": "3"},
    {"code": "seal_party_a", "tag": "tagElementseal_party_a_xxx", "type": "seal"},
    {"code": "seal_party_b", "tag": "tagElementseal_party_b_xxx", "type": "seal"},
    {"code": "seal_party_c", "tag": "tagElementseal_party_c_xxx", "type": "seal"}
  ]
}
```

**合成数据**：

```json
{
  "templateCode": "purchase_contract",
  "values": {
    "tagElementparty_a_name_xxx": "北京采购方科技有限公司",
    "tagElementparty_b_name_xxx": "上海供应商贸易有限公司",
    "tagElementparty_c_name_xxx": "广州担保方服务有限公司"
  },
  "stampImageUrls": {
    "tagElementseal_party_a_xxx": {
      "normal": "http://example.com/stamps/buyer_seal.png"
    },
    "tagElementseal_party_b_xxx": {
      "normal": "http://example.com/stamps/seller_seal.png"
    },
    "tagElementseal_party_c_xxx": {
      "normal": "http://example.com/stamps/guarantor_seal.png"
    }
  }
}
```

**合成结果**：
- 合同正文中显示三方公司名称
- 合同签署页自动盖上三方公章
- 每个公章定位到对应的ContentControl位置

#### 6.8 常见问题

**Q1：如何区分第几方？**

A：通过字段配置中的 `counterpartyIndex` 区分：
- `counterpartyIndex: 1`：第1方（甲方）
- `counterpartyIndex: 2`：第2方（乙方）
- `counterpartyIndex: 3`：第3方（丙方）
- 以此类推...

**注意**：字段的 `code` 不需要包含签约方信息，系统通过 `counterpartyIndex` 自动识别。

**Q2：相同的字段代码可以用于不同签约方吗？**

A：**可以**。这正是系统的设计特点：
- 你可以为所有签约方使用相同的 `code`（如 `companyName`）
- 通过不同的 `counterpartyIndex` 区分
- 系统会自动生成不同的 `tag`

示例：
```json
// 甲方公司名称
{ "code": "companyName", "counterpartyIndex": 1 }

// 乙方公司名称
{ "code": "companyName", "counterpartyIndex": 2 }
```

**Q3：印章字段和签约方字段需要关联吗？**

A：印章字段通常与签约方对应，建议在印章字段的 `type` 中指定签约方（如 `party_a`、`party_b`），以便系统识别该印章属于哪一方。

**Q4：一个签约方可以有多个印章吗？**

A：可以。可以为同一个签约方设置多个印章位置（如公章、法人章、财务章），只需在模板中插入多个印章ContentControl，使用不同的tag即可：
- `seal_party_a_company`：甲方公司公章
- `seal_party_a_legal`：甲方法人章
- `seal_party_a_finance`：甲方财务章

---


## 🎨 样式继承规则（详细说明）

### 优先级层次

从高到低：

1. **HTML内联样式（最高优先级）**
   - 来源：合成数据中的HTML标签和style属性
   - 示例：`<span style='color:blue; font-size:30px;'>文本</span>`
   - 特点：**优先级最高**，会覆盖所有其他样式
   - 继承：HTML中未设置的属性会从ContentControl样式继承

2. **ContentControl样式（中等优先级）**
   - 来源：在Word模板中为ContentControl设置的样式
   - 示例：设置ContentControl为"红色、加粗、14pt"
   - 特点：为插入内容提供默认样式
   - 继承：会被HTML样式覆盖，但补充HTML未设置的属性

3. **段落样式（较低优先级）**
   - 来源：Word段落应用的样式（如"标题1"、"正文"）
   - 示例：应用"标题1"样式
   - 特点：影响段落格式（对齐、缩进、行距等）
   - 继承：字符样式会被ContentControl和HTML样式覆盖

4. **文档默认样式（最低优先级）**
   - 来源：Word文档的默认样式设置
   - 示例：默认字体"宋体"、默认字号"五号"
   - 特点：仅在所有其他样式都未设置时生效
   - 继承：会被所有其他样式覆盖

### 实际场景示例

#### 场景1：纯文本 + ContentControl样式
```
ContentControl设置：红色、加粗、14pt
合成数据：{
  "content": "普通文本"
}
最终效果：红色、加粗、14pt（完全继承ContentControl样式）
```

#### 场景2：HTML样式 + ContentControl样式
```
ContentControl设置：红色、加粗、14pt
输入内容：<span style='color:blue;'>蓝色文本</span>
最终效果：蓝色（HTML覆盖）、加粗（ContentControl补充）、14pt（ContentControl补充）
```

#### 场景3：HTML完整样式 + ContentControl样式
```
ContentControl设置：红色、加粗、14pt
输入内容：<span style='color:blue; font-size:30px; font-weight:normal;'>文本</span>
最终效果：蓝色（HTML设置）、正常粗细（HTML设置）、30px≈22.5pt（HTML设置）
```

#### 场景4：多个样式属性混合
```
ContentControl设置：黑体、红色、加粗、14pt、下划线
输入内容：<span style='color:blue; font-size:20pt;'>文本</span>
最终效果：
- 字体：黑体（ContentControl提供）
- 颜色：蓝色（HTML覆盖）
- 粗细：加粗（ContentControl提供）
- 大小：20pt（HTML覆盖）
- 下划线：有（ContentControl提供）
```

#### 场景4a：理解px和pt单位转换
```
场景A - 使用px单位：
ContentControl设置：14pt
输入内容：<span style='font-size:30px;'>文本</span>
最终效果：字体大小为23pt（30px × 0.75 = 22.5pt，四舍五入为23pt）

场景B - 使用pt单位（推荐）：
ContentControl设置：14pt
输入内容：<span style='font-size:30pt;'>文本</span>
最终效果：字体大小为30pt（精确控制）

对比说明：
- 如果你从Word看到字体大小与设置不符，检查是否使用了px单位
- px是屏幕单位（1px ≈ 0.75pt），会自动转换
- pt是打印单位，直接对应Word显示值，推荐使用
```

#### 场景5：表格内容样式
```
表格HTML：<table><tr><td style='color:#606266;'>单元格</td></tr></table>
最终效果：单元格文本为灰色（#606266），其他样式按表格级别设置继承
```

### 样式合并机制

系统采用**智能补充策略**：

1. **检测HTML样式**
   - 解析HTML标签中的style属性
   - 识别已设置的样式属性

2. **补充ContentControl样式**
   - 检查HTML中未设置的属性
   - 从ContentControl样式中补充缺失的属性

3. **应用最终样式**
   - HTML设置的属性：使用HTML值
   - HTML未设置的属性：使用ContentControl值
   - ContentControl也未设置：使用段落或文档默认值

### 特殊情况说明

#### 占位符灰色自动修正
```
ContentControl占位符：灰色文本（DCDCDC）
插入纯文本：{
  "content": "文本内容"
}
最终效果：黑色文本（系统自动修正占位符灰色为黑色）
```

#### 表格颜色优先级
```
表格样式优先级（从高到低）：
1. 单元格style颜色
2. 行style颜色
3. thead/tbody颜色
4. table颜色
5. 默认黑色
```

---

## 📊 表格HTML格式规范

### 基本结构

```html
<table style="样式属性">
  <thead>
    <tr style="样式属性">
      <th style="样式属性">表头单元格</th>
    </tr>
  </thead>
  <tbody>
    <tr style="样式属性">
      <td style="样式属性">数据单元格</td>
    </tr>
  </tbody>
</table>
```

### 支持的样式属性

#### table标签
```css
width: 100%;              /* 宽度 */
border-collapse: collapse; /* 边框合并 */
font-size: 14px;          /* 字体大小 */
text-align: center;       /* 文本对齐 */
```

#### thead/tbody标签
```css
background: #f5f7fa;      /* 背景色 */
color: #333333;           /* 文字颜色 */
```

#### tr标签
```css
background: #ffffff;      /* 背景色 */
color: #000000;           /* 文字颜色 */
```

#### th/td标签
```css
border: 1px solid #ddd;   /* 边框 */
padding: 6px;             /* 内边距 */
background: #f9f9f9;      /* 背景色 */
color: #606266;           /* 文字颜色 */
text-align: left;         /* 对齐方式 */
vertical-align: middle;   /* 垂直对齐 */
```

### 完整示例（全功能测试表格）

**包含：表头背景色、文字颜色、边框、斑马纹行、居中对齐、字体大小、内边距、特殊单元格高亮**

```html
<table style="width:100%; border-collapse:collapse; text-align:center; font-size:14px; color:#606266;">
  <thead>
    <tr style="background:#409eff; color:#ffffff;">
      <th style="border:1px solid #409eff; padding:10px; font-weight:bold;">编号</th>
      <th style="border:1px solid #409eff; padding:10px; font-weight:bold;">项目名称</th>
      <th style="border:1px solid #409eff; padding:10px; font-weight:bold;">数量</th>
      <th style="border:1px solid #409eff; padding:10px; font-weight:bold;">单价(元)</th>
      <th style="border:1px solid #409eff; padding:10px; font-weight:bold;">金额(元)</th>
    </tr>
  </thead>
  <tbody>
    <tr style="background:#ffffff;">
      <td style="border:1px solid #dcdfe6; padding:8px;">1</td>
      <td style="border:1px solid #dcdfe6; padding:8px; text-align:left;">项目A - <b>重点项目</b></td>
      <td style="border:1px solid #dcdfe6; padding:8px;">10</td>
      <td style="border:1px solid #dcdfe6; padding:8px;">1,000.00</td>
      <td style="border:1px solid #dcdfe6; padding:8px; color:#67c23a; font-weight:bold;">10,000.00</td>
    </tr>
    <tr style="background:#f5f7fa;">
      <td style="border:1px solid #dcdfe6; padding:8px;">2</td>
      <td style="border:1px solid #dcdfe6; padding:8px; text-align:left;">项目B</td>
      <td style="border:1px solid #dcdfe6; padding:8px;">5</td>
      <td style="border:1px solid #dcdfe6; padding:8px;">500.00</td>
      <td style="border:1px solid #dcdfe6; padding:8px;">2,500.00</td>
    </tr>
    <tr style="background:#ffffff;">
      <td style="border:1px solid #dcdfe6; padding:8px;">3</td>
      <td style="border:1px solid #dcdfe6; padding:8px; text-align:left;">项目C - <i>紧急</i></td>
      <td style="border:1px solid #dcdfe6; padding:8px;">20</td>
      <td style="border:1px solid #dcdfe6; padding:8px;">300.00</td>
      <td style="border:1px solid #dcdfe6; padding:8px;">6,000.00</td>
    </tr>
    <tr style="background:#fff3e0;">
      <td style="border:1px solid #dcdfe6; padding:8px;">4</td>
      <td style="border:1px solid #dcdfe6; padding:8px; text-align:left; color:#e6a23c;"><b>优惠项目D</b></td>
      <td style="border:1px solid #dcdfe6; padding:8px;">8</td>
      <td style="border:1px solid #dcdfe6; padding:8px;"><s>600.00</s> 480.00</td>
      <td style="border:1px solid #dcdfe6; padding:8px; color:#e6a23c;">3,840.00</td>
    </tr>
    <tr style="background:#ffebee;">
      <td colspan="4" style="border:1px solid #f56c6c; padding:8px; text-align:right; font-weight:bold; color:#f56c6c;">合计金额：</td>
      <td style="border:1px solid #f56c6c; padding:8px; background:#f56c6c; color:#ffffff; font-weight:bold; font-size:16px;">22,340.00</td>
    </tr>
  </tbody>
</table>
```

**该示例展示的功能**：
- ✅ **表头样式**：蓝色背景(#409eff)、白色文字、加粗
- ✅ **斑马纹行**：交替白色和浅灰色背景
- ✅ **文本对齐**：数字居中、文字左对齐
- ✅ **富文本**：粗体、斜体、删除线
- ✅ **单元格颜色**：绿色金额、橙色优惠、红色合计
- ✅ **特殊行**：橙色背景的优惠行、红色背景的合计行
- ✅ **单元格合并**：`colspan`合并4列显示"合计金额"
- ✅ **字体大小**：合计金额16px大字
- ✅ **边框样式**：统一边框、合计行特殊边框颜色

### 表格常见问题

**Q1：为什么表格的背景色在Word中显示不一致？**

A：Word对某些CSS颜色的渲染与浏览器略有不同。建议：
- ✅ 使用标准的16进制颜色值，如 `#409eff`、`#f5f7fa`
- ✅ 避免使用 `rgba()` 或颜色名称
- ✅ 测试时在Word中预览实际效果

**Q2：表格边框不显示或显示不正确？**

A：检查以下几点：
- ✅ 确保在table标签中添加了 `border-collapse: collapse;`
- ✅ 每个单元格都需要单独设置边框：`border:1px solid #dcdfe6`
- ✅ 边框颜色要明确指定，不要依赖默认值

**Q3：表格中的文字样式（粗体、颜色）不生效？**

A：表格单元格中的文字样式需要：
- ✅ 直接在 `<td>` 或 `<th>` 标签的 `style` 属性中设置
- ✅ 或者使用HTML标签包裹，如 `<b>粗体</b>`、`<span style='color:#f56c6c;'>红色</span>`
- ✅ 避免只在table级别设置样式期望继承

**Q4：如何实现斑马纹表格？**

A：在每个 `<tr>` 标签中设置不同的背景色：
```html
<tr style="background:#ffffff;">...</tr>  <!-- 白色行 -->
<tr style="background:#f5f7fa;">...</tr>  <!-- 灰色行 -->
```

**Q5：colspan合并单元格不生效？**

A：确保：
- ✅ 使用 `colspan="数字"` 而不是 `col-span`
- ✅ 合并后的列数不超过表格总列数
- ✅ 示例：`<td colspan="4">合并4列</td>`

**Q6：单元格内的HTML标签（如删除线、颜色）不显示？**

A：系统现已支持单元格内的所有富文本格式：
- ✅ **粗体/斜体/下划线**：`<b>`, `<i>`, `<u>`
- ✅ **删除线**：`<s>600.00</s>` 或 `<del>600.00</del>`
- ✅ **上下标**：H`<sub>2</sub>`O、E=mc`<sup>2</sup>`
- ✅ **颜色**：`<span style='color:#f56c6c;'>红色</span>`
- ✅ **字体大小**：`<span style='font-size:16px;'>大字</span>`
- ✅ **嵌套样式**：`<b><span style='color:red;'>粗体红色</span></b>`

---

## 📞 技术支持

如需了解更多功能或有定制需求，请联系：

- 📧 官方网站：[https://zhaoxinms.com](https://zhaoxinms.com)
- 📦 产品价格：[https://zhaoxinms.com/price](https://zhaoxinms.com/price)

---


