# 文档合成功能支持说明

## 📋 功能概述

肇新智能合同合成系统基于 **ContentControl（内容控件）** 技术，支持复杂的文档合成需求。本文档详细说明系统支持的各种内容类型、格式和功能。

---

## 🎯 核心技术

### ContentControl技术

ContentControl是Word文档中的结构化内容容器，系统通过识别ContentControl的标签（tag）进行内容替换和插入。

**优势**：
- ✅ 支持复杂格式
- ✅ 保留原始样式
- ✅ 支持嵌套结构
- ✅ 可视化设计
- ✅ 批量合成

---

## 📝 支持的内容类型

### 1. 纯文本

**说明**：最基础的文本内容替换

**模板设计**：
```
插入内容控件，设置tag：party_a_name
内容控件中的占位文本：{甲方名称}
```

**合成数据**：
```json
{
  "party_a_name": "北京某某科技有限公司"
}
```

**合成结果**：
```
北京某某科技有限公司
```

**支持特性**：
- ✅ 中文、英文、数字、符号
- ✅ 多行文本
- ✅ 特殊字符（©、®、™等）

---

### 2. 富文本（带样式的文本）

**说明**：支持文本的字体、颜色、大小、粗体、斜体、下划线等样式

**样式支持清单**：

| 样式类型 | 支持情况 | 说明 |
|---------|---------|------|
| **字体** | ✅ 完全支持 | 宋体、黑体、微软雅黑、Times New Roman等 |
| **字号** | ✅ 完全支持 | 任意字号（如10.5pt、14pt） |
| **颜色** | ✅ 完全支持 | RGB颜色、主题颜色 |
| **粗体** | ✅ 完全支持 | Bold |
| **斜体** | ✅ 完全支持 | Italic |
| **下划线** | ✅ 完全支持 | 单下划线、双下划线、波浪线等 |
| **删除线** | ✅ 完全支持 | 单删除线、双删除线 |
| **上标/下标** | ✅ 完全支持 | X²、H₂O |
| **突出显示** | ✅ 完全支持 | 背景高亮颜色 |

**模板设计**：
```
创建内容控件，tag：important_clause
应用样式：字体红色、加粗、14pt
```

**合成数据**：
```json
{
  "important_clause": "本条款为关键条款，请仔细阅读"
}
```

**合成结果**：  
文本会继承模板中设置的所有样式（红色、加粗、14pt）

---

### 3. 段落格式

**说明**：支持段落的对齐、缩进、行距、间距等格式

**支持的段落格式**：

| 格式类型 | 支持情况 | 可选值 |
|---------|---------|--------|
| **对齐方式** | ✅ 完全支持 | 左对齐、居中、右对齐、两端对齐 |
| **首行缩进** | ✅ 完全支持 | 任意缩进值（如2字符） |
| **左缩进** | ✅ 完全支持 | 任意缩进值 |
| **右缩进** | ✅ 完全支持 | 任意缩进值 |
| **段前间距** | ✅ 完全支持 | 任意间距值 |
| **段后间距** | ✅ 完全支持 | 任意间距值 |
| **行距** | ✅ 完全支持 | 单倍、1.5倍、2倍、固定值 |
| **编号/项目符号** | ✅ 完全支持 | 自动编号、项目符号 |

**示例**：
```
模板中设置段落：
- 首行缩进2字符
- 行距1.5倍
- 段后间距0.5行

合成后会保持这些格式
```

---

### 4. 表格

**说明**：强大的表格支持，可以插入复杂的表格结构

#### 4.1 静态表格

**模板设计**：
```
插入内容控件，tag：product_list
内容控件中包含一个表格模板
```

**合成数据**（HTML格式）：
```json
{
  "product_list": "<table style='width:100%; border-collapse: collapse;'><thead><tr style='background:#f5f7fa; color:#333;'><th style='border:1px solid #ddd; padding:6px;'>序号</th><th style='border:1px solid #ddd; padding:6px;'>产品名称</th><th style='border:1px solid #ddd; padding:6px;'>数量</th><th style='border:1px solid #ddd; padding:6px;'>单价</th></tr></thead><tbody style='color:#606266;'><tr><td style='border:1px solid #ddd; padding:6px;'>1</td><td style='border:1px solid #ddd; padding:6px;'>产品A</td><td style='border:1px solid #ddd; padding:6px;'>10</td><td style='border:1px solid #ddd; padding:6px;'>1000.00</td></tr><tr><td style='border:1px solid #ddd; padding:6px;'>2</td><td style='border:1px solid #ddd; padding:6px;'>产品B</td><td style='border:1px solid #ddd; padding:6px;'>5</td><td style='border:1px solid #ddd; padding:6px;'>500.00</td></tr></tbody></table>"
}
```

**合成结果**：  
生成一个完整的Word表格，保留所有样式

#### 4.2 表格样式支持

| 样式类型 | 支持情况 | 说明 |
|---------|---------|------|
| **表格边框** | ✅ 完全支持 | 边框颜色、粗细、样式 |
| **单元格背景色** | ✅ 完全支持 | 任意RGB颜色 |
| **单元格文字颜色** | ✅ 完全支持 | 支持表头、表体分别设置 |
| **单元格对齐** | ✅ 完全支持 | 水平/垂直对齐 |
| **单元格合并** | ✅ 完全支持 | 横向、纵向合并 |
| **表格宽度** | ✅ 完全支持 | 百分比、固定宽度 |
| **列宽** | ✅ 完全支持 | 自动、固定、按比例 |
| **行高** | ✅ 完全支持 | 自动、固定 |
| **内边距** | ✅ 完全支持 | 单元格内边距 |

#### 4.3 表格高级功能

**表头表体颜色区分**：
```html
<table>
  <thead>
    <tr style="background:#f5f7fa; color:#333333;">
      <th>表头1</th>
      <th>表头2</th>
    </tr>
  </thead>
  <tbody style="color:#606266;">
    <tr>
      <td>内容1</td>
      <td>内容2</td>
    </tr>
  </tbody>
</table>
```

**行级颜色设置**：
```html
<tr style="background:#fff; color:#000;">
  <td>第一行</td>
</tr>
<tr style="background:#f9f9f9; color:#666;">
  <td>第二行（斑马纹）</td>
</tr>
```

**单元格级颜色设置**：
```html
<td style="background:#ffebee; color:#c62828;">
  重要单元格
</td>
```

---

### 5. 条款（变量替换）

**说明**：条款可以包含固定文本和变量，变量会被实际值替换

**格式支持**：
- `${variable}` 格式
- `{{variable}}` 格式

**模板设计**：
```
创建内容控件，tag：contract_clause
内容：甲方：${party_a_name}，乙方：${party_b_name}，就${contract_name}达成如下协议：
```

**合成数据**：
```json
{
  "contract_clause": "甲方：${party_a_name}，乙方：${party_b_name}，就${contract_name}达成如下协议：",
  "party_a_name": "北京某某公司",
  "party_b_name": "上海某某公司",
  "contract_name": "技术服务合同"
}
```

**合成结果**：
```
甲方：北京某某公司，乙方：上海某某公司，就技术服务合同达成如下协议：
```

**高级特性**：
- ✅ 变量可以引用其他字段的值
- ✅ 支持嵌套变量
- ✅ 固定文本不可修改
- ✅ 变量值可以独立输入

---

### 6. 图片（规划中）

**说明**：支持在合同中插入图片

**支持的图片格式**（规划）：
- PNG
- JPG/JPEG
- GIF
- BMP

**使用方式**（规划）：
```json
{
  "company_logo": "https://example.com/logo.png"
}
```

---

### 7. 印章标记

**说明**：在文档中标记印章位置，支持后续自动盖章

**标记格式**：
```
创建内容控件，tag以 seal_ 开头
如：seal_party_a, seal_party_b
```

**合成数据**：
```json
{
  "seal_party_a": "【甲方盖章处】",
  "seal_party_b": "【乙方盖章处】"
}
```

**盖章功能**：
系统会自动识别印章标记，在PDF转换后的指定位置添加电子印章。

**印章配置**：
```json
{
  "seal": {
    "party_a": {
      "image": "seal_a.png",
      "position": "auto"  // 自动定位到标记处
    }
  }
}
```

---

## 🎨 样式继承规则

### 继承优先级

从高到低：
1. **内容级样式** - 插入内容自带的样式（最高优先级）
2. **内容控件样式** - 内容控件设置的样式
3. **段落样式** - 段落应用的样式
4. **文档默认样式** - 文档的默认样式（最低优先级）

### 示例说明

```
场景1：内容控件设置为"红色、加粗"
插入数据："普通文本"
结果：文本显示为红色加粗

场景2：内容控件设置为"红色、加粗"
插入数据："<span style='color:blue;'>蓝色文本</span>"
结果：文本显示为蓝色加粗（颜色被覆盖，加粗保留）

场景3：插入表格
表格内的文字会继承表格单元格的样式设置
```

---

## 📊 表格HTML格式规范

### 基本结构

```html
<table style="样式属性">
  <thead>
    <tr style="样式属性">
      <th style="样式属性">表头单元格</th>
    </tr>
  </thead>
  <tbody>
    <tr style="样式属性">
      <td style="样式属性">数据单元格</td>
    </tr>
  </tbody>
</table>
```

### 支持的样式属性

#### table标签
```css
width: 100%;              /* 宽度 */
border-collapse: collapse; /* 边框合并 */
font-size: 14px;          /* 字体大小 */
text-align: center;       /* 文本对齐 */
```

#### thead/tbody标签
```css
background: #f5f7fa;      /* 背景色 */
color: #333333;           /* 文字颜色 */
```

#### tr标签
```css
background: #ffffff;      /* 背景色 */
color: #000000;           /* 文字颜色 */
```

#### th/td标签
```css
border: 1px solid #ddd;   /* 边框 */
padding: 6px;             /* 内边距 */
background: #f9f9f9;      /* 背景色 */
color: #606266;           /* 文字颜色 */
text-align: left;         /* 对齐方式 */
vertical-align: middle;   /* 垂直对齐 */
```

### 完整示例

```html
<table style="width:100%; border-collapse: collapse; text-align:center; font-size:14px;">
  <thead>
    <tr style="background:#409eff; color:#ffffff;">
      <th style="border:1px solid #409eff; padding:8px;">编号</th>
      <th style="border:1px solid #409eff; padding:8px;">项目名称</th>
      <th style="border:1px solid #409eff; padding:8px;">金额</th>
    </tr>
  </thead>
  <tbody style="color:#606266;">
    <tr>
      <td style="border:1px solid #dcdfe6; padding:8px;">1</td>
      <td style="border:1px solid #dcdfe6; padding:8px;">项目A</td>
      <td style="border:1px solid #dcdfe6; padding:8px;">10000.00</td>
    </tr>
    <tr style="background:#f5f7fa;">
      <td style="border:1px solid #dcdfe6; padding:8px;">2</td>
      <td style="border:1px solid #dcdfe6; padding:8px;">项目B</td>
      <td style="border:1px solid #dcdfe6; padding:8px;">20000.00</td>
    </tr>
  </tbody>
</table>
```

---

## 💡 最佳实践

### 1. 模板设计建议

**✅ 推荐做法**：
- 在Word中直接设计好样式和格式
- 使用内容控件的标签（tag）而不是标题（title）
- 标签命名使用英文和下划线（如：party_a_name）
- 为每个内容控件设置有意义的占位文本
- 表格使用HTML格式传入数据

**❌ 不推荐做法**：
- 使用中文作为tag名称
- tag名称包含特殊字符
- 内容控件嵌套过深（建议不超过3层）
- 手动在Word中画表格（建议用HTML传入）

### 2. 数据准备建议

**文本数据**：
```json
{
  "simple_text": "纯文本内容"
}
```

**富文本数据**：
```json
{
  "rich_text": "<span style='color:red; font-weight:bold;'>富文本内容</span>"
}
```

**表格数据**：
```json
{
  "table_content": "<table>...</table>"
}
```

**条款数据**：
```json
{
  "clause_content": "甲方：${party_a}，乙方：${party_b}",
  "party_a": "北京公司",
  "party_b": "上海公司"
}
```

### 3. 颜色使用建议

**推荐的颜色值格式**：
```css
/* RGB十六进制（推荐） */
color: #409eff;
background: #f5f7fa;

/* RGB格式（支持） */
color: rgb(64, 158, 255);
background: rgb(245, 247, 250);
```

**Element Plus UI颜色参考**：
```css
主色：#409eff
成功：#67c23a
警告：#e6a23c
危险：#f56c6c
信息：#909399

浅背景：#f5f7fa
边框：#dcdfe6
文字：#606266
```

### 4. 性能优化建议

| 场景 | 建议 | 原因 |
|------|------|------|
| 大量数据 | 分批合成 | 避免内存溢出 |
| 复杂表格 | 控制行数（<100行） | 提高合成速度 |
| 图片 | 压缩后上传 | 减少文件大小 |
| 样式 | 复用样式模板 | 保持一致性 |

---

## 🔧 技术实现细节

### ContentControl技术原理

```
1. Word模板中插入ContentControl
   ↓
2. 为ContentControl设置tag（标识符）
   ↓
3. 系统读取tag，查找对应的数据
   ↓
4. 解析数据格式（纯文本/HTML/表格）
   ↓
5. 保留原有样式，插入新内容
   ↓
6. 生成最终文档
```

### 表格转换流程

```
HTML表格 → 解析HTML结构 → 提取样式信息 → 创建Word表格
→ 应用样式（边框、背景、文字颜色）→ 填充内容 → 完成
```

### 样式处理流程

```
1. 读取模板样式
2. 解析插入内容的样式
3. 合并样式（按优先级）
4. 应用到最终内容
5. 生成文档
```

---

## 📋 功能对比

### 与其他方案对比

| 功能 | 肇新系统 | 占位符替换 | 模板引擎 |
|------|---------|-----------|---------|
| 文本替换 | ✅ | ✅ | ✅ |
| 保留格式 | ✅ | ❌ | 部分支持 |
| 表格支持 | ✅ 完整 | ❌ | 基础支持 |
| 样式继承 | ✅ | ❌ | ❌ |
| 可视化设计 | ✅ | ❌ | ❌ |
| 变量替换 | ✅ | ✅ | ✅ |
| 印章支持 | ✅ | ❌ | ❌ |
| 学习成本 | 低 | 低 | 高 |

---

## 🎉 示例场景

### 场景1：简单合同

**需求**：生成买卖合同，包含双方信息、合同编号、签订日期

**模板**：
- 内容控件：contract_no（合同编号）
- 内容控件：party_a（甲方）
- 内容控件：party_b（乙方）
- 内容控件：sign_date（签订日期）

**数据**：
```json
{
  "contract_no": "HT20250118001",
  "party_a": "北京某某科技有限公司",
  "party_b": "上海某某商贸有限公司",
  "sign_date": "2025年1月18日"
}
```

### 场景2：包含表格的合同

**需求**：采购合同，包含产品清单表格

**模板**：
- 内容控件：product_list（产品清单）

**数据**：
```json
{
  "product_list": "<table style='width:100%; border-collapse: collapse;'><thead><tr style='background:#409eff; color:#fff;'><th style='border:1px solid #ddd; padding:8px;'>序号</th><th style='border:1px solid #ddd; padding:8px;'>产品名称</th><th style='border:1px solid #ddd; padding:8px;'>规格</th><th style='border:1px solid #ddd; padding:8px;'>数量</th><th style='border:1px solid #ddd; padding:8px;'>单价</th><th style='border:1px solid #ddd; padding:8px;'>金额</th></tr></thead><tbody><tr><td style='border:1px solid #ddd; padding:8px;'>1</td><td style='border:1px solid #ddd; padding:8px;'>笔记本电脑</td><td style='border:1px solid #ddd; padding:8px;'>ThinkPad X1</td><td style='border:1px solid #ddd; padding:8px;'>10</td><td style='border:1px solid #ddd; padding:8px;'>8000</td><td style='border:1px solid #ddd; padding:8px;'>80000</td></tr></tbody></table>"
}
```

### 场景3：复杂条款合同

**需求**：技术服务合同，包含多个变量的复杂条款

**模板**：
- 内容控件：service_clause（服务条款）

**数据**：
```json
{
  "service_clause": "甲方：${party_a}，乙方：${party_b}，就${service_name}服务事宜，经友好协商，达成如下协议：\n一、服务期限：${service_period}\n二、服务费用：${service_fee}\n三、付款方式：${payment_method}",
  "party_a": "北京某某公司",
  "party_b": "上海某某公司",
  "service_name": "云计算技术支持",
  "service_period": "2025年1月至2025年12月",
  "service_fee": "人民币50万元",
  "payment_method": "按季度支付"
}
```

---

## 📞 技术支持

如需了解更多功能或有定制需求，请联系：

- 📧 官方网站：[https://zhaoxinms.com](https://zhaoxinms.com)
- 📦 产品价格：[https://zhaoxinms.com/price](https://zhaoxinms.com/price)
- ☎️ 技术支持：18306806281

---

**文档版本**: 1.0  
**最后更新**: 2025-01-18  
**维护者**: 山西肇新科技有限公司

